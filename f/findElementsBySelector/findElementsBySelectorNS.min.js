"use strict";!function(){var a=__imns("util.classes");"SelectorParser"in a||(a.SelectorParser=function(a,b){var c=__imns("util.validation");if(this.selectors="",this.elems="*",this.chains=[],void 0!==a){this.init(a)}void 0!==b&&(b=c.isHTMLElement(b)?[b]:b,c.isArray(b)&&(this.elems=b))},a.SelectorParser.prototype.init=function(a){if("string"==typeof a){var b=/,\s*/;return this.chains=a.split(b),this.chains.length>0}},a.SelectorParser.prototype.process=function(){var a=__imns("util.classes"),b=__imns("util.tools"),c=[];if(this.chains.length>0)for(var d=0,e=this.chains.length;d<e;d+=1){var f=new a.SelectorParserChain(this.chains[d]),g=f.find(this.elems);c=c.concat(g)}return c=c.length>0?b.arrayUnique(c):c})}(),function(){var a=__imns("util.dom");"parseCSSSelector"in a||(a.parseCSSSelector=function(a,b){var c=__imns("util.validation"),d=__imns("util.classes");return c.isString(a)?(void 0===b&&(b="*"),new d.SelectorParser(a,b).process()):[]})}(),function(){var a=__imns("util.classes");"SelectorParserChain"in a||(a.SelectorParserChain=function(a){var b=__imns("util.validation");this.chain=[],this.lastWasCombinator=!0,a=void 0!==a&&b.isString(a)&&a.length>0?a:"",a.length>0&&this.parse(a)},a.SelectorParserChain.prototype.parse=function(a){var b=__imns("util.validation"),c=__imns("util.classes");if(this.chain=[],b.isString(a)){var d=/\s+(?![^\{\(\[\"]*[\}\]\)\"])/;this.chain=a.split(d);for(var e=0,f=this.chain.length;e<f;e+=1)this.chain[e]=new c.SelectorParserSingleSelector(this.chain[e])}},a.SelectorParserChain.prototype.find=function(a){var b=__imns("util.classes"),c=__imns("util.dom"),d=__imns("util.validation"),e=__imns("util.tools");a=d.isArray(a)?c.findAllChildElements(a):"*";for(var f=0,g=this.chain.length;f<g;f+=1){var h=this.chain[f];if((new b.CombinatorParserRules).is(h.selector)&&!this.lastWasCombinator?(a=(new b.CombinatorParserRules).check(h.selector,a),this.lastWasCombinator=!0):(this.lastWasCombinator||(a=c.findAllChildElements(a),a=e.arrayUnique(a)),a=this.chain[f].findWithin(a),this.lastWasCombinator=!1),0===a.length)break}return a},a.SelectorParserChain.prototype.chainExp=/\s+(?![^\{\(\[\"]*[\}\]\)\"])/,a.SelectorParserChain.prototype.isChain=function(b){var c=__imns("util.validation");__imns("util.tools");if(c.isString(b)&&b.length>0){var d=b.split(a.SelectorParserChain.prototype.chainExp);if(d.length>1||0===d.length)return!0}return!1})}(),function(){var a=__imns("util.validation");"isMultiLevelCSSSelector"in a||(a.isMultiLevelCSSSelector=function(a){var b=(__imns("util.tools"),__imns("util.classes"));return(new b.SelectorParserChain).isChain(a)})}(),function(){var a=__imns("util.classes");"SelectorParserSingleSelector"in a||(a.SelectorParserSingleSelector=function(a){this.selector="*",void 0!==a&&this.setSelector(a)},a.SelectorParserSingleSelector.prototype.setSelector=function(a){var b=__imns("util.validation");__imns("util.tools");return"string"==typeof a&&a.length>0&&!b.isMultiLevelCSSSelector(a)?this.selector=a:this.selector="*",this.selector},a.SelectorParserSingleSelector.prototype.find=function(){var a=__imns("util.classes");return(new a.SelectorParserRules).check("*",this.selector)},a.SelectorParserSingleSelector.prototype.findWithin=function(a){var b=(__imns("util.dom"),__imns("util.validation"),__imns("util.classes")),c=(new b.SelectorParserRules).check(a,this.selector);return c},a.SelectorParserSingleSelector.prototype.ascertain=function(a){var b=__imns("util.validation");if(!b.isHTMLElement(a))return!1;for(var c=0,d=this.rules.length;c<d;c+=1)if(!this.rules[c].check(a))return!1;return!0})}(),function(){var a=__imns("util.classes");"SelectorParserRules"in a||(a.SelectorParserRules=function(){var a=__imns("util.classes");return void 0!==a.SelectorParserRules.prototype.singleton?a.SelectorParserRules.prototype.singleton:(a.SelectorParserRules.prototype.singleton=this,void(this.rules=[]))},a.SelectorParserRules.prototype.check=function(a,b){var c=__imns("util.validation");if(c.isString(b)){for(var d=0,e=this.rules.length;d<e;d+=1)if(a=this.rules[d].check(a,b),0===a.length)return[];return a}return[]},a.SelectorParserRules.prototype.run=a.SelectorParserRules.prototype.check,a.SelectorParserRules.prototype.addRule=function(a){var b=__imns("util.classes");return a instanceof b.SelectorParserRule||(a=new b.SelectorParserRule(a)),a instanceof b.SelectorParserRule&&!this.hasRule(a)&&(this.rules.push(a),!0)},a.SelectorParserRules.prototype.findRuleByName=function(a){var b=__imns("util.validation");if(b.isString(a)&&a.length>0)for(var c=0,d=this.rules.length;c<d;c+=1)if(this.rules[c].name===a)return this.rules[c]},a.SelectorParserRules.prototype.findRuleByRule=function(a){var b=__imns("util.classes");if(a instanceof b.SelectorParserRule)for(var c=0,d=this.rules.length;c<d;c+=1)if(a===this.rules[c])return this.rules[c]},a.SelectorParserRules.prototype.findRule=function(a){var b=__imns("util.validation"),c=__imns("util.classes");if(void 0!==a)return b.isString(a)?this.findRuleByName(a):a instanceof c.SelectorParserRule?this.findRuleByRule(a):(a=new c.SelectorParserRule(a),this.findRuleByRule(a))},a.SelectorParserRules.prototype.hasRule=function(a){return void 0!==this.findRule(a)})}(),function(){var a=__imns("util.classes");"CombinatorParserRules"in a||(a.CombinatorParserRules=function(){var a=__imns("util.classes");return void 0!==a.CombinatorParserRules.prototype.singleton?a.CombinatorParserRules.prototype.singleton:(a.CombinatorParserRules.prototype.singleton=this,void(this.rules=[]))},a.CombinatorParserRules.prototype.addRule=function(a){var b=__imns("util.classes");return a instanceof b.CombinatorParserRule||(a=new b.CombinatorParserRule(a)),!this.hasRule(a)&&a instanceof b.CombinatorParserRule&&(this.rules.push(a),!0)},a.CombinatorParserRules.prototype.hasRule=function(a){var b=__imns("util.classes"),c=__imns("util.validation");if(void 0!==a){if(c.isString(a))return this.findRuleByName(a);if(a instanceof b.CombinatorParserRule)return this.findRuleByRule(a);var d=new b.CombinatorParserRule(a);return this.findRuleByRule(d)}return!1},a.CombinatorParserRules.prototype.findRuleByRule=function(a){var b=__imns("util.classes");if(void 0!==a&&a instanceof b.CombinatorParserRule)for(var c=0,d=this.rules.length;c<d;c+=1)if(this.rules[c]===a)return!0;return!1},a.CombinatorParserRules.prototype.findRuleByName=function(a){var b=__imns("util.validation");if(void 0!==a&&b.isString(a)&&a.length>0)for(var c=0,d=this.rules.length;c<d;c+=1)if(this.rules.name===a)return!0;return!1},a.CombinatorParserRules.prototype.is=function(a){for(var b=0,c=this.rules.length;b<c;b+=1)if(this.rules[b].is(a))return!0;return!1},a.CombinatorParserRules.prototype.check=function(a,b){for(var c=0,d=this.rules.length;c<d;c+=1)b=this.rules[c].check(a,b);return b})}(),function(){var a=__imns("util.classes");"CombinatorParserRule"in a||(a.CombinatorParserRule=function(a){if(this.name="",this._check=null,this._is=null,void 0!==a){var b=this.init(a);if(!b)return!1}},a.CombinatorParserRule.prototype.init=function(a){if(void 0===a)return!1;__imns("util.validation");return"object"==typeof a&&("check"in a&&this.setCheck(a.check),"is"in a&&this.setIs(a.is),"name"in a&&this.setName(a.name)),this.valid()},a.CombinatorParserRule.prototype.is=function(a){var b=__imns("util.validation");return!(null===this._is||!b.isFunction(this._is))&&this._is(a)},a.CombinatorParserRule.prototype.check=function(a,b){var c=__imns("util.validation");return this.is(a)&&null!==this._check&&c.isFunction(this._check)?this._check(a,b):b},a.CombinatorParserRule.prototype.setName=function(a){var b=__imns("util.validation");return!!(void 0!==a&&b.isString(a)&&a.length>0)&&(this.name=a,!0)},a.CombinatorParserRule.prototype.setCheck=function(a){var b=__imns("util.validation");return!(void 0===a||!b.isFunction(a)||null!==this._check)&&(this._check=a,!0)},a.CombinatorParserRule.prototype.setIs=function(a){var b=__imns("util.validation");return!(void 0===a||!b.isFunction(a)||null!==this._is)&&(this._is=a,!0)},a.CombinatorParserRule.prototype.valid=function(){return""!==this.name&&null!==this._check&&null!==this._is})}(),function(){var a=__imns("util.classes");if("CombinatorParserRule"in a&&"CombinatorParserRules"in a){var b=new a.CombinatorParserRules;b.addRule({name:"after",is:function(a){var b=/^\~$/;return void 0!==a&&"string"==typeof a&&b.test(a)},check:function(a,b){var c=__imns("util.dom"),d=__imns("util.tools"),e=__imns("util.validation"),f=[];b=c.htmlNodesToArray(b),b=d.arrayUnique(b);for(var g=0,h=b.length;g<h;g+=1){var i=b[g];if(e.isHTMLElement(i))for(var j=i;null!==(j=c.findNextRealSibling(j));)e.isHTMLElement(j)&&f.push(j)}return f=f.length>0?d.arrayUnique(f):f}}),b.addRule({name:"adjacent",is:function(a){var b=/^\+$/;return void 0!==a&&"string"==typeof a&&b.test(a)},check:function(a,b){var c=__imns("util.dom"),d=__imns("util.tools"),e=__imns("util.validation"),f=[];b=c.htmlNodesToArray(b);for(var g=0,h=b.length;g<h;g+=1)for(var i=b[g],j=/^\s*$/,k=c.findNextRealSibling(i);e.isHTMLElement(k);)if("nodeType"in k){if(1===k.nodeType){f.push(k);break}k=3===k.nodeType&&j.test(k.innerHTML)?k.nextSibling:null}else k=null;return f=f.length>0?d.arrayUnique(f):f}}),b.addRule({name:"direct-child",is:function(a){var b=/^\>$/;return void 0!==a&&"string"==typeof a&&b.test(a)},check:function(a,b){var c=__imns("util.dom"),d=__imns("util.tools"),e=__imns("util.validation"),f=[];b=c.htmlNodesToArray(b);for(var g=0,h=b.length;g<h;g+=1){var i=b[g];if(e.isHTMLElement(i))for(var j=("childNodes"in i?i.childNodes:"children"in i?i.children:[]),k=0,l=j.length;k<l;k+=1){var m=j[k];"nodeType"in m&&(1!==m.nodeType&&9!==m.nodeType&&11!==m.nodeType||f.push(m))}}return f=f.length>0?d.arrayUnique(f):f}})}}(),function(){var a=__imns("util.classes");"SelectorParserRule"in a||(a.SelectorParserRule=function(a){this.name="",this._check=null,void 0!==a&&this.init(a)},a.SelectorParserRule.prototype.init=function(a){if(void 0===a)return!1;var b=__imns("util.validation");b.isFunction(a)?this.setCheck(a):b.isString(a)?this.setName(a):"object"==typeof a&&("name"in a&&this.setName(a.name),"func"in a?this.setCheck(a.func):"check"in a&&this.setCheck(a.check))},a.SelectorParserRule.prototype.setName=function(a){var b=__imns("util.validation");return!!(b.isString(a)&&a.length>0)&&(this.name=a,!0)},a.SelectorParserRule.prototype.setCheck=function(a){var b=__imns("util.validation");return!(void 0===a||!b.isFunction(a))&&(this._check=a,!0)},a.SelectorParserRule.prototype.check=function(a,b){var c=__imns("util.validation"),d=[];return c.isFunction(this._check)&&(d=this._check(a,b)),d}),(new a.SelectorParserRules).addRule({name:"poundid",check:function(a,b){var c=__imns("util.validation"),d=__imns("util.dom"),e=__imns("util.tools"),f=null;if(c.hasCSSIdSelector(b)){for(var g=e.getCSSIdSelectors(b),h=0,i=g.length;h<i;h+=1){var j=d.findElementById(g[h]);j=[j],f=null===f?j:e.arraySimilarity(f,j)}return c.isArray(a)?a=e.arraySimilarity(a,f):f}return a}}),(new a.SelectorParserRules).addRule({name:"dotclass",check:function(a,b){var c=__imns("util.validation"),d=__imns("util.dom"),e=__imns("util.tools"),f=null;if(c.hasCSSClassDotSelector(b)){for(var g=e.getCSSClassDotSelectors(b),h=0,i=g.length;h<i;h+=1){var j=d.findElementsByClass(g[h]);f=null===f?j:e.arraySimilarity(f,j)}return c.isArray(a)?a=e.arraySimilarity(a,f):f}return a}}),(new a.SelectorParserRules).addRule({name:"tag",check:function(a,b){var c=__imns("util.tools"),d=__imns("util.dom"),e=__imns("util.validation"),f=null;if(e.hasCSSTagSelector(b)){for(var g=c.getCSSTagSelectors(b),h=0,i=g.length;h<i;h+=1){var j=d.findElementsByTag(g[h]);f=null===f?j:c.arraySimiliarity(f,j)}return e.isArray(a)?a=c.arraySimilarity(a,f):f}return a}})}(),function(){var a=__imns("util.tools"),b=__imns("util.validation");a.cssIdentifierReg="(?!(--|-[0-9]|[0-9]))[a-zA-Z0-9\\_\\-\\u00A0-\\u10FFFD]+","getCSSTagSelectors"in a||(a.getCSSTagSelectors=function(a){var b=__imns("util.tools"),c=__imns("util.validation"),d=new RegExp("(?:\\s|^)("+b.cssIdentifierReg+")","g"),e=null,f=[];if(c.isString(a))for(;null!==(e=d.exec(a));)f.push(e[1]);return f}),"getCSSClassDotSelectors"in a||(a.getCSSClassDotSelectors=function(a){var b=__imns("util.tools"),c=__imns("util.validation"),d=new RegExp("(?:\\.)("+b.cssIdentifierReg+")","g"),e=null,f=[];if(c.isString(a))for(;null!==(e=d.exec(a));)f.push(e[1]);return f}),"getCSSIdSelectors"in a||(a.getCSSIdSelectors=function(a){var b=__imns("util.tools"),c=__imns("util.validation"),d=new RegExp("(?:\\#)("+b.cssIdentifierReg+")","g"),e=null,f=[];if(c.isString(a))for(;null!==(e=d.exec(a));)f.push(e[1]);return f}),"hasCSSTagSelector"in b||(b.hasCSSTagSelector=function(a){var b=__imns("util.tools");return b.getCSSTagSelectors(a).length>0}),"hasCSSDotSelector"in b||(b.hasCSSClassDotSelector=function(a){var b=__imns("util.tools");return b.getCSSClassDotSelectors(a).length>0}),"hasCSSIdSelector"in b||(b.hasCSSIdSelector=function(a){var b=__imns("util.tools");return b.getCSSIdSelectors(a).length>0})}(),function(){var a=__imns("util.dom");"findElementsBySelector"in a||(a.findElementsBySelector=function(a,b){if(null===a&&null===b)return[];var c=__imns("util.dom");if(a===document&&void 0!==b&&(a=b,b=void 0),void 0===b)return"string"==typeof a?c.findElementsBySelector.prototype.all(a):[];var d=__imns("util.validation");if("string"==typeof a){var e=c.findElementsBySelector.prototype.all(a);a=e.length>0?e[0]:void 0}return d.isHTMLElement(a)?c.findElementsBySelector.prototype.from(a,b):[]},a.findElementsBySelector.prototype.from=function(a,b){var c,d=__imns("util.validation"),e=__imns("util.dom");if(d.isHTMLElement(a)){if("querySelectorAll"in a&&"string"==typeof b)return c=a.querySelectorAll(b),e.htmlNodesToArray(c);if("jQuery"in window)return c=window.jQuery(a).children(b),e.htmlNodesToArray(c)}return[]},a.findElementsBySelector.prototype.all=function(a){if("string"==typeof a){var b,c=__imns("util.dom");return a=0===a.length?"*":a,"querySelectorAll"in document?(b=document.querySelectorAll(a),c.htmlNodesToArray(b)):"jQuery"in window?(b=window.jQuery("selector"),c.htmlNodesToArray(b)):c.parseCSSSelector(a)}return[]})}();