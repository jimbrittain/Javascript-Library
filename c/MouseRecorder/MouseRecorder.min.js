"use strict";function isKindle(){if(void 0!==isKindle.prototype.found)return isKindle.prototype.found;for(var a=["Silk","Kindle","KFAPW","KFTHW","KFSOW","KFJW","KFTT","KFOT"],b=navigator.userAgent,c=a.length,d=!1,e=0;c>e;e+=1)if(new RegExp(a[e]).test(b)){d=!0;break}return isKindle.prototype.found=d,d}function touchprotect(a,b){return b=void 0!==b||b===!0?!0:!1,isKindle()||navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/WebKit/i)?("preventDefault"in a&&a.preventDefault(),!1):b}function MouseRecorderInstance(a){this.name="",this.element=null,this.jsObject=null,this.type="click",this.controller=new MouseRecorder,this.record=!1,this.coords=new Coordinates(-1,-1),this.init(a)}function MouseRecorder(){if(MouseRecorder.prototype.singletonInstance)return MouseRecorder.prototype.singletonInstance;MouseRecorder.prototype.singletonInstance=this,this.types={click:!0,move:!0},this.down=new Coordinates(-1,-1),this.move=new Coordinates(-1,-1),this.isdown=!1,this.isdown_int=null,this.record=!1,this.instances=[],this.always_record=!1;var a=!1;this.setAlwaysRecord=function(){a=!0},this.getAlwaysRecord=function(){return a},this.x=-1,this.y=-1;var b=this;if("jQuery"in window)$(document).ready(function(){$(document).bind("touchstart.mm",function(){return b.nowDown(),!0}),$(document).bind("touchend.mm",function(){return b.nowUp(),!0}),$(document).bind("touchcancel.mm",function(){return b.nowUp(),!0}),$(document).bind("touchup.mm",function(){return b.nowUp(),!0}),$(document).bind("mousedown.mm",function(a){return b.recorder(a,"click"),!0}),$(document).bind("touchstart.mmm",function(a){return b.recorder(a,"click"),b.compensateForKindle(a)}),$(document).bind("mousemove.mm",function(a){return b.recorder(a,"move"),!0}),$(document).bind("touchmove.mmm",function(a){return b.recorder(a,"move"),b.compensateForKindle(a)})});else if(void 0!==fetter&&"function"==typeof fetter){fetter(document,"DOMContentLoaded",function(){fetter(document,"touchstart",function(){return b.nowDown(),!0},!0),fetter(document,"touchend",function(){return b.nowUp(),!0},!0),fetter(document,"touchup",function(){return b.nowUp(),!0},!0),fetter(document,"touchcancel",function(){return b.nowUp(),!0},!0),fetter(document,"mousedown",function(a){return b.recorder(a,"click"),!0},!0),fetter(document,"touchstart",function(a){return b.recorder(a,"click"),b.compensateForKindle(a)},!0),fetter(document,"mousemove",function(a){return b.recorder(a,"move"),!0},!0),fetter(document,"touchmove",function(a){return b.recorder(a,"move"),b.compensateForKindle(a)},!0)},!0,"after")}}MouseRecorderInstance.prototype.init=function(a){this.name="name"in a&&"string"==typeof a.name?a.name:"",this.element="element"in a&&void 0!==a.element&&isHTMLElement(a.element)?a.element:null,this.jsObject="jsObject"in a&&"object"==typeof a.jsObject?a.jsObject:null,this.type="type"in a&&"string"==typeof a.type&&("click"===a.type||"move"===a.type||"both"===a.type)?a.type:"click","click"===this.type?(this.coords.x=this.controller.down.x,this.coords.y=this.controller.down.y):"move"===this.type?(this.coords.x=this.controller.move.x,this.coords.y=this.controller.move.y):(this.coords.x=this.controller.x,this.coords.y=this.controller.y)},MouseRecorder.prototype.setRecord=function(a){var b=this.findInstanceId(a);if(-1!==b){if("number"==typeof b)return this._setRecordInstance(this.instances[b]);if(b.length&&"string"!=typeof b){for(var c=0,d=b.length;d>c;c+=1)this._setRecordInstance(this.instances[b[c]]);return!0}}else{var e=new MouseRecorderInstance(a);this.instances.push(e),this._setRecordInstance(e)}},MouseRecorder.prototype._setRecordInstance=function(a){return a instanceof MouseRecorderInstance?(a.record=!0,this.record||(this.record=!0),!0):!1},MouseRecorder.prototype.endRecord=function(a){var b=this.findInstanceId(a);if(-1!==b){if("number"==typeof b)return this._setEndRecordInstance(this.instances[b]);if(b.length&&"string"!=typeof b){for(var c=0,d=b.length;d>c;c+=1)this._setEndRecordInstance(this.instances[b[c]]);return!0}}return!1},MouseRecorder.prototype._setEndRecordInstance=function(a){if(!(a instanceof MouseRecorderInstance))return!1;a.record=!1;for(var b=!1,c=0,d=this.instances.length;d>c;c+=1)if(this.instances[c].record){b=!0;break}b||(this.record=!1)},MouseRecorder.prototype.getX=function(a){if("string"!=typeof a||"click"!==a&&"both"!==a&&"move"!==a){var b=this.findInstanceId(a);if(-1!==b){if("number"==typeof b)return this.findInstance(b).coords.x;if(b.length>1&&"string"!=typeof b){for(var c=b[0].type,d=1,e=b.length;e>d&&(b[d].type!==c&&(c="both"),"both"!==c);d+=1);return this.defaultX(c)}}return this.defaultX()}return this.defaultX(a)},MouseRecorder.prototype.getY=function(a){if("string"!=typeof a||"click"!==a&&"both"!==a&&"move"!==a){var b=this.findInstanceId(a);if(-1!==b){if("number"==typeof b)return this.findInstance(b).coords.y;if(b.length>1&&"string"!=typeof b){for(var c=b[0].type,d=1,e=b.length;e>d&&(b[d].type!==c&&(c="both"),"both"!==c);d+=1);return this.defaultY(c)}}return this.defaultY()}return this.defaultY(a)},MouseRecorder.prototype.getCoordinates=function(a){return new Coordinates(this.getX(a),this.getY(a))},MouseRecorder.prototype.defaultX=function(a){return"move"===a?this.move.x:"click"===a?this.down.x:this.x},MouseRecorder.prototype.defaultY=function(a){return"move"===a?this.move.y:"click"===a?this.down.y:this.y},MouseRecorder.prototype.findInstanceId=function(a){var b=0,c=0;if("object"==typeof a&&a instanceof MouseRecorderInstance){for(b=0,c=this.instances.length;c>b;b+=1)if(a===this.instances[b])return b;return-1}if("number"==typeof a&&a>-1&&a<this.instances.length)return a;if("object"==typeof a){var d=this.instances,e=[];if("name"in a&&"string"==typeof a.name){for(e=[],b=0,c=d.length;c>b;b+=1)d[b].name===a.name&&e.push(d[b]);d=e}if(0===d.length)return-1;if("element"in a&&"object"==typeof a.element&&void 0!==a.element&&isHTMLElement(a.element)){for(e=[],b=0,c=d.length;c>b;b+=1)d[b].element===a.element&&e.push(d[b]);d=e}if(0===d.length)return-1;if("jsObject"in a&&"object"==typeof a.jsObject){for(e=[],b=0,c=d.length;c>b;b+=1)d[b].jsObject===a.jsObject&&e.push(d[b]);d=e}if(0===d.length)return-1;if("type"in a&&"string"==typeof a.type){for(e=[],b=0,c=d.length;c>b;b+=1)d[b].type===a.type&&e.push(d[b]);d=e}if(d.length>1){var f=[];for(b=0,c=d.length;c>b;b+=1)d[b]instanceof MouseRecorderInstance&&f.push(this.findInstanceId(d[b]));return 1===f.length?f[0]:f}return 1===d.length&&d[0]instanceof MouseRecorderInstance?this.findInstanceId(d[0]):-1}return-1},MouseRecorder.prototype.isInstance=function(a){return-1===this.findInstanceId(a)?!1:!0},MouseRecorder.prototype.findInstance=function(a){var b=this.findInstanceId(a);if(-1===b)return void 0;if("number"==typeof b)return this.instances[b];if("length"in b&&"string"!=typeof b){for(var c=[],d=0,e=b.length;e>d;d+=1)c.push(this.instances[b[d]]);return c.length>1?c:1===c.length?c[0]:void 0}},MouseRecorder.prototype.removeInstance=function(a){return a instanceof MouseRecorderInstance?this.removeInstanceFromId(this.findInstanceId(a)):!1},MouseRecorder.prototype.removeInstanceFromId=function(a){return"number"==typeof a&&a>-1&&a<this.instances.length?(this.instances.splice(a,1),!0):!1},MouseRecorder.prototype.compensateForKindle=function(a){return isKindle()&&this.isdown?(touchprotect(a,!0),!0):!0},MouseRecorder.prototype.nowDown=function(){if(!this.isdown&&null===this.isdown_int){var a=this;this.isdown_int=setTimeout(function(){a.isdown=!0},25)}},MouseRecorder.prototype.nowUp=function(){null!==this.isdown_int&&clearTimeout(this.isdown_int),this.isdown=!1},MouseRecorder.prototype.alwaysRecord=function(){this.setAlwaysRecord()},MouseRecorder.prototype.recorder=function(a,b){var c=0,d=0,e={};if(b=void 0===b||"click"!==b&&"move"!==b?"click":b,this.record||this.getAlwaysRecord()){var f={x:-1,y:-1};if("pageX"in a&&void 0!==a.pageX?(f.x=a.pageX>0?a.pageX:f.x,f.y=a.pageY>0?a.pageY:f.y):(a="originalEvent"in a?a.originalEvent:a,a.touches&&a.touches.length&&a.touches[0].pageX&&void 0!==a.touches[0].pageX?(this.x=a.touches[0].pageX,f.x=a.touches[0].pageX>0?a.touches[0].pageX:f.x,f.y=a.touches[0].pageY>0?a.touches[0].pageY:f.y):a.targetTouches&&a.targetTouches.length&&a.targetTouches[0].pageX&&void 0!==a.targetTouches[0].pageX?(f.x=a.targetTouches[0].pageX>0?a.targetTouches[0].pageX:f.x,f.y=a.targetTouches[0].pageY>0?a.targetTouches[0].pageY:f.y):a.changedTouches&&a.changedTouches.length&&a.changedTouches[0].pageX&&void 0!==a.changedTouches[0].pageX&&(f.x=a.changedTouches[0].pageX>0?a.changedTouches[0].pageX:f.x,f.y=a.changedTouches[0].pageY>0?a.changedTouches[0].pageY:f.y)),-1!==f.x||-1!==f.y)if(this.x=-1!==f.x?f.x:this.x,this.y=-1!==f.y?f.y:this.y,"click"===b)for(this.down.x=-1!==f.x?f.x:this.down.x,this.down.y=-1!==f.y?f.y:this.down.y,c=0,d=this.instances.length;d>c;c+=1)e=this.instances[c],!e.record||"click"!==e.type&&"both"!==e.type||(e.coords.x=this.down.x,e.coords.y=this.down.y);else if("move"===b)for(this.move.x=-1!==f.x?f.x:this.move.x,this.move.y=-1!==f.x?f.y:this.move.y,c=0,d=this.instances.length;d>c;c+=1)e=this.instances[c],!e.record||"move"!==e.type&&"both"!==e.type||(e.coords.x=this.move.x,e.coords.y=this.move.y)}},MouseRecorder.prototype.isOver=function(a){if(void 0!==a&&isHTMLElement(a)){var b=$(a),c=b.position(),d=null,e="bulls";d="click"===e?new Coordinates(this.down.x,this.down.y):"move"===e?new Coordinates(this.move.x,this.move.y):new Coordinates(this.x,this.y);var f=c.top<=d.y&&c.top+b.height()>=d.y&&c.left<=d.x&&c.left+b.width()>=d.x?!0:!1;return f}return(new IMDebugger).pass("MouseRecorder.isOver must be supplied a HTMLElement"),!1};