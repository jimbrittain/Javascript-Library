"use strict";var adr=__imns("util.classes");"MouseRecorder"in adr||(adr.MouseRecorderInstance=function(a){var b=__imns("util.classes");this.name="",this.element=null,this.jsObject=null,this.type="click",this.controller=new b.MouseRecorder,this.record=!1,this.coords=new b.Coordinates(-1,-1),this.init(a)},adr.MouseRecorderInstance.prototype.init=function(a){var b=__imns("util.validation");this.name="name"in a&&"string"==typeof a.name?a.name:"",this.element="element"in a&&void 0!==a.element&&b.isHTMLElement(a.element)?a.element:null,this.jsObject="jsObject"in a&&"object"==typeof a.jsObject?a.jsObject:null,this.type="type"in a&&"string"==typeof a.type&&("click"===a.type||"move"===a.type||"both"===a.type)?a.type:"click","click"===this.type?(this.coords.x=this.controller.down.x,this.coords.y=this.controller.down.y):"move"===this.type?(this.coords.x=this.controller.move.x,this.coords.y=this.controller.move.y):(this.coords.x=this.controller.x,this.coords.y=this.controller.y)},adr.MouseRecorder=function(){var a=__imns("util.classes"),b=__imns("util.tools");if(a.MouseRecorder.prototype.singleton)return a.MouseRecorder.prototype.singleton;a.MouseRecorder.prototype.singleton=this,this.types={click:!0,move:!0},this.down=new a.Coordinates(-1,-1),this.move=new a.Coordinates(-1,-1),this.isdown=!1,this.isdown_int=null,this.record=!1,this.instances=[],this.always_record=!1;var c=!1;this.setAlwaysRecord=function(){c=!0},this.getAlwaysRecord=function(){return c},this.x=-1,this.y=-1;var d=this;if("jQuery"in window)$(document).ready(function(){$(document).bind("touchstart.mm",function(){return d.nowDown(),!0}),$(document).bind("touchend.mm",function(){return d.nowUp(),!0}),$(document).bind("touchcancel.mm",function(){return d.nowUp(),!0}),$(document).bind("touchup.mm",function(){return d.nowUp(),!0}),$(document).bind("mousedown.mm",function(a){return d.recorder(a,"click"),!0}),$(document).bind("touchstart.mmm",function(a){return d.recorder(a,"click"),d.compensateForKindle(a)}),$(document).bind("mousemove.mm",function(a){return d.recorder(a,"move"),!0}),$(document).bind("touchmove.mmm",function(a){return d.recorder(a,"move"),d.compensateForKindle(a)})});else if(void 0!==b.fetter&&"function"==typeof b.fetter){b.fetter(document,"DOMContentLoaded",[d,function(){b.fetter(document,"touchstart",[d,function(){return d.nowDown(),!0}],!0),b.fetter(document,"touchend",[d,function(){return d.nowUp(),!0}],!0),b.fetter(document,"touchup",[d,function(){return d.nowUp(),!0}],!0),b.fetter(document,"touchcancel",[d,function(){return d.nowUp(),!0}],!0),b.fetter(document,"mousedown",[d,function(a){return d.recorder(a,"click"),!0}],!0),b.fetter(document,"touchstart",[d,function(a){return d.recorder(a,"click"),d.compensateForKindle(a)}],!0),b.fetter(document,"mousemove",[d,function(a){return d.recorder(a,"move"),!0}],!0),b.fetter(document,"touchmove",[d,function(a){return d.recorder(a,"move"),d.compensateForKindle(a)}],!0)}],!0,"after")}},adr.MouseRecorder.prototype.setRecord=function(a){var b=__imns("util.classes"),c=this.findInstanceId(a);if(-1!==c){if("number"==typeof c)return this._setRecordInstance(this.instances[c]);if(c.length&&"string"!=typeof c){for(var d=0,e=c.length;e>d;d+=1)this._setRecordInstance(this.instances[c[d]]);return!0}}else{var f=new b.MouseRecorderInstance(a);this.instances.push(f),this._setRecordInstance(f)}},adr.MouseRecorder.prototype._setRecordInstance=function(a){var b=__imns("util.classes");return a instanceof b.MouseRecorderInstance?(a.record=!0,this.record||(this.record=!0),!0):!1},adr.MouseRecorder.prototype.endRecord=function(a){var b=this.findInstanceId(a);if(-1!==b){if("number"==typeof b)return this._setEndRecordInstance(this.instances[b]);if(b.length&&"string"!=typeof b){for(var c=0,d=b.length;d>c;c+=1)this._setEndRecordInstance(this.instances[b[c]]);return!0}}return!1},adr.MouseRecorder.prototype._setEndRecordInstance=function(a){var b=__imns("util.classes");if(!(a instanceof b.MouseRecorderInstance))return!1;a.record=!1;for(var c=!1,d=0,e=this.instances.length;e>d;d+=1)if(this.instances[d].record){c=!0;break}c||(this.record=!1)},adr.MouseRecorder.prototype.getX=function(a){if("string"!=typeof a||"click"!==a&&"both"!==a&&"move"!==a){var b=this.findInstanceId(a);if(-1!==b){if("number"==typeof b)return this.findInstance(b).coords.x;if(b.length>1&&"string"!=typeof b){for(var c=b[0].type,d=1,e=b.length;e>d&&(b[d].type!==c&&(c="both"),"both"!==c);d+=1);return this.defaultX(c)}}return this.defaultX()}return this.defaultX(a)},adr.MouseRecorder.prototype.getY=function(a){if("string"!=typeof a||"click"!==a&&"both"!==a&&"move"!==a){var b=this.findInstanceId(a);if(-1!==b){if("number"==typeof b)return this.findInstance(b).coords.y;if(b.length>1&&"string"!=typeof b){for(var c=b[0].type,d=1,e=b.length;e>d&&(b[d].type!==c&&(c="both"),"both"!==c);d+=1);return this.defaultY(c)}}return this.defaultY()}return this.defaultY(a)},adr.MouseRecorder.prototype.getCoordinates=function(a){var b=__imns("util.classes");return new b.Coordinates(this.getX(a),this.getY(a))},adr.MouseRecorder.prototype.defaultX=function(a){return"move"===a?this.move.x:"click"===a?this.down.x:this.x},adr.MouseRecorder.prototype.defaultY=function(a){return"move"===a?this.move.y:"click"===a?this.down.y:this.y},adr.MouseRecorder.prototype.findInstanceId=function(a){var b=__imns("util.classes"),c=__imns("util.validation"),d=0,e=0;if("object"==typeof a&&a instanceof b.MouseRecorderInstance){for(d=0,e=this.instances.length;e>d;d+=1)if(a===this.instances[d])return d;return-1}if("number"==typeof a&&a>-1&&a<this.instances.length)return a;if("object"==typeof a){var f=this.instances,g=[];if("name"in a&&"string"==typeof a.name){for(g=[],d=0,e=f.length;e>d;d+=1)f[d].name===a.name&&g.push(f[d]);f=g}if(0===f.length)return-1;if("element"in a&&"object"==typeof a.element&&void 0!==a.element&&c.isHTMLElement(a.element)){for(g=[],d=0,e=f.length;e>d;d+=1)f[d].element===a.element&&g.push(f[d]);f=g}if(0===f.length)return-1;if("jsObject"in a&&"object"==typeof a.jsObject){for(g=[],d=0,e=f.length;e>d;d+=1)f[d].jsObject===a.jsObject&&g.push(f[d]);f=g}if(0===f.length)return-1;if("type"in a&&"string"==typeof a.type){for(g=[],d=0,e=f.length;e>d;d+=1)f[d].type===a.type&&g.push(f[d]);f=g}if(f.length>1){var h=[];for(d=0,e=f.length;e>d;d+=1)f[d]instanceof b.MouseRecorderInstance&&h.push(this.findInstanceId(f[d]));return 1===h.length?h[0]:h}return 1===f.length&&f[0]instanceof b.MouseRecorderInstance?this.findInstanceId(f[0]):-1}return-1},adr.MouseRecorder.prototype.isInstance=function(a){return-1===this.findInstanceId(a)?!1:!0},adr.MouseRecorder.prototype.findInstance=function(a){var b=this.findInstanceId(a);if(-1===b)return void 0;if("number"==typeof b)return this.instances[b];if("length"in b&&"string"!=typeof b){for(var c=[],d=0,e=b.length;e>d;d+=1)c.push(this.instances[b[d]]);return c.length>1?c:1===c.length?c[0]:void 0}},adr.MouseRecorder.prototype.removeInstance=function(a){var b=__imns("util.classes");return a instanceof b.MouseRecorderInstance?this.removeInstanceFromId(this.findInstanceId(a)):!1},adr.MouseRecorder.prototype.removeInstanceFromId=function(a){return"number"==typeof a&&a>-1&&a<this.instances.length?(this.instances.splice(a,1),!0):!1},adr.MouseRecorder.prototype.compensateForKindle=function(a){var b=__imns("util.validation"),c=__imns("util.tools");return b.isKindle()&&this.isdown?(c.touchprotect(a,!0),!0):!0},adr.MouseRecorder.prototype.nowDown=function(){if(!this.isdown&&null===this.isdown_int){var a=this;this.isdown_int=setTimeout(function(){a.isdown=!0},25)}},adr.MouseRecorder.prototype.nowUp=function(){null!==this.isdown_int&&clearTimeout(this.isdown_int),this.isdown=!1},adr.MouseRecorder.prototype.alwaysRecord=function(){this.setAlwaysRecord()},adr.MouseRecorder.prototype.recorder=function(a,b){var c=0,d=0,e={};if(b=void 0===b||"click"!==b&&"move"!==b?"click":b,this.record||this.getAlwaysRecord()){var f={x:-1,y:-1};if("pageX"in a&&void 0!==a.pageX?(f.x=a.pageX>0?a.pageX:f.x,f.y=a.pageY>0?a.pageY:f.y):(a="originalEvent"in a?a.originalEvent:a,a.touches&&a.touches.length&&a.touches[0].pageX&&void 0!==a.touches[0].pageX?(this.x=a.touches[0].pageX,f.x=a.touches[0].pageX>0?a.touches[0].pageX:f.x,f.y=a.touches[0].pageY>0?a.touches[0].pageY:f.y):a.targetTouches&&a.targetTouches.length&&a.targetTouches[0].pageX&&void 0!==a.targetTouches[0].pageX?(f.x=a.targetTouches[0].pageX>0?a.targetTouches[0].pageX:f.x,f.y=a.targetTouches[0].pageY>0?a.targetTouches[0].pageY:f.y):a.changedTouches&&a.changedTouches.length&&a.changedTouches[0].pageX&&void 0!==a.changedTouches[0].pageX&&(f.x=a.changedTouches[0].pageX>0?a.changedTouches[0].pageX:f.x,f.y=a.changedTouches[0].pageY>0?a.changedTouches[0].pageY:f.y)),-1!==f.x||-1!==f.y)if(this.x=-1!==f.x?f.x:this.x,this.y=-1!==f.y?f.y:this.y,"click"===b)for(this.down.x=-1!==f.x?f.x:this.down.x,this.down.y=-1!==f.y?f.y:this.down.y,c=0,d=this.instances.length;d>c;c+=1)e=this.instances[c],!e.record||"click"!==e.type&&"both"!==e.type||(e.coords.x=this.down.x,e.coords.y=this.down.y);else if("move"===b)for(this.move.x=-1!==f.x?f.x:this.move.x,this.move.y=-1!==f.x?f.y:this.move.y,c=0,d=this.instances.length;d>c;c+=1)e=this.instances[c],!e.record||"move"!==e.type&&"both"!==e.type||(e.coords.x=this.move.x,e.coords.y=this.move.y)}},adr.MouseRecorder.prototype.isOver=function(a){var b=__imns("util.classes"),c=__imns("util.validation"),d=__imns("util.debug");if(void 0!==a&&c.isHTMLElement(a)){var e=new b.BoundaryCoordinates(a),f=null,g="bulls";f="click"===g?new b.Coordinates(this.down.x,this.down.y):"move"===g?new b.Coordinates(this.move.x,this.move.y):new b.Coordinates(this.x,this.y);var h=e.isOver(f);return h}return(new d.IMDebugger).pass("MouseRecorder.isOver must be supplied a HTMLElement"),!1});