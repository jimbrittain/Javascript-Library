"use strict";function DragGlobal(){return void 0!==DragGlobal.prototype.singleton?DragGlobal.prototype.singleton:(DragGlobal.prototype.singleton=this,this.masters=[],this.mri=new MouseRecorderInstance({name:"DragMaster",element:document,type:"both"}),this.mouserecorder=new MouseRecorder,this.mouserecorder.setRecord(this.mri),void this.mouserecorder.alwaysRecord())}function DragMaster(a){void 0===DragMaster.prototype.id&&(DragMaster.prototype.id=0),DragMaster.prototype.id+=1,this.global=new DragGlobal,this.global.add(this),this.id=DragMaster.prototype.id,this.enabled=!0,this.initialised=!1,this.inertiaRate=.7,this.weight=.1,this.bounce=.7,this.codeInt=null,this.position="relative",this._functional=null,this.draggableObjects=[],this._constrain={x:!1,y:!1},this._finishFunction=null,this._startFunction=null,this._bounceFunction=null,this.dragObject=null,this.controlElement=null,this.construct(a)}function DragObject(a){void 0===DragObject.prototype.uid?DragObject.prototype.uid=1:DragObject.prototype.uid+=1,this.uid=DragObject.prototype.uid,this.master=null,this._constrain={x:!1,y:!1},this.controllerElement=null,this.dragElement=null,this.bounce=0,this.inertiaRate=0,this.weight=1,this.lastMouse=new Coordinates(0,0),this.start=new Coordinates(0,0),this.kill={x:!1,y:!1},this.inertia=new Coordinates(0,0),this.dragging=!1,this.moved=!1,this.finished=!0,void 0!==a&&a instanceof DragMaster&&(this.master=a,this.bounce=this.master.bounce,this.inertiaRate=this.master.inertiaRate,this.weight=this.master.weight)}DragGlobal.prototype.add=function(a){if(a instanceof DragMaster){for(var b=!1,c=0,d=this.masters.length;d>c;c+=1)a===this.masters[c]&&(b=!0);if(!b)return this.masters.push(a),!0}return!1},DragGlobal.prototype.disableSelection=function(){fetter(document,"dragstart",function(a){return(new DragGlobal).disableCover(a),!1},!0),fetter(document,"selectstart",function(a){return(new DragGlobal).disableCover(a),!1},!0),fetter(document,"select",function(a){return(new DragGlobal).disableCover(a),!1},!0),fetter(document,"draggesture",function(a){return(new DragGlobal).disableCover(a),!1},!0),fetter(document,"drag",function(a){return(new DragGlobal).disableCover(a),!1},!0),fetter(document,"dragdrop",function(a){return(new DragGlobal).disableCover(a),!1},!0)},DragGlobal.prototype.enableSelection=function(){unfetter(document,"dragstart",function(a){return(new DragGlobal).disableCover(a),!1},!0),unfetter(document,"selectstart",function(a){return(new DragGlobal).disableCover(a),!1},!0),unfetter(document,"select",function(a){return(new DragGlobal).disableCover(a),!1},!0),unfetter(document,"draggesture",function(a){return(new DragGlobal).disableCover(a),!1},!0),unfetter(document,"drag",function(a){return(new DragGlobal).disableCover(a),!1},!0),unfetter(document,"dragdrop",function(a){return(new DragGlobal).disableCover(a),!1},!0)},DragGlobal.prototype.disableCover=function(a){return a||(a=window.event),"stopPropagation"in a&&a.stopPropagation(),"preventDefault"in a&&a.preventDefault(),"cancelBubble"in a&&(a.cancelBubble=!0),"focus"in document.body&&document.body.focus(),"select"in document.body&&document.body.select(),"selection"in document&&document.selection.clear(),a=void 0,!1},DragGlobal.prototype.clearStopControls=function(){unfetter(document,"mouseup",function(a){(new DragGlobal).allStop(a)},!0),unfetter(document,"touchcancel",function(a){(new DragGlobal).allStop(a)},!0),unfetter(document,"touchend",function(a){(new DragGlobal).allStop(a)},!0)},DragGlobal.prototype.initStopControls=function(){fetter(document,"mouseup",function(a){(new DragGlobal).allStop(a)},!0),fetter(document,"touchcancel",function(a){(new DragGlobal).allStop(a)},!0),fetter(document,"touchend",function(a){(new DragGlobal).allStop(a)},!0)},DragGlobal.prototype.allStop=function(){for(var a=0,b=this.masters.length;b>a;a+=1)this.masters[a].stopDrag();this.clearStopControls()},DragMaster.prototype.setPosition=function(a){return a="string"==typeof a?a.toLowerCase():"",this.position="absolute"===a?"absolute":"relative",a===this.position},DragMaster.prototype.addFinishFunction=function(a){return void 0!==a&&"function"==typeof a?(this._finishFunction=a,!0):(this._finishFunction=null,!1)},DragMaster.prototype.addStartFunction=function(a){return void 0!==a&&"function"==typeof a?(this._startFunction=a,!0):(this._startFunction=null,!1)},DragMaster.prototype.addBounceFunction=function(a){return void 0!==a&&"function"==typeof a?(this._bounceFunction=a,!0):(this._bounceFunction=null,!1)},DragMaster.prototype.startFunction=function(){return null!==this._startFunction&&void 0!==this._startFunction&&"function"==typeof this._startFunction?this._startFunction(this):!0},DragMaster.prototype.finishFunction=function(){return null!==this._finishFunction&&void 0!==this._finishFunction&&"function"==typeof this._finishFunction?this._finishFunction(this):!0},DragMaster.prototype.bounceFunction=function(){return null!==this._bounceFunction&&void 0!==this._bounceFunction&&"function"==typeof this._bounceFunction?this._bounceFunction(this):!0},DragMaster.prototype.assignFunctional=function(a){return"function"==typeof a?(this._functional=a,!0):!1},DragMaster.prototype.constrain=function(a,b){void 0!==a&&this.constrainX(a),void 0!==b&&this.constrainY(b)},DragMaster.prototype.constrainX=function(a){if(this._constrain.x=void 0===a||!a&&a?this._constrain.x?!1:!0:a?!0:!1,this.initialised&&this.draggableObjects.length>0)for(var b=0,c=this.draggableObjects.length;c>b;b+=1)this.draggableObjects[b].constrainX(this._constrain.x)},DragMaster.prototype.constrainY=function(a){if(this._constrain.y=void 0===a||!a&&a?this._constrain.y?!1:!0:a?!0:!1,this.initialised&&this.draggableObjects.length>0)for(var b=0,c=this.draggableObjects.length;c>b;b+=1)this.draggableObjects[b].constrainY(this._constrain.y)},DragMaster.prototype.findObjectIndex=function(a){var b=-1;if(a instanceof DragObject)for(var c=0,d=this.draggableObjects.length;d>c;c+=1)if(this.draggableObjects[c]===a){b=c;break}return b},DragMaster.prototype.findIndex=function(a){var b=-1;return a instanceof DragObject?b=this.findObjectIndex(a):isHTMLElement(a)?b=this.findElementIndex(a):"number"==typeof a&&b>0&&b<this.draggableObjects.length&&(b=a),b},DragMaster.prototype.findElementIndex=function(a){var b=-1;if(void 0!==a&&isHTMLElement(a))for(var c=0,d=this.draggableObjects.length;d>c;c+=1)if(this.draggableObjects[c].dragElement===a){b=c;break}return b},DragMaster.prototype.findObject=function(a){var b=this.findIndex(a);return-1!==b?this.draggableObjects[b]:void 0},DragMaster.prototype.objectExists=function(a){return-1===this.findIndex(a)?!1:!0},DragMaster.prototype.elementExists=function(a){return-1===this.findIndex(a)?!1:!0},DragMaster.prototype.setCodeInterval=function(){this.clearCodeInterval();var a=this;this.codeInt=setInterval(function(){a.runMoving()},70)},DragMaster.prototype.clearCodeInterval=function(){null!==this.codeInt&&(clearInterval(this.codeInt),this.codeInt=null)},DragMaster.prototype.construct=function(a){this.initialised=!1,this.controlElement=a instanceof BoundaryCoordinates?a:void 0!==a&&isHTMLElement(a)?new BoundaryCoordinates(a):new BoundaryCoordinates},DragMaster.prototype.isFunctional=function(){return null!==this._functional&&"function"==typeof this._functional?this._functional():this.enabled},DragMaster.prototype.disable=function(){if(this.enabled){this.enabled=!1;for(var a=0,b=this.draggableObjects.length;b>a;a+=1)this.draggableObjects[a].dragElement.style.position="";null!==this.dragObject&&this.stopDrag()}},DragMaster.prototype.reenable=function(){if(!this.enabled){this.enabled=!0;for(var a=0,b=this.draggableObjects.length;b>a;a+=1)this.draggableObjects[a].dragElement.style.position=this.position}},DragMaster.prototype.add=function(a,b){if(void 0!==a&&isHTMLElement(a)&&!this.elementExists(a)){var c=new DragObject(this);if(c=c.init(a,b),c.constrain(this._constrain.x,this._constrain.y),void 0!==c&&c instanceof DragObject)return this.initialised&&c.initRestingControls(),this.draggableObjects.push(c),!0}return!1},DragMaster.prototype.remove=function(a){var b=this.findIndex(a);-1!==b&&(this.draggableObjects[b].clearControls(),this.draggableObjects.splice(b,1))},DragMaster.prototype.destroy=function(){for(null!==this.dragObject&&this.stopDrag();this.draggableObjects.length>0;)this.remove(this.draggableObjects[0]);this.dragObject=null,this.stopDrag()},DragMaster.prototype.defineDragging=function(a){this.dragObject=this.draggableObjects[this.findIndex(a.dragElement)],(new DragGlobal).disableSelection(document);for(var b=0,c=this.draggableObjects.length;c>b;b+=1)this.draggableObjects[b]!==this.dragObject?(this.draggableObjects[b].dragging=!1,(new HTMLClass).removeClass(this.draggableObjects[b].dragElement,"dragging")):(this.stackToTop(this.draggableObjects[b]),this.draggableObjects[b].dragging=!0,(new HTMLClass).addClass(this.draggableObjects[b].dragElement,"dragging"),this.draggableObjects[b].initDrag())},DragMaster.prototype.runMoving=function(){for(var a=!0,b=0,c=this.draggableObjects.length;c>b;b+=1)this.draggableObjects[b].finished||(this.draggableObjects[b].run(),a=!1);a&&this.clearCodeInterval(),a=void 0},DragMaster.prototype.finishedMoving=function(){for(var a=!0,b=0,c=this.draggableObjects.length;c>b;b+=1)if(!this.draggableObjects[b].finished){a=!1;break}return a},DragMaster.prototype.init=function(){if(this.enabled&&!this.initialised&&this.draggableObjects.length>0){this.initialised=!0;for(var a=0,b=this.draggableObjects.length;b>a;a+=1)this.draggableObjects[a].initRestingControls();return!0}return!1},DragMaster.prototype.refresh=DragMaster.prototype.init,DragMaster.prototype.stackToTop=function(a){var b=this.findObjectIndex(a);if(-1!==b){var c=this.draggableObjects[b];this.draggableObjects.splice(b,1),this.draggableObjects.push(c),this.resolveStacking()}},DragMaster.prototype.resolveStacking=function(){for(var a=0;a<this.draggableObjects.length;a+=1)isHTMLElement(this.draggableObjects[a].dragElement)?this.draggableObjects[a].dragElement.style.zIndex=1e3+a:(this.remove(this.draggableObjects[a]),a-=1)},DragMaster.prototype.stopDrag=function(){if(null!==this.dragObject){for(var a=0,b=this.draggableObjects.length;b>a;a+=1)this.draggableObjects[a].dragging=!1;new SupportedCSSProperty("box-shadow").exists&&(this.dragObject.dragElement.style[new SupportedCSSProperty("box-shadow").cssProperty]="0 0 0 rgba(0,0,0,0)"),this.finishFunction(),this.dragObject.initRestingControls(),(new DragGlobal).enableSelection(),(new HTMLClass).removeClass(this.dragObject.dragElement,"dragging"),this.dragObject=null}},DragObject.prototype.init=function(a){if(void 0!==a&&isHTMLElement(a)){this.dragElement=a,this.controllerElement=arguments.length>1&&null!==arguments[1]&&isHTMLElement(arguments[1])?arguments[1]:a,this.start.x=findElementStyle(this.dragElement,"offsetLeft"),this.start.y=findElementStyle(this.dragElement,"offsetTop");var b=new Coordinates("0","0");return"absolute"===this.master.position&&this.dragElement.style.position!==this.master.position&&"parentNode"in this.dragElement&&(b.x-=Number(findElementStyle(this.dragElement.parentNode,"offsetLeft")),b.y-=Number(findElementStyle(this.dragElement.parentNode,"offsetTop"))),this.dragElement.style.position=this.master.position,""===this.dragElement.style.left&&(this.dragElement.style.left=isNaN(b.x)?b.x:"0px"),""===this.dragElement.style.top&&(this.dragElement.style.top=isNaN(b.y)?b.y:"0px"),this}return void 0},DragObject.prototype.beginDrag=function(){this.master.isFunctional()&&this.master.enabled&&(new SupportedCSSProperty("box-shadow").exists&&(new SupportedCSSProperty("transition").exists&&(this.dragElement.style[new SupportedCSSProperty("transition").cssProperty]=new SupportedCSSProperty("box-shadow").cssProperty+" 400ms"),this.dragElement.style[new SupportedCSSProperty("box-shadow").cssProperty]="-4px 4px 7px rgba(0,0,0,0.05)"),this.master.defineDragging(this))},DragObject.prototype.initDrag=function(){this.moved=!1,this.finished=!1,this.lastMouse=new Coordinates((new DragGlobal).mouserecorder.x,(new DragGlobal).mouserecorder.y),this.start.x=parseFloat(measure(this.dragElement.style.left,"px",this.dragElement))-findElementStyle(this.dragElement,"offsetLeft"),this.start.y=parseFloat(measure(this.dragElement.style.top,"px",this.dragElement))-findElementStyle(this.dragElement,"offsetTop"),this.inertia=new Coordinates(0,0),this.initActiveControls(),this.master.startFunction(),this.master.setCodeInterval()},DragObject.prototype.calculateInertia=function(a){if(isNaN(a))return 0;var b=a*this.inertiaRate;return isNaN(b)?0:b},DragObject.prototype.constrain=function(a,b){void 0!==a&&this.constrainX(a),void 0!==b&&this.constrainY(b)},DragObject.prototype.constrainX=function(a){return this._constrain.x=void 0===a||!a&&a?this._constrain.x?!1:!0:a?!0:!1,this._constrain.x},DragObject.prototype.constrainY=function(a){return this._constrain.y=void 0===a||!a&&a?this._constrain.y?!1:!0:a?!0:!1,this._constrain.y},DragObject.prototype.calculateChange=function(){var a=new Coordinates(0,0);if(this.dragging&&this.master.dragObject===this){switch(a.x=((new DragGlobal).mouserecorder.x-this.lastMouse.x)*this.weight,a.y=((new DragGlobal).mouserecorder.y-this.lastMouse.y)*this.weight,this.kill.x){case"positive":a.x=(new DragGlobal).mouserecorder.x>this.lastMouse.x?0:a.x;break;case"negative":a.x=(new DragGlobal).mouserecorder.x<this.lastMouse.x?0:a.x}switch(this.kill.y){case"positive":a.y=(new DragGlobal).mouserecorder.y>this.lastMouse.y?0:a.y;break;case"negative":a.y=(new DragGlobal).mouserecorder.y<this.lastMouse.y?0:a.y}this.lastMouse.x=(new DragGlobal).mouserecorder.x,this.lastMouse.y=(new DragGlobal).mouserecorder.y}return a.x+=this.inertia.x,a.y+=this.inertia.y,this.inertia.x=this.calculateInertia(a.x),this.inertia.y=this.calculateInertia(a.y),a},DragObject.prototype.clearControls=function(){{var a=this;this.master}(new DragGlobal).clearStopControls(),unfetter(this.controllerElement,"mousedown",function(b){a.beginDrag(b)},!0),unfetter(this.controllerElement,"touchstart",function(b){a.beginDrag(b)},!0)},DragObject.prototype.initActiveControls=function(){{var a=this;this.master}unfetter(this.controllerElement,"mousedown",function(b){a.beginDrag(b)},!0),unfetter(this.controllerElement,"touchstart",function(b){a.beginDrag(b)},!0),(new DragGlobal).initStopControls()},DragObject.prototype.initRestingControls=function(){var a=this,b=(this.master,function(b){a.beginDrag(b),a.uid=Number(a.uid)});fetter(this.controllerElement,"mousedown",b,!0),fetter(this.controllerElement,"touchstart",b,!0),(new DragGlobal).clearStopControls()},DragObject.prototype.resolveChange=function(a,b,c,d,e,f){var g=a+e,h=b+e,i=!1,j=!1,k=0,l=!1;g>=c&&d>=h&&(i=!1);do if(k>1&&(j=!0),g>=c&&d>=h)a=g,b=h,j=!0;else{l=!0;var m=0,n=0;c>g?(m=g-c,0>f&&(f*=-1),i="negative"):(m=h-d,f>0&&(f*=-1),i="positive"),n=e-m,n*=this.master.bounce,f*=this.master.bounce,g-=m,g-=n,g=Math.floor(g),h=g+(b-a),k+=1}while(!j);var o={d1:Math.round(a),d2:Math.round(b),inertia:f,kill:i};return l&&this.master.bounceFunction(),o},DragObject.prototype.run=function(){var a=this.calculateChange(),b=new BoundaryCoordinates({left:findElementStyle(this.dragElement,"offsetLeft"),top:findElementStyle(this.dragElement,"offsetTop"),width:findElementStyle(this.dragElement,"offsetWidth"),height:findElementStyle(this.dragElement,"offsetHeight")}),c=this.resolveChange(b.x1,b.x2,this.master.controlElement.getX1(),this.master.controlElement.getX2(),a.x,this.inertia.x),d=this.resolveChange(b.y1,b.y2,this.master.controlElement.getY1(),this.master.controlElement.getY2(),a.y,this.inertia.y);this.kill.x=c.kill,this.kill.y=d.kill,this.inertia.x=c.inertia,this.inertia.y=d.inertia,c.d1===b.x1&&d.d1===b.y1?this.moved||this.dragging?this.moved=!1:this.finished=!0:(this.moved=!0,this.finished=!1,this._constrain.x||(this.dragElement.style.left=c.d1+this.start.x+"px"),this._constrain.y||(this.dragElement.style.top=d.d1+this.start.y+"px"))};