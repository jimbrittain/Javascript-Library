"use strict";var adr=__imns("component.classes");"DragGlobal"in adr||(adr.DragGlobal=function(){var a=__imns("component.classes"),b=__imns("util.classes");return void 0!==a.DragGlobal.prototype.singleton?a.DragGlobal.prototype.singleton:(a.DragGlobal.prototype.singleton=this,this.masters=[],this.mri=new b.MouseRecorderInstance({name:"DragMaster",element:document,type:"both"}),this.mouserecorder=new b.MouseRecorder,this.mouserecorder.setRecord(this.mri),void this.mouserecorder.alwaysRecord())},adr.DragGlobal.prototype.add=function(a){var b=__imns("component.classes");if(a instanceof b.DragMaster){for(var c=!1,d=0,e=this.masters.length;e>d;d+=1)a===this.masters[d]&&(c=!0);if(!c)return this.masters.push(a),!0}return!1},adr.DragGlobal.prototype.findDragMasterFromElement=function(a){var b=__imns("util.validation"),c=__imns("component.classes"),d=-1;if(void 0!==a&&b.isHTMLElement(a))for(var e=0,f=this.masters.length;f>e;e+=1)for(var g=this.masters[e].draggableObjects.length-1;g>-1;g-=1){var h=this.masters[e].draggableObjects[g];if(h.controllerElement===a||h.dragElement===a){d=this.masters[e];break}}return-1!==d&&d instanceof c.DragMaster?d:null},adr.DragGlobal.prototype.findDragObjectFromElement=function(a){var b=__imns("util.validation"),c=__imns("component.classes"),d=-1;if(void 0!==a&&b.isHTMLElement(a))for(var e=0,f=this.masters.length;f>e;e+=1)for(var g=this.masters[e].draggableObjects.length-1;g>-1;g-=1){var h=this.masters[e].draggableObjects[g];if(h.controllerElement===a||h.dragElement===a){d=h;break}}return-1!==d&&d instanceof c.DragObject?d:null},adr.DragGlobal.prototype.disableSelection=function(){var a=__imns("util.tools"),b=__imns("component.classes"),c=this;a.fetter(document,"dragstart",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.fetter(document,"selectstart",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.fetter(document,"select",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.fetter(document,"draggesture",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.fetter(document,"drag",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.fetter(document,"dragdrop",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0)},adr.DragGlobal.prototype.enableSelection=function(){var a=__imns("util.tools"),b=__imns("component.classes"),c=this;a.unfetter(document,"dragstart",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.unfetter(document,"selectstart",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.unfetter(document,"select",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.unfetter(document,"draggesture",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.unfetter(document,"drag",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0),a.unfetter(document,"dragdrop",[c,function(a){return(new b.DragGlobal).disableCover(a),!1}],!0)},adr.DragGlobal.prototype.disableCover=function(a){return a||(a=window.event),"stopPropagation"in a&&a.stopPropagation(),"preventDefault"in a&&a.preventDefault(),"cancelBubble"in a&&(a.cancelBubble=!0),"focus"in document.body&&document.body.focus(),"select"in document.body&&document.body.select(),"selection"in document&&document.selection.clear(),a=void 0,!1},adr.DragGlobal.prototype.clearStopControls=function(){var a=__imns("util.tools"),b=__imns("component.classes"),c=this;a.unfetter(document,"mouseup",[c,function(a){(new b.DragGlobal).allStop(a)}],!0),a.unfetter(document,"touchcancel",[c,function(a){(new b.DragGlobal).allStop(a)}],!0),a.unfetter(document,"touchend",[c,function(a){(new b.DragGlobal).allStop(a)}],!0)},adr.DragGlobal.prototype.initStopControls=function(){var a=__imns("util.tools"),b=__imns("component.classes"),c=this;a.fetter(document,"mouseup",[c,function(a){(new b.DragGlobal).allStop(a)}],!0),a.fetter(document,"touchcancel",[c,function(a){(new b.DragGlobal).allStop(a)}],!0),a.fetter(document,"touchend",[c,function(a){(new b.DragGlobal).allStop(a)}],!0)},adr.DragGlobal.prototype.allStop=function(){for(var a=0,b=this.masters.length;b>a;a+=1)this.masters[a].stopDrag();this.clearStopControls()},adr.DragMaster=function(a){var b=__imns("component.classes");void 0===b.DragMaster.prototype.id&&(b.DragMaster.prototype.id=0),b.DragMaster.prototype.id+=1,this.global=new b.DragGlobal,this.global.add(this),this.id=b.DragMaster.prototype.id,this.enabled=!0,this.initialised=!1,this.inertiaRate=.7,this.weight=.1,this.bounce=.7,this.codeInt=null,this.position="relative",this._functional=null,this.draggableObjects=[],this._constrain={x:!1,y:!1},this._finishFunction=null,this._startFunction=null,this._bounceFunction=null,this.dragObject=null,this.controlElement=null,this.construct(a)},adr.DragMaster.prototype.setPosition=function(a){return a="string"==typeof a?a.toLowerCase():"",this.position="absolute"===a?"absolute":"relative",a===this.position},adr.DragMaster.prototype.addFinishFunction=function(a){return void 0!==a&&"function"==typeof a?(this._finishFunction=a,!0):(this._finishFunction=null,!1)},adr.DragMaster.prototype.addStartFunction=function(a){return void 0!==a&&"function"==typeof a?(this._startFunction=a,!0):(this._startFunction=null,!1)},adr.DragMaster.prototype.addBounceFunction=function(a){return void 0!==a&&"function"==typeof a?(this._bounceFunction=a,!0):(this._bounceFunction=null,!1)},adr.DragMaster.prototype.startFunction=function(){return null!==this._startFunction&&void 0!==this._startFunction&&"function"==typeof this._startFunction?this._startFunction(this):!0},adr.DragMaster.prototype.finishFunction=function(){return null!==this._finishFunction&&void 0!==this._finishFunction&&"function"==typeof this._finishFunction?this._finishFunction(this):!0},adr.DragMaster.prototype.bounceFunction=function(){return null!==this._bounceFunction&&void 0!==this._bounceFunction&&"function"==typeof this._bounceFunction?this._bounceFunction(this):!0},adr.DragMaster.prototype.assignFunctional=function(a){return"function"==typeof a?(this._functional=a,!0):!1},adr.DragMaster.prototype.constrain=function(a,b){void 0!==a&&this.constrainX(a),void 0!==b&&this.constrainY(b)},adr.DragMaster.prototype.constrainX=function(a){if(this._constrain.x=void 0===a||!a&&a?this._constrain.x?!1:!0:a?!0:!1,this.initialised&&this.draggableObjects.length>0)for(var b=0,c=this.draggableObjects.length;c>b;b+=1)this.draggableObjects[b].constrainX(this._constrain.x)},adr.DragMaster.prototype.constrainY=function(a){if(this._constrain.y=void 0===a||!a&&a?this._constrain.y?!1:!0:a?!0:!1,this.initialised&&this.draggableObjects.length>0)for(var b=0,c=this.draggableObjects.length;c>b;b+=1)this.draggableObjects[b].constrainY(this._constrain.y)},adr.DragMaster.prototype.findObjectIndex=function(a){var b=__imns("component.classes"),c=-1;if(a instanceof b.DragObject)for(var d=0,e=this.draggableObjects.length;e>d;d+=1)if(this.draggableObjects[d]===a){c=d;break}return c},adr.DragMaster.prototype.findIndex=function(a){var b=__imns("component.classes"),c=__imns("util.validation"),d=-1;return a instanceof b.DragObject?d=this.findObjectIndex(a):c.isHTMLElement(a)?d=this.findElementIndex(a):"number"==typeof a&&d>0&&d<this.draggableObjects.length&&(d=a),d},adr.DragMaster.prototype.findElementIndex=function(a){var b=__imns("util.validation"),c=-1;if(void 0!==a&&b.isHTMLElement(a))for(var d=0,e=this.draggableObjects.length;e>d;d+=1)if(this.draggableObjects[d].dragElement===a){c=d;break}return c},adr.DragMaster.prototype.findObject=function(a){var b=this.findIndex(a);return-1!==b?this.draggableObjects[b]:void 0},adr.DragMaster.prototype.objectExists=function(a){return-1===this.findIndex(a)?!1:!0},adr.DragMaster.prototype.elementExists=function(a){return-1===this.findIndex(a)?!1:!0},adr.DragMaster.prototype.setCodeInterval=function(){this.clearCodeInterval();var a=this;this.codeInt=setInterval(function(){a.runMoving()},70)},adr.DragMaster.prototype.clearCodeInterval=function(){null!==this.codeInt&&(clearInterval(this.codeInt),this.codeInt=null)},adr.DragMaster.prototype.construct=function(a){var b=__imns("util.classes"),c=__imns("util.validation");this.initialised=!1,this.controlElement=a instanceof b.BoundaryCoordinates?a:void 0!==a&&c.isHTMLElement(a)?new b.BoundaryCoordinates(a):new b.BoundaryCoordinates},adr.DragMaster.prototype.isFunctional=function(){return null!==this._functional&&"function"==typeof this._functional?this._functional():this.enabled},adr.DragMaster.prototype.disable=function(){if(this.enabled){this.enabled=!1;for(var a=0,b=this.draggableObjects.length;b>a;a+=1)this.draggableObjects[a].dragElement.style.position="";null!==this.dragObject&&this.stopDrag()}},adr.DragMaster.prototype.reenable=function(){if(!this.enabled){this.enabled=!0;for(var a=0,b=this.draggableObjects.length;b>a;a+=1)this.draggableObjects[a].dragElement.style.position=this.position}},adr.DragMaster.prototype.add=function(a,b){var c=__imns("component.classes"),d=__imns("util.validation");if(void 0!==a&&d.isHTMLElement(a)&&!this.elementExists(a)){var e=new c.DragObject(this);if(e=e.init(a,b),e.constrain(this._constrain.x,this._constrain.y),void 0!==e&&e instanceof c.DragObject)return this.initialised&&e.initRestingControls(),this.draggableObjects.push(e),!0}return!1},adr.DragMaster.prototype.remove=function(a){var b=this.findIndex(a);-1!==b&&(this.draggableObjects[b].clearControls(),this.draggableObjects.splice(b,1))},adr.DragMaster.prototype.destroy=function(){for(null!==this.dragObject&&this.stopDrag();this.draggableObjects.length>0;)this.remove(this.draggableObjects[0]);this.dragObject=null,this.stopDrag()},adr.DragMaster.prototype.defineDragging=function(a){var b=__imns("component.classes"),c=__imns("util.classes");this.dragObject=this.draggableObjects[this.findIndex(a.dragElement)],(new b.DragGlobal).disableSelection(document);for(var d=0,e=this.draggableObjects.length;e>d;d+=1)this.draggableObjects[d]!==this.dragObject?(this.draggableObjects[d].dragging=!1,(new c.HTMLClass).removeClass(this.draggableObjects[d].dragElement,"dragging")):(this.stackToTop(this.draggableObjects[d]),this.draggableObjects[d].dragging=!0,(new c.HTMLClass).addClass(this.draggableObjects[d].dragElement,"dragging"),this.draggableObjects[d].initDrag())},adr.DragMaster.prototype.runMoving=function(){for(var a=!0,b=0,c=this.draggableObjects.length;c>b;b+=1)this.draggableObjects[b].finished||(this.draggableObjects[b].run(),a=!1);a&&this.clearCodeInterval(),a=void 0},adr.DragMaster.prototype.finishedMoving=function(){for(var a=!0,b=0,c=this.draggableObjects.length;c>b;b+=1)if(!this.draggableObjects[b].finished){a=!1;break}return a},adr.DragMaster.prototype.init=function(){if(this.enabled&&!this.initialised&&this.draggableObjects.length>0){this.initialised=!0;for(var a=0,b=this.draggableObjects.length;b>a;a+=1)this.draggableObjects[a].initRestingControls();return!0}return!1},adr.DragMaster.prototype.refresh=adr.DragMaster.prototype.init,adr.DragMaster.prototype.stackToTop=function(a){var b=this.findObjectIndex(a);if(-1!==b){var c=this.draggableObjects[b];this.draggableObjects.splice(b,1),this.draggableObjects.push(c),this.resolveStacking()}},adr.DragMaster.prototype.resolveStacking=function(){for(var a=__imns("util.validation"),b=0;b<this.draggableObjects.length;b+=1)a.isHTMLElement(this.draggableObjects[b].dragElement)?this.draggableObjects[b].dragElement.style.zIndex=1e3+b:(this.remove(this.draggableObjects[b]),b-=1)},adr.DragMaster.prototype.stopDrag=function(){var a=__imns("util.classes"),b=__imns("component.classes");if(null!==this.dragObject){for(var c=0,d=this.draggableObjects.length;d>c;c+=1)this.draggableObjects[c].dragging=!1;new a.SupportedCSSProperty("box-shadow").exists&&(this.dragObject.dragElement.style[new a.SupportedCSSProperty("box-shadow").cssProperty]="0 0 0 rgba(0,0,0,0)"),this.finishFunction(),this.dragObject.initRestingControls(),(new b.DragGlobal).enableSelection(),(new a.HTMLClass).removeClass(this.dragObject.dragElement,"dragging"),this.dragObject=null}},adr.DragObject=function(a){var b=__imns("component.classes"),c=__imns("util.classes");void 0===b.DragObject.prototype.uid?b.DragObject.prototype.uid=1:b.DragObject.prototype.uid+=1,this.uid=b.DragObject.prototype.uid,this.master=null,this._constrain={x:!1,y:!1},this.controllerElement=null,this.dragElement=null,this.bounce=0,this.inertiaRate=0,this.weight=1,this.lastMouse=new c.Coordinates(0,0),this.start=new c.Coordinates(0,0),this.kill={x:!1,y:!1},this.inertia=new c.Coordinates(0,0),this.dragging=!1,this.moved=!1,this.finished=!0,void 0!==a&&a instanceof b.DragMaster&&(this.master=a,this.bounce=this.master.bounce,this.inertiaRate=this.master.inertiaRate,this.weight=this.master.weight)},adr.DragObject.prototype.init=function(a){var b=__imns("util.validation"),c=__imns("util.classes"),d=__imns("util.dom");if(void 0!==a&&b.isHTMLElement(a)){this.dragElement=a,this.controllerElement=arguments.length>1&&null!==arguments[1]&&b.isHTMLElement(arguments[1])?arguments[1]:a,this.start.x=d.findElementStyle(this.dragElement,"offsetLeft"),this.start.y=d.findElementStyle(this.dragElement,"offsetTop");var e=new c.Coordinates("0","0");return"absolute"===this.master.position&&this.dragElement.style.position!==this.master.position&&"parentNode"in this.dragElement&&(e.x-=Number(d.findElementStyle(this.dragElement.parentNode,"offsetLeft")),e.y-=Number(d.findElementStyle(this.dragElement.parentNode,"offsetTop"))),this.dragElement.style.position=this.master.position,""===this.dragElement.style.left&&(this.dragElement.style.left=isNaN(e.x)?e.x:"0px"),""===this.dragElement.style.top&&(this.dragElement.style.top=isNaN(e.y)?e.y:"0px"),this}return void 0},adr.DragObject.prototype.beginDrag=function(){var a=__imns("util.classes");this.master.isFunctional()&&this.master.enabled&&(new a.SupportedCSSProperty("box-shadow").exists&&(new a.SupportedCSSProperty("transition").exists&&(this.dragElement.style[new a.SupportedCSSProperty("transition").cssProperty]=new a.SupportedCSSProperty("box-shadow").cssProperty+" 400ms"),this.dragElement.style[new a.SupportedCSSProperty("box-shadow").cssProperty]="-4px 4px 7px rgba(0,0,0,0.05)"),this.master.defineDragging(this))},adr.DragObject.prototype.initDrag=function(){var a=__imns("component.classes"),b=(__imns("util.validation"),__imns("util.dom")),c=__imns("util.tools"),d=__imns("util.classes");this.moved=!1,this.finished=!1,this.lastMouse=new d.Coordinates((new a.DragGlobal).mouserecorder.x,(new a.DragGlobal).mouserecorder.y),this.start.x=parseFloat(c.measure(this.dragElement.style.left,"px",this.dragElement))-b.findElementStyle(this.dragElement,"offsetLeft"),this.start.y=parseFloat(c.measure(this.dragElement.style.top,"px",this.dragElement))-b.findElementStyle(this.dragElement,"offsetTop"),this.inertia=new d.Coordinates(0,0),this.initActiveControls(),this.master.startFunction(),this.master.setCodeInterval()},adr.DragObject.prototype.calculateInertia=function(a){if(isNaN(a))return 0;var b=a*this.inertiaRate;return isNaN(b)?0:b},adr.DragObject.prototype.constrain=function(a,b){void 0!==a&&this.constrainX(a),void 0!==b&&this.constrainY(b)},adr.DragObject.prototype.constrainX=function(a){return this._constrain.x=void 0===a||!a&&a?this._constrain.x?!1:!0:a?!0:!1,this._constrain.x},adr.DragObject.prototype.constrainY=function(a){return this._constrain.y=void 0===a||!a&&a?this._constrain.y?!1:!0:a?!0:!1,this._constrain.y},adr.DragObject.prototype.calculateChange=function(){var a=__imns("util.classes"),b=__imns("component.classes"),c=new a.Coordinates(0,0);if(this.dragging&&this.master.dragObject===this){switch(c.x=((new b.DragGlobal).mouserecorder.x-this.lastMouse.x)*this.weight,c.y=((new b.DragGlobal).mouserecorder.y-this.lastMouse.y)*this.weight,this.kill.x){case"positive":c.x=(new b.DragGlobal).mouserecorder.x>this.lastMouse.x?0:c.x;break;case"negative":c.x=(new b.DragGlobal).mouserecorder.x<this.lastMouse.x?0:c.x}switch(this.kill.y){case"positive":c.y=(new b.DragGlobal).mouserecorder.y>this.lastMouse.y?0:c.y;break;case"negative":c.y=(new b.DragGlobal).mouserecorder.y<this.lastMouse.y?0:c.y}this.lastMouse.x=(new b.DragGlobal).mouserecorder.x,this.lastMouse.y=(new b.DragGlobal).mouserecorder.y}return c.x+=this.inertia.x,c.y+=this.inertia.y,this.inertia.x=this.calculateInertia(c.x),this.inertia.y=this.calculateInertia(c.y),c},adr.DragObject.prototype.clearControls=function(){{var a=__imns("util.tools"),b=__imns("component.classes"),c=this;this.master}(new b.DragGlobal).clearStopControls(),a.unfetter(this.controllerElement,"mousedown",[c,function(a){c.beginDrag(a)}],!0),a.unfetter(this.controllerElement,"touchstart",[c,function(a){c.beginDrag(a)}],!0)},adr.DragObject.prototype.initActiveControls=function(){{var a=__imns("util.tools"),b=__imns("component.classes"),c=this;this.master}a.unfetter(this.controllerElement,"mousedown",[c,function(a){c.beginDrag(a)}],!0),a.unfetter(this.controllerElement,"touchstart",[c,function(a){c.beginDrag(a)}],!0),(new b.DragGlobal).initStopControls()},adr.DragObject.prototype.initRestingControls=function(){var a=__imns("component.classes"),b=__imns("util.tools"),c=this,d=(this.master,function(b){var d="srcElement"in b?b.srcElement:"target"in b?b.target:c.controllerElement,e=(new a.DragGlobal).findDragObjectFromElement(d);c=null!==e&&c!==e?e:c,c.beginDrag(b),c.uid=Number(c.uid)});b.fetter(this.controllerElement,"mousedown",[c,d],!0),b.fetter(this.controllerElement,"touchstart",[c,d],!0),(new a.DragGlobal).clearStopControls()},adr.DragObject.prototype.resolveChange=function(a,b,c,d,e,f){var g=a+e,h=b+e,i=!1,j=!1,k=0,l=!1;g>=c&&d>=h&&(i=!1);do if(k>1&&(j=!0),g>=c&&d>=h)a=g,b=h,j=!0;else{l=!0;var m=0,n=0;c>g?(m=g-c,0>f&&(f*=-1),i="negative"):(m=h-d,f>0&&(f*=-1),i="positive"),n=e-m,n*=this.master.bounce,f*=this.master.bounce,g-=m,g-=n,g=Math.floor(g),h=g+(b-a),k+=1}while(!j);var o={d1:Math.round(a),d2:Math.round(b),inertia:f,kill:i};return l&&this.master.bounceFunction(),o},adr.DragObject.prototype.run=function(){var a=__imns("util.classes"),b=__imns("util.dom"),c=this.calculateChange(),d=new a.BoundaryCoordinates({left:b.findElementStyle(this.dragElement,"offsetLeft"),top:b.findElementStyle(this.dragElement,"offsetTop"),width:b.findElementStyle(this.dragElement,"offsetWidth"),height:b.findElementStyle(this.dragElement,"offsetHeight")}),e=this.resolveChange(d.x1,d.x2,this.master.controlElement.getX1(),this.master.controlElement.getX2(),c.x,this.inertia.x),f=this.resolveChange(d.y1,d.y2,this.master.controlElement.getY1(),this.master.controlElement.getY2(),c.y,this.inertia.y);this.kill.x=e.kill,this.kill.y=f.kill,this.inertia.x=e.inertia,this.inertia.y=f.inertia,e.d1===d.x1&&f.d1===d.y1?this.moved||this.dragging?this.moved=!1:this.finished=!0:(this.moved=!0,this.finished=!1,this._constrain.x||(this.dragElement.style.left=e.d1+this.start.x+"px"),this._constrain.y||(this.dragElement.style.top=f.d1+this.start.y+"px"))});