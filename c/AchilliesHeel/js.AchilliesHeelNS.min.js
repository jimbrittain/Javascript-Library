"use strict";var adr=__imns("component.classes");"AchilliesHeel"in adr||(adr.AchilliesHeel=function(a,b){var c=__imns("component.classes"),d=__imns("util.classes");return void 0!==c.AchilliesHeel.prototype.singleton?c.AchilliesHeel.prototype.singleton:(c.AchilliesHeel.prototype.singleton=this,this.element=null,this.lastY=0,this.fixedElement=null,this.initialized=!1,this.active=!1,this.method="absolute",this.offset=-100,this._overlap="waiting",this._suspend=null,this._activate=null,this.scr=new d.ScreenProperties,void this.init(a,b))},adr.AchilliesHeel.prototype.overlap=function(a){var b=__imns("util.validation"),c=__imns("util.tools"),d=__imns("util.dom");if(a=void 0===a?"a":a,!b.isNumber(a)){if("waiting"===this._overlap){if(b.isHTMLElement(this.element)){var e=d.findElementStyle(this.element,"bottom");return e=c.measure(e,"px",this.element),e=parseFloat(e),this._overlap=e,this._overlap}return 0}return this._overlap}this._overlap=a},adr.AchilliesHeel.prototype.setElement=function(a){var b=__imns("util.validation");return!(void 0===a||!b.isHTMLElement(a)||(this.element=a,this.reinitialize(),a!==this.element))},adr.AchilliesHeel.prototype.setFixedElement=function(a){var b=__imns("util.validation");return!(void 0===a||!b.isHTMLElement(a)||(this.fixedElement=a,this.reinitialize(),a!==this.fixedElement))},adr.AchilliesHeel.prototype.reinitialize=function(){this.initialized&&(this.initialized=!1,this.build())},adr.AchilliesHeel.prototype.setActivate=function(a){return void 0!==a&&"function"==typeof a&&(this._activate=a),a===this._activate},adr.AchilliesHeel.prototype.activate=function(){return!(this.active||!this.initialized)&&(this.active=!0,null!==this._activate&&"function"==typeof this._activate&&this._activate(this),!0)},adr.AchilliesHeel.prototype.setSuspend=function(a){return void 0!==a&&"function"==typeof a&&(this._suspend=a),a===this._suspend},adr.AchilliesHeel.prototype.suspend=function(){return!!this.active&&(this.active=!1,null!==this._suspend&&"function"==typeof this._suspend&&this._suspend(this),!0)},adr.AchilliesHeel.prototype.calculateHeightOffset=function(){var a=__imns("util.dom"),b=__imns("component.classes"),c=__imns("util.tools"),d=__imns("util.validation"),e=a.findElementStyle(this.element,"offsetTop"),f=this.scr.innerWindowHeight();return e=parseFloat(e)-parseFloat(f),d.isNumber(e)||(e=c.measure(parseFloat(a.findElementStyle(this.element,"height")),"px",this.element),e-=this.overlap()),b.AchilliesHeel.offset=e,this.offset},adr.AchilliesHeel.prototype.isBaseLocked=function(){var a=__imns("util.dom"),b=__imns("util.classes"),c=a.findElementStyle(this.element,"position"),d="absolute"!==c?parseFloat(this.scr.offsetY()):0,e=a.findElementStyle(this.element,"offsetTop"),f=a.findElementStyle(this.fixedElement,"offsetTop");if("static"!==a.findElementStyle(this.element,"position"))return e+d>=f;var g=parseFloat(this.scr.innerWindowHeight()),h=parseFloat(new b.BoundaryCoordinates(this.fixedElement).y1);if(d+g<h)return!1;var i=parseFloat(new b.BoundaryCoordinates(this.element).height),j=d+g-(i+this.offset);return!(j<h)},adr.AchilliesHeel.prototype.fixedBaseLock=function(){if(this.active){var a=this.isBaseLocked()?"content":"fixed",b=this.element.style.position;switch(a){case"fixed":"static"===b&&(this.element.style.position="fixed"===this.method?"fixed":"absolute");break;case"content":"static"!==b&&(this.element.style.position="static")}}},adr.AchilliesHeel.prototype.jsMethod=function(){var a=__imns("component.classes");if(this.active){this.fixedBaseLock();var b=this.scr.getPageBounds(),c=b.top+b.height-a.AchilliesHeel.prototype.heightOffset;this.element.style.top=c+"px"}},adr.AchilliesHeel.prototype.runMethod=adr.AchilliesHeel.prototype.fixedBaseLock,adr.AchilliesHeel.prototype.init=function(a,b){this.setElement(a),this.setFixedElement(b);var c=this;__imns("util.tools").fetter(window,"load",function(){c.build()},!0,"after")},adr.AchilliesHeel.prototype.setBaseOffset=function(a){if(this.offset=-a,this.initialized);},adr.AchilliesHeel.prototype.build=function(){var a=__imns("component.classes"),b=__imns("util.tools"),c=__imns("util.classes"),d=__imns("util.dom"),e=this,f=d.findElementStyle(this.element,"position");if(void 0===a.AchilliesHeel.prototype.heightOffset&&this.calculateHeightOffset(),"fixed"!==f)if("absolute"!==f){this.element.style.position="absolute";var g=parseFloat(new c.BoundaryCoordinates(this.element).height);this.element.style.height=g-this.offset+"px",a.AchilliesHeel.prototype.runMethod=a.AchilliesHeel.prototype.jsMethod,this.method="absolute",this.jsMethod()}else{var h="expression(((document.documentElement.scrollTop) ? document.documentElement.scrollTop : document.body.scrollTop) + this.offset)";this.element.style.bottom=h}else this.method="fixed";b.fetter(window,"scroll",[e,function(){var a=e.scr.offsetY();a!==e.lastY&&e.runMethod(),e.lastY=a}],!0),this.initialized=!0,this.activate()});