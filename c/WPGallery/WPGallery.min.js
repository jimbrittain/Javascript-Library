"use strict";var adr=__imns("component.classes");"WPGallery"in adr||(adr.prepareWPGalleries=function(){var a=(__imns("component.vars"),__imns("util.tools")),b=__imns("util.dom");a.fetter(document,"DOMContentLoaded",["prepareWPGalleries",function(){var a=b.findElementsByClass("wpgallery"),c=__imns("component.vars"),d=__imns("component.classes");"ajaxObject"in window&&"wpgalleryajl"in window.ajaxObject&&(c.wpgalleryajl=window.ajaxObject.wpgalleryajl),"wpgalleries"in c||(c.wpgalleries=[]);for(var e=0,f=a.length;e<f;e+=1){var g=a[e],h=b.getAttribute(g,"id");c.wpgalleries.push(new d.WPGallery({id:h}))}}],!0,"after")},adr.WPGallery=function(a){var b=__imns("component.classes"),c=__imns("component.vars");return void 0===b.WPGallery.prototype.galleries&&(b.WPGallery.prototype.galleries=[]),(""===b.WPGallery.prototype.ajaxLink||void 0===b.WPGallery.prototype.ajaxLink)&&"wpgalleryajl"in c?b.WPGallery.prototype.ajaxLink=c.wpgalleryajl:b.WPGallery.prototype.ajaxLink="",this.gallery="",this.previewName="preview",this.definition="",this.galleryLink=!1,this.ajaxLink=b.WPGallery.prototype.ajaxLink,this.ajax="",this.ajaxreceipts=[],this.ajaxid=1,this.links={thumbs:[],navigation:[]},this.init(a)},adr.WPGallery.prototype.init=function(a){var b=__imns("util.classes"),c=__imns("util.validation"),d=__imns("util.tools"),e=(__imns("application.vars"),__imns("component.classes"));if(this.ajax=new b.XHConn,a=c.isString(a)?{id:a}:a,"object"==typeof a){var f={id:"",name:""};if(a=d.handlePassedArguments(a,f),a.id=""===a.id?a.name:a.id,"id"in a){if(this.isGalleryInitialised(a.id))return this.findGallery(f.id);if(this.gallery=a.id,this.valid()){e.WPGallery.prototype.galleries.push(this);var g=this;return d.fetter(document,"DOMContentLoaded",["WPgallery",function(a){g.prepare()}],!0,"after"),this}return!1}}},adr.WPGallery.prototype.findGallery=function(a){var b,c=__imns("component.classes"),d=__imns("util.validation"),e=c.WPGallery.prototype.galleries,f=0;if(d.isString(a)){for(f=0,b=e.length;f<b;f+=1)if(e[f].gallery===a)return e[f]}else if(d.isHTMLElement(a)){for(f=0,b=e.length;f<b;f+=1)if(e[f].getGalleryElement()===a)return e[f]}else if("object"==typeof a&&a.constructor===c.WPGallery)for(f=0,b=e.length;f<b;f+=1)if(e[f]===a)return e[f];return!1},adr.WPGallery.prototype.isGalleryInitialised=function(a){return this.findGallery(a)!==!1},adr.WPGallery.prototype.valid=function(){return this.getGalleryElement()!==!1},adr.WPGallery.prototype.getGalleryElement=function(){var a=__imns("util.dom"),b=__imns("util.validation");if(this.galleryElement!==!1){var c=a.findElementById(this.gallery);c&&b.isHTMLElement(c)&&(this.galleryElement=c)}return!!b.isHTMLElement(this.galleryElement)&&this.galleryElement},adr.WPGallery.prototype.getGalleryDefinition=function(){var a=__imns("util.dom"),b=__imns("util.validation");if(""!==this.definition)return this.definition;var c=a.findDataAttribute(this.getGalleryElement(),"definition");return this.definition=b.isString(c)&&""!==c?c:"",this.definition},adr.WPGallery.prototype.setPreviewedThumbs=function(a){var b=__imns("util.dom"),c=__imns("util.validation");this.clearPreviewedThumbs();var d=this.getGalleryName+"-"+a,e=b.findElementById(d);return!!c.isHTMLElement(e)&&(b.addClass(e,"previewed"),!this.hasPreview()&&"focus"in e&&e.focus(),!0)},adr.WPGallery.prototype.clearPreviewedThumbs=function(){for(var a=__imns("util.dom"),b=a.findElementsBySelector(this.getGalleryElement(),".thumbs li"),c=0,d=0,e=b.length;d<e;d+=1)a.hasClass(b[d],"previewed")&&(c+=1,a.removeClass(b[d],"previewed"));return c>0},adr.WPGallery.prototype.hidePreview=function(){if(this.hasPreview()){for(var a=__imns("util.dom"),b=a.findElementsBySelector(this.getGalleryElement(),"."+this.previewName),c=0,d=0,e=b.length;d<e;d+=1)a.addClass(b[d],"hidden-preview"),c+=1;return c>0}return!1},adr.WPGallery.prototype.unhidePreview=function(){if(this.hasPreview()){for(var a=__imns("util.dom"),b=a.findElementsBySelector(this.getGalleryElement(),"."+this.previewName+".hidden-preview"),c=0,d=0,e=b.length;d<e;d+=1)a.removeClass(b[d],"hidden-preview"),c+=1;return c>0}return!1},adr.WPGallery.prototype.showPreview=function(a){this.hasPreview()&&this.unhidePreview(),this.previewedThumb(a)},adr.WPGallery.prototype.previewedThumb=function(a){var b=__imns("util.dom"),c=__imns("util.validation"),d=__imns("util.debug");if(!c.isNumber(a))return(new d.IMDebugger).pass("WPGallery.previewedThumb supplied a none-number for an id"),!1;this.clearPreviewedThumbs();var e=b.findElementsBySelector(this.getGalleryElement(),"#gall"+a);if(1===e.length){for(var f=e[0],g=b.findParent(f);c.isHTMLElement(g)&&"li"!==b.getTagName(g);)g=b.findParent(g);if(c.isHTMLElement(g))return b.addClass(g,"previewed"),!0;(new d.IMDebugger).pass("WPGallery.previewedThumb cannot find <li> parent")}return(new d.IMDebugger).pass("WPGallery.previewedThumb cannot find supplied id"),!1},adr.WPGallery.prototype.hasPreview=function(){for(var a=__imns("util.dom"),b=__imns("util.validation"),c=a.findElementsBySelector(this.getGalleryElement(),this.previewName),d=0,e=0,f=c.length;e<f;e+=1)c[e]&&b.isHTMLElement(c[e])&&(d+=1);return d>0},adr.WPGallery.prototype.previewImage=function(a){this.clearPreviewedThumbs(),this.hidePreview()},adr.WPGallery.prototype.prepare=function(a){switch(a=void 0!==a?a:"all"){case"navigation":case"inner":return this.preparePreviewLinks(),this.prepareNavigationLinks(),this.prepareThumbLinks(),!0;case"preview":return this.preparePreviewLinks(),!0;case"thumbs":return this.prepareThumbLinks(),!0;case"all":return this.prepareNavigationLinks(),this.prepareThumbLinks(),this.preparePreviewLinks(),!0}return!1},adr.WPGallery.prototype.prepareNavigationLinks=function(){for(var a=__imns("util.dom"),b=__imns("util.validation"),c=a.findElementsBySelector(this.getGalleryElement(),"nav a"),d=0,e=c.length;d<e;d+=1){var f=c[d];b.isInArray(this.links.nav,f)||this.prepareNavigationLink(f)}return!0},adr.WPGallery.prototype.prepareThumbLinks=function(){for(var a=__imns("util.dom"),b=__imns("util.validation"),c=a.findElementsBySelector(this.getGalleryElement(),".thumbs li a"),d=0,e=c.length;d<e;d+=1){var f=c[d];b.isInArray(this.links.thumbs,f)||this.prepareThumbLink(f)}return!0},adr.WPGallery.prototype.preparePreviewLinks=function(){return!0},adr.WPGallery.prototype.sanitizeRequestType=function(a){var b=__imns("util.validation");switch(a=void 0===a?"gallery":a,a=b.isString(a)?a:void 0){case"gallery":case"navigation":case"preview":case"thumbs":return a}return"gallery"},adr.WPGallery.prototype.produceAjaxLink=function(a,b){var c=__imns("util.classes");b=this.sanitizeRequestType(b);var d=new c.PathInfo(this.ajaxLink),e=new c.PathInfo(a);return d.addGetVars(e.getVarsList),d.addGetVar({name:"action",value:"wpgalleryajax"},!1),d.addGetVar({name:"ajax",value:"true"},!1),d.addGetVar({name:"gd",value:this.getGalleryDefinition()},!1),d.addGetVar({name:"gallreq",value:b},!1),d.url},adr.WPGallery.prototype.request=function(a,b){var c=__imns("util.dom"),d=__imns("util.classes"),e=__imns("util.validation"),f=__imns("util.tools"),g=e.isHTMLElement(a)?a:f.findEventElement(a),h=c.getAttribute(g,"href");if("preview"===b&&!this.hasPreview()){var i=new d.PathInfo(h),j=i.findGetVar("preview").value;return void 0!==j&&this.showPreview(j),f.preventEvent(a),!1}if(null!==g){var k=this.produceAjaxLink(h,b);return this.ajax.connect(k,"get","",this.produceAjaxFunction(this,this.assignAjax(b,h))),f.preventEvent(a),!1}return!0},adr.WPGallery.prototype.receipt=function(a,b){var c,d=__imns("util.dom"),e=__imns("util.validation"),f=d.returnXMLFromString(a.responseText),g="firstChild"in f?f.firstChild:f,h=[],i=b.requestType,j=null,k=!1,l=0;switch(i){case"preview":if(d.hasClass(g,"preview"))for(h=d.findElementsBySelector(this.getGalleryElement(),".preview"),l=0,c=h.length;l<c;l+=1)d.replaceElementWith(h[l],g),k=!0;break;case"thumbs":case"thumbsprior":case"thumbsnext":d.hasClass(g,"thumbs")&&(k=!0,this.prepare("thumbs"));break;case"inner":case"navigation":if(d.hasClass(g,"inner")){for(h=d.findElementsBySelector(this.getGalleryElement(),".inner"),l=0,c=h.length;l<c;l+=1){d.replaceElementWith(h[l],g);k=!0}this.prepare("inner"),j=d.findElementsBySelector(this.getGalleryElement(),".inner")[0]}break;case"gallery":default:if(d.getAttribute(g,"id")===this.galleryName){var m=this.getGalleryElement();d.replaceElementWith(m,g),k=!0,this.prepare("all"),j=this.getGalleryElement()}}return k?(null!==j&&e.isHTMLElement(j)&&"focus"in j&&(j.focus(),"scrollIntoView"in j&&j.scrollIntoView()),k):void(void 0!==b.url&&window.location(b.url))},adr.WPGallery.prototype.produceAjaxFunction=function(a,b){var c=function(c){var d=a.removeAjax(b);d!==!1&&d.valid&&a.receipt(c,d)};return c},adr.WPGallery.prototype.removeAjax=function(a){for(var b=0;b<this.ajaxreceipts.length;b+=1){var c=this.ajaxreceipts[b];if(c.id===a)return this.ajaxreceipts.splice(b,1),c}return!1},adr.WPGallery.prototype.affectedByAjax=function(a){switch(a){case"all":return["navigation","preview","thumbs","inner","all"];case"navigation":return["navigation","thumbs","all"];case"inner":return["navigation","inner","thumbs","all"];case"thumbs":return["thumbs","all"];case"preview":return["preview","all"]}},adr.WPGallery.prototype.assignAjax=function(a,b){for(var c=__imns("util.validation"),d=this.ajaxid+=1,e=this.affectedByAjax(a),f=0,g=this.ajaxreceipts.length;f<g;f+=1){var h=this.ajaxreceipts[f];c.isInArray(h.requestType,e)&&(h.valid=!1)}return this.ajaxreceipts.push({id:d,url:b,requestType:a,valid:!0}),d},adr.WPGallery.prototype.prepareNavigationLink=function(a){var b=(__imns("util.dom"),__imns("util.validation")),c=__imns("util.tools");if(a&&b.isHTMLElement(a)&&!b.isInArray(a,this.links.navigation)){var d=this;return c.fetter(a,"click",["gallerynav",function(a){return d.request(a,"navigation")}],!0),this.links.navigation.push(a),!0}return!1},adr.WPGallery.prototype.prepareThumbLink=function(a){var b=(__imns("util.dom"),__imns("util.validation")),c=__imns("util.tools");if(a&&b.isHTMLElement(a)&&!b.isInArray(a,this.links.thumbs)){var d=this;return c.fetter(a,"click",["gallerypreview",function(b){return d.request(a,"preview")}],!0),this.links.thumbs.push(a),!0}return!1},adr.prepareWPGalleries());