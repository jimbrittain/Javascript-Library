"use strict";var adr=__imns("component.classes");"Timeline"in adr||(adr.Timeline=function(){this.playing=!1,this.starttime=null,this.maxtime=null,this.sequence=[],this.hasError=!1,this.onSequence=-1,this._startfunction=null,this._endfunction=null,this._errorfunction=null,this._fallbackfunction=null,this.time=null},adr.Timeline.prototype.start=function(){null!==this._startfunction&&__imns("util.validation").isFunction(this._startfunction)&&this._startfunction(),this.onSequence=-1,this.playing=!0,this.starttime=(new Date).getTime(),this.nextInSequence()},adr.Timeline.prototype.end=function(){null!==this._endfunction&&__imns("util.validation").isFunction(this._endfunction)&&this._endfunction(),this.clearTime(),this.playing=!1,this.starttime=null},adr.Timeline.prototype.fallback=function(){null!==this._fallbackfunction&&__imns("util.validation").isFunction(this._fallbackfunction)&&this._fallbackfunction()},adr.Timeline.prototype.error=function(){this.hasError=!0,this.playing=!1,this.starttime=null,this.clearTime(),null!==this._errorfunction&&__imns("util.validation").isFunction(this._errorfunction)&&this._errorfunction(),this.fallback()},adr.Timeline.prototype.setFunction=function(a,b){var c=__imns("util.validation");if(void 0!==b&&c.isFunction(b)&&c.isString(a))switch(a){case"error":return this._errorfunction=b,!0;case"start":return this._startfunction=b,!0;case"end":return this._endfunction=b,!0;case"fallback":return this._fallbackfunction=b,!0}return!1},adr.Timeline.prototype.checkElapsed=function(){if(null!==this.maxtime){var a=(new Date).getTime();a-this.starttime>=this.maxtime&&((new(__imns("util.debug").IMDebugger)).pass("Timeline has surpassed maximum allowed time"),this.error())}},adr.Timeline.prototype.clearTime=function(){null!==this.time&&(clearTimeout(this.time),this.time=null)},adr.Timeline.prototype.addToSequence=function(a,b){var c=__imns("component.classes"),d=c.TimelineEvent(a,b);return d===!1?!1:(this.sequence.push(d),!0)},adr.Timeline.prototype.nextInSequence=function(a){if(a=void 0===a&&a!==!0?!1:!0,this.playing&&!this.hasError&&(this.checkElapsed(),!this.hasError))if(this.onSequence+=1,this.onSequence<this.sequence.length){var b=this.sequence[this.onSequence],c=this;"wait"!==b.timing&&(this.clearTime(),this.time=setTimeout(function(){c.doSequenceEvent()},b.timing))}else this.end()},adr.Timeline.prototype.doSequenceEvent=function(){var a=this.sequence[this.onSequence];a.run(),this.nextInSequence()},adr.Timeline.prototype.waiting=function(){var a=this;return function(){a.doSequenceEvent()}},adr.TimelineEvent=function(a,b){var c=!1;this._function=null,this.timing=0;var d=__imns("util.validation");return void 0===b?"object"!=typeof a||d.isFunction(a)||(d.isArray(a)&&2===a.length?c=this.setFunction(a[0])&&this.setTiming(a[1])?!0:!1:"func"in a&&"timing"in a&&(c=this.setFunction(a.func)&&this.setTiming(a.timing)?!0:!1)):c=this.setFunction(a)&&this.setTiming(b)?!0:!1,c?void 0:!1},adr.TimelineEvent.prototype.setFunction=function(a){return void 0!==a&&__imns("util.validation").isFunction(a)?(this._function=a,!0):!1},adr.TimelineEvent.prototype.setTiming=function(a){var b=__imns("util.validation");if(a=b.isString(a)?a.toLowerCase():a,"wait"===a||"waiting"===a)return this.timing="waiting",(new(__imns("util.debug").IMDebugger)).pass("TimelineEvent is set to wait, on when the wait is finished call Timeline.waiting() to proceed to this event"),!0;if(b.isNumber(a)&&a>0&&a>10)return this.timing=a,!0;if(b.isString(a)){var c=/^(([0-9]+[\.]{0,1}){0,1}[0-9]+){1}(m|ms|s|h|d)$/;if(c.test(a)){var d=c.exec(a),e=d[1];switch(d[3]){case"s":e*=1e3;break;case"m":e*=6e4;break;case"h":e*=36e5;break;case"d":e*=864e5}return this.timing=e,!0}}return!1},adr.TimelineEvent.prototype.run=function(){null!==this._function&&__imns("util.validation").isFunction(this._function)&&this._function()});