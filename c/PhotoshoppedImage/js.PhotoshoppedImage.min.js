"use strict";function PhotoshoppedImages(){return void 0!==PhotoshoppedImages.prototype.singleton?PhotoshoppedImages.prototype.singleton:(PhotoshoppedImages.prototype.singleton=this,this.idcount=-1,this.tested="pending",this.shopped_class="shopped",this.unshopped_class="unshopped",this.direction="right",this.mouserecord="",this.varyclip=!0,this.psimages=[],void this.construct())}function PhotoshoppedImage(a){return this.id=-1,this.holder="",this.shopped_image="",this.unshopped_image="",this.master=new PhotoshoppedImages,this.full_width=300,this.full_height=1e3,this.direction=this.master.direction,this.varyclip=this.master.varyclip,this.initiated=!1,this.working=!1,this.currentpos=new Coordinates,void 0!==a?this.init(a):this}PhotoshoppedImages.prototype.construct=function(){this.psimages=[],this.mouserecord=new MouseRecorder,this.mouserecord.setRecord({name:"photoshopped",jsObject:this,type:"both"})},PhotoshoppedImages.prototype.addImage=function(a){if(!(a instanceof PhotoshoppedImage))return!1;var b=this.findImage(a);return b instanceof PhotoshoppedImage?!1:(this.psimages.push(a),this.idcount+=1,this.idcount)},PhotoshoppedImages.prototype.findImageIdFromHolder=function(a){var b=-1;if(void 0!==a)for(var c=0,d=this.psimages.length;d>c;c+=1)if(a===this.psimages[c].holder)return c;return b},PhotoshoppedImages.prototype.findImageFromHolder=function(a){var b=void 0!==a?this.findImageIdFromHolder(a):-1;return-1===b?null:this.psimages[b]},PhotoshoppedImages.prototype.findImageFromInstance=function(a){if(a instanceof PhotoshoppedImage)for(var b=0,c=this.psimages.length;c>b;b+=1)if(a===this.psimages[b])return this.psimages[b];return null},PhotoshoppedImages.prototype.findImage=function(a){if(a instanceof PhotoshoppedImage)this.findImageFromInstance(a);else{if(isNumber(a)&&a>-1&&a<this.psimages.length&&parseInt(a)===a)return this.psimages[a];if(void 0!==a&&isHTMLElement(a))return this.findImageFromHolder(a)}return null},PhotoshoppedImages.prototype.isCSSReady=function(a){if("pending"!==this.tested)return this.tested;var b=null;return a=void 0!==a&&a instanceof PhotoshoppedImage?a:!1,b=a!==!1?new SupportedCSSProperty("clip",a.holder).exists():new SupportedCSSProperty("clip").exists(),this.tested=b,PhotoshoppedImages.prototype.isCSSReady=function(){return this.tested},b},PhotoshoppedImages.prototype.setClipDirection=function(a,b){if(a="up"===a?"bottom":a,a="down"===a?"top":a,void 0!==a){if("left"===a||"right"===a||"top"===a||"bottom"===a){if(void 0!==b){var c=this.findImage(b);return c instanceof PhotoshoppedImage?(c.setClipDirection(a),!0):!1}this.direction=a;for(var d=0,e=this.psimages.length;e>d;d+=1)this.psimages[d].setClipDirection(a);return!0}return!1}return!1},PhotoshoppedImages.prototype.varyClipDirection=function(a,b){if(a=void 0===a||a!==!0&&a!==!1?-1:a,a=-1===a?!this.varyclip:a,void 0!==b){var c=this.findImage(b);return c instanceof PhotoshoppedImage?(c.varyClipDirection(a),!0):!1}this.varyclip=a;for(var d=0,e=this.psimages.length;e>d;d+=1)this.psimages[d].varyClipDirection(a);return!0},PhotoshoppedImage.prototype.init=function(a){var b="",c="",d="";if(void 0!==a&&isHTMLElement(a)?b=a:"holder"in a&&(b="holder"in a&&void 0!==a.holder&&isHTMLElement(a.holder)?a.holder:"",c="shopped"in a&&void 0!==a.shopped&&isHTMLElement(a.shopped)?a.shopped:"",d="unshopped"in a&&void 0!==a.unshopped&&isHTMLElement(a.unshopped)?a.unshopped:""),""!==b){var e=this.master.findImageIdFromHolder(b);if(-1!==e)return e;var f=[];if(this.id=this.master.addImage(this),this.holder=b,""!==c&&isChildOf(c,b))this.shopped_image=c;else for(f=htmlNodesToArray(this.holder.childNodes);f.length>0;)isHTMLElement(f[0])&&((new HTMLClass).hasClass(f[0],this.master.shopped_class)?(this.shopped_image=f[0],f=[]):f[0].childNodes&&f.concat(htmlNodesToArray(f[0].childNodes))),f.length>0&&f.shift();if(""!==d&&isChildOf(d,b))this.unshopped_image=d;else for(f=htmlNodesToArray(this.holder.childNodes);f.length>0;)isHTMLElement(f[0])&&((new HTMLClass).hasClass(f[0],this.master.unshopped_class)?(this.unshopped_image=f[0],f=[]):f[0].childNodes&&f.concat(htmlNodesToArray(f[0].childNodes))),f.length>0&&f.shift();this.initiated=this.id!==!1&&""!==this.shopped_image&&""!==this.unshopped_image?!0:!1,this.initiated=this.initiated?this.build():!1}return this},PhotoshoppedImage.prototype.build=function(){return this.prepareHolder()&&this.prepareShoppedImage()&&this.prepareUnshoppedImage()},PhotoshoppedImage.prototype.active=function(){return this.active=this.initiated&&void 0!==this.holder&&isHTMLElement(this.holder)&&void 0!==this.shopped_image&&isHTMLElement(this.shopped_image)&&void 0!==this.unshopped_image&&isHTMLElement(this.unshopped_image)?function(){return!0}:function(){return!1},this.active},PhotoshoppedImage.prototype.calculateFullWidth=function(){return this.active()&&void 0!==this.shopped_image&&isHTMLElement(this.shopped_image)?(this.full_width=Math.floor(parseFloat(findElementStyle(this.shopped_image,"width"))),this.full_width):(this.full_width=0,0)},PhotoshoppedImage.prototype.calculateFullHeight=function(){return this.active()&&void 0!==this.shopped_image&&isHTMLElement(this.shopped_image)?(this.full_height=Math.floor(parseFloat(findElementStyle(this.shopped_image,"height"))),this.full_height):(this.full_height=0,0)},PhotoshoppedImage.prototype.prepareHolder=function(){if(this.active()&&void 0!==this.holder&&isHTMLElement(this.holder)){var a=findElementStyle(this.holder,"position");return"relative"!==a&&"absolute"!==a&&(this.holder.style.position="relative"),this.setDownActions(),!0}return!1},PhotoshoppedImage.prototype.prepareShoppedImage=function(){return this.active()&&void 0!==this.shopped_image&&isHTMLElement(this.shopped_image)?("relative"!==findElementStyle(this.shopped_image,"position")&&(this.shopped_image.style.position="relative"),this.currentpos=new Coordinates(this.calculateFullWidth(),this.calculateFullHeight()),0===this.currentpos.x||0===this.currentpos.y?!1:!0):!1},PhotoshoppedImage.prototype.prepareUnshoppedImage=function(){return this.active()&&void 0!==this.unshopped_image&&isHTMLElement(this.unshopped_image)?("absolute"!==findElementStyle(this.unshopped_image,"position")&&(this.unshopped_image.style.position="absolute",this.unshopped_image.style.top=0,this.unshopped_image.style.left=0),this.doClip(this.offCoordinates()),"visible"!==findElementStyle(this.unshopped_image,"visibility")&&(this.unshopped_image.style.visibility="visible"),!0):!1},PhotoshoppedImage.prototype.setMoveActions=function(a){a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,a.removeMoveActions();var b=a;return a.interval_id=setInterval(function(){debounce(function(){b.moveActions(b)},50)}),!0},PhotoshoppedImage.prototype.removeMoveActions=function(a){return a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,null!==a.interval_id&&(clearInterval(a.interval_id),a.interval_id=null),!0},PhotoshoppedImage.prototype.moveActions=function(a){if(a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,a.working){var b=new Coordinates(a.master.mouserecord.x,a.master.mouserecord.y),c=new BoundaryCoordinates(a.holder);if(b.x>=c.x1&&b.x<=c.x2&&b.y>=c.y1&&b.y<=c.y2){if(this.currentpos.x!==a.master.mouserecord.x||this.currentpos.y!==a.master.mouserecord.y){var d=new Coordinates(Math.round(b.x-c.x1),Math.round(b.y-c.y1));this.doClip(d)}}else a.removeMoveActions(),a.removeUpActions(),a.setDownActions()}else a.removeMoveActions();this.currentpos=new Coordinates(a.master.mouserecord.x,a.master.mouserecord.y)},PhotoshoppedImage.prototype.detectClipDirection=function(){var a=new Coordinates(this.master.mouserecord.x,this.master.mouserecord.y);if(!this.working){var b=new BoundaryCoordinates(this.holder),c={top:a.y-b.y1,bottom:a.y-b.y2,left:a.x-b.x1,right:a.x-b.x2},d="",e=b.y2;for(var f in c)c.hasOwnProperty(f)&&Math.abs(c[f])<=e&&(e=Math.abs(c[f]),d=f);switch(d){case"top":d="bottom";break;case"bottom":d="top";break;case"right":d="left";break;case"left":default:d="right"}this.setClipDirection(d)}},PhotoshoppedImage.prototype.setDownActions=function(a){return a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,fetter(a.holder,"mouseenter",function(){a.varyclip&&a.detectClipDirection()},!0),fetter(a.holder,"mouseenter touchstart",function(){a.downActions(a)},!1),!0},PhotoshoppedImage.prototype.removeDownActions=function(a){return a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,unfetter(a.holder,"mouseenter",function(){a.varyclip&&a.detectClipDirection()},!0),unfetter(a.holder,"mouseenter touchstart",function(){a.downActions(a)},!1),!0},PhotoshoppedImage.prototype.downActions=function(a){return a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,a.working=!0,a.removeDownActions(a),a.setUpActions(a),a.setMoveActions(a),!0},PhotoshoppedImage.prototype.setUpActions=function(a){return a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,a.removeUpActions(a),a.setDownActions(a),fetter(a.holder,"mouseleave touchend",function(){a.upActions(a)},!1),!0},PhotoshoppedImage.prototype.removeUpActions=function(a){return a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,unfetter(a.holder,"mouseleave touchend",function(){a.upActions(a)},!1),!0},PhotoshoppedImage.prototype.upActions=function(a){return a=a instanceof PhotoshoppedImage?a.master.findImage(a.id):this,a.working=!1,a.doClip(a.offCoordinates()),a.removeUpActions(),a.removeDownActions(),a.setDownActions(),!0},PhotoshoppedImage.prototype.offCoordinates=function(){return new Coordinates("left"===this.direction?this.full_width:0,"top"===this.direction?this.full_height:0)},PhotoshoppedImage.prototype.varyClipDirection=function(a){return a=void 0===a||a!==!0&&a!==!1?-1:a,a=-1===a?!this.varyclip:a,this.varyclip=a,!0},PhotoshoppedImage.prototype.setClipDirection=function(a){if(a="up"===a?"bottom":a,a="down"===a?"top":a,void 0!==a&&("left"===a||"right"===a||"top"===a||"bottom"===a)){this.direction=a;var b=this.currentpos,c=new BoundaryCoordinates(this.holder);if(this.working){if(b.x>=c.x1&&b.x<=c.x2&&b.y>=c.y1&&b.y<=c.y2&&(this.currentpos.x!==this.master.mouserecord.x||this.currentpos.y!==this.master.mouserecord.y)){var d=new Coordinates(Math.round(b.x-c.x1),Math.round(b.y-c.y1));this.doClip(d)}}else this.doClip(this.offCoordinates())}},PhotoshoppedImage.prototype.prepareHolderActions=function(){this.active()&&void 0!==this.holder&&isHTMLElement(this.holder)&&(this.working=!1,this.setDownActions(this))},PhotoshoppedImage.prototype.doClip=function(a){"right"===this.direction||"left"===this.direction?this.active()&&this.initiated&&(this.unshopped_image.style.clip="rect(auto "+("right"===this.direction?Math.ceil(a.x)+"px":"auto")+" auto "+("left"===this.direction?Math.ceil(a.x)+"px":"auto")+")"):("top"===this.direction||"bottom"===this.direction)&&this.active()&&this.initiated&&(this.unshopped_image.style.clip="rect("+("top"===this.direction?Math.ceil(a.y)+"px":"auto")+", auto, "+("bottom"===this.direction?Math.ceil(a.y)+"px":"auto")+", auto)")};