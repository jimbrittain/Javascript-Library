"use strict";var adr=__imns("component.classes");"PhotoshoppedImages"in adr||(adr.PhotoshoppedImages=function(){var a=__imns("component.classes");return void 0!==a.PhotoshoppedImages.prototype.singleton?a.PhotoshoppedImages.prototype.singleton:(a.PhotoshoppedImages.prototype.singleton=this,this.idcount=-1,this.tested="pending",this.shopped_class="shopped",this.unshopped_class="unshopped",this.direction="right",this.mouserecord="",this.varyclip=!0,this.psimages=[],void this.construct())},adr.PhotoshoppedImages.prototype.construct=function(){var a=__imns("util.classes");this.psimages=[],this.mouserecord=new a.MouseRecorder,this.mouserecord.setRecord({name:"photoshopped",jsObject:this,type:"both"})},adr.PhotoshoppedImages.prototype.addImage=function(a){var b=__imns("component.classes");if(!(a instanceof b.PhotoshoppedImage))return!1;var c=this.findImage(a);return c instanceof b.PhotoshoppedImage?!1:(this.psimages.push(a),this.idcount+=1,this.idcount)},adr.PhotoshoppedImages.prototype.findImageIdFromHolder=function(a){var b=-1;if(void 0!==a)for(var c=0,d=this.psimages.length;d>c;c+=1)if(a===this.psimages[c].holder)return c;return b},adr.PhotoshoppedImages.prototype.findImageFromHolder=function(a){var b=void 0!==a?this.findImageIdFromHolder(a):-1;return-1===b?null:this.psimages[b]},adr.PhotoshoppedImages.prototype.findImageFromInstance=function(a){var b=__imns("component.classes");if(a instanceof b.PhotoshoppedImage)for(var c=0,d=this.psimages.length;d>c;c+=1)if(a===this.psimages[c])return this.psimages[c];return null},adr.PhotoshoppedImages.prototype.findImage=function(a){var b=__imns("component.classes"),c=__imns("util.validation");if(a instanceof b.PhotoshoppedImage)this.findImageFromInstance(a);else{if(c.isNumber(a)&&a>-1&&a<this.psimages.length&&parseInt(a)===a)return this.psimages[a];if(void 0!==a&&c.isHTMLElement(a))return this.findImageFromHolder(a)}return null},adr.PhotoshoppedImages.prototype.isCSSReady=function(a){var b=__imns("component.classes"),c=__imns("util.classes");if("pending"!==this.tested)return this.tested;var d=null;return a=void 0!==a&&a instanceof b.PhotoshoppedImage?a:!1,d=a!==!1?new c.SupportedCSSProperty("clip",a.holder).exists():new c.SupportedCSSProperty("clip").exists(),this.tested=d,b.PhotoshoppedImages.prototype.isCSSReady=function(){return this.tested},d},adr.PhotoshoppedImages.prototype.setClipDirection=function(a,b){var c=__imns("component.classes");if(a="up"===a?"bottom":a,a="down"===a?"top":a,void 0!==a){if("left"===a||"right"===a||"top"===a||"bottom"===a){if(void 0!==b){var d=this.findImage(b);return d instanceof c.PhotoshoppedImage?(d.setClipDirection(a),!0):!1}this.direction=a;for(var e=0,f=this.psimages.length;f>e;e+=1)this.psimages[e].setClipDirection(a);return!0}return!1}return!1},adr.PhotoshoppedImages.prototype.varyClipDirection=function(a,b){var c=__imns("component.classes");if(a=void 0===a||a!==!0&&a!==!1?-1:a,a=-1===a?!this.varyclip:a,void 0!==b){var d=this.findImage(b);return d instanceof c.PhotoshoppedImage?(d.varyClipDirection(a),!0):!1}this.varyclip=a;for(var e=0,f=this.psimages.length;f>e;e+=1)this.psimages[e].varyClipDirection(a);return!0},adr.PhotoshoppedImage=function(a){var b=__imns("component.classes"),c=__imns("util.classes");return this.id=-1,this.holder="",this.shopped_image="",this.unshopped_image="",this.master=new b.PhotoshoppedImages,this.full_width=300,this.full_height=1e3,this.direction=this.master.direction,this.varyclip=this.master.varyclip,this.initiated=!1,this.working=!1,this.currentpos=new c.Coordinates,void 0!==a?this.init(a):this},adr.PhotoshoppedImage.prototype.init=function(a){var b=__imns("util.validation"),c=(__imns("util.classes"),__imns("util.tools")),d="",e="",f="";if(void 0!==a&&b.isHTMLElement(a)?d=a:"holder"in a&&(d="holder"in a&&void 0!==a.holder&&b.isHTMLElement(a.holder)?a.holder:"",e="shopped"in a&&void 0!==a.shopped&&b.isHTMLElement(a.shopped)?a.shopped:"",f="unshopped"in a&&void 0!==a.unshopped&&b.isHTMLElement(a.unshopped)?a.unshopped:""),""!==d){var g=this.master.findImageIdFromHolder(d);if(-1!==g)return g;var h=[];if(this.id=this.master.addImage(this),this.holder=d,""!==e&&b.isChildOf(e,d))this.shopped_image=e;else for(h=c.htmlNodesToArray(this.holder.childNodes);h.length>0;)b.isHTMLElement(h[0])&&(c.hasClass(h[0],this.master.shopped_class)?(this.shopped_image=h[0],h=[]):h[0].childNodes&&h.concat(c.htmlNodesToArray(h[0].childNodes))),h.length>0&&h.shift();if(""!==f&&c.isChildOf(f,d))this.unshopped_image=f;else for(h=c.htmlNodesToArray(this.holder.childNodes);h.length>0;)b.isHTMLElement(h[0])&&(c.hasClass(h[0],this.master.unshopped_class)?(this.unshopped_image=h[0],h=[]):h[0].childNodes&&h.concat(c.htmlNodesToArray(h[0].childNodes))),h.length>0&&h.shift();this.initiated=this.id!==!1&&""!==this.shopped_image&&""!==this.unshopped_image?!0:!1,this.initiated=this.initiated?this.build():!1}return this},adr.PhotoshoppedImage.prototype.build=function(){return this.prepareHolder()&&this.prepareShoppedImage()&&this.prepareUnshoppedImage()},adr.PhotoshoppedImage.prototype.active=function(){var a=__imns("util.validation");return this.active=this.initiated&&void 0!==this.holder&&a.isHTMLElement(this.holder)&&void 0!==this.shopped_image&&a.isHTMLElement(this.shopped_image)&&void 0!==this.unshopped_image&&a.isHTMLElement(this.unshopped_image)?function(){return!0}:function(){return!1},this.active},adr.PhotoshoppedImage.prototype.calculateFullWidth=function(){var a=__imns("util.validation"),b=__imns("util.dom");return this.active()&&void 0!==this.shopped_image&&a.isHTMLElement(this.shopped_image)?(this.full_width=Math.floor(parseFloat(b.findElementStyle(this.shopped_image,"width"))),this.full_width):(this.full_width=0,0)},adr.PhotoshoppedImage.prototype.calculateFullHeight=function(){var a=__imns("util.validation"),b=__imns("util.dom");return this.active()&&void 0!==this.shopped_image&&a.isHTMLElement(this.shopped_image)?(this.full_height=Math.floor(parseFloat(b.findElementStyle(this.shopped_image,"height"))),this.full_height):(this.full_height=0,0)},adr.PhotoshoppedImage.prototype.prepareHolder=function(){var a=__imns("util.validation"),b=__imns("util.dom");if(this.active()&&void 0!==this.holder&&a.isHTMLElement(this.holder)){var c=b.findElementStyle(this.holder,"position");return"relative"!==c&&"absolute"!==c&&(this.holder.style.position="relative"),this.setDownActions(),!0}return!1},adr.PhotoshoppedImage.prototype.prepareShoppedImage=function(){var a=__imns("util.validation"),b=__imns("util.classes"),c=__imns("util.dom");return this.active()&&void 0!==this.shopped_image&&a.isHTMLElement(this.shopped_image)?("relative"!==c.findElementStyle(this.shopped_image,"position")&&(this.shopped_image.style.position="relative"),this.currentpos=new b.Coordinates(this.calculateFullWidth(),this.calculateFullHeight()),0===this.currentpos.x||0===this.currentpos.y?!1:!0):!1},adr.PhotoshoppedImage.prototype.prepareUnshoppedImage=function(){var a=__imns("util.validation"),b=__imns("util.dom");return this.active()&&void 0!==this.unshopped_image&&a.isHTMLElement(this.unshopped_image)?("absolute"!==b.findElementStyle(this.unshopped_image,"position")&&(this.unshopped_image.style.position="absolute",this.unshopped_image.style.top=0,this.unshopped_image.style.left=0),this.doClip(this.offCoordinates()),"visible"!==b.findElementStyle(this.unshopped_image,"visibility")&&(this.unshopped_image.style.visibility="visible"),!0):!1},adr.PhotoshoppedImage.prototype.setMoveActions=function(a){var b=__imns("component.classes");a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,a.removeMoveActions();var c=a;return a.interval_id=setInterval(function(){var a=__imns("util.tools");a.debounce(function(){c.moveActions(c)},50)}),!0},adr.PhotoshoppedImage.prototype.removeMoveActions=function(a){var b=__imns("component.classes");return a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,null!==a.interval_id&&(clearInterval(a.interval_id),a.interval_id=null),!0},adr.PhotoshoppedImage.prototype.moveActions=function(a){var b=__imns("component.classes"),c=__imns("util.classes");if(a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,a.working){var d=new c.Coordinates(a.master.mouserecord.x,a.master.mouserecord.y),e=new c.BoundaryCoordinates(a.holder);if(d.x>=e.x1&&d.x<=e.x2&&d.y>=e.y1&&d.y<=e.y2){if(this.currentpos.x!==a.master.mouserecord.x||this.currentpos.y!==a.master.mouserecord.y){var f=new c.Coordinates(Math.round(d.x-e.x1),Math.round(d.y-e.y1));this.doClip(f)}}else a.removeMoveActions(),a.removeUpActions(),a.setDownActions()}else a.removeMoveActions();this.currentpos=new c.Coordinates(a.master.mouserecord.x,a.master.mouserecord.y)},adr.PhotoshoppedImage.prototype.detectClipDirection=function(){var a=__imns("util.classes"),b=new a.Coordinates(this.master.mouserecord.x,this.master.mouserecord.y);if(!this.working){var c=new a.BoundaryCoordinates(this.holder),d={top:b.y-c.y1,bottom:b.y-c.y2,left:b.x-c.x1,right:b.x-c.x2},e="",f=c.y2;for(var g in d)d.hasOwnProperty(g)&&Math.abs(d[g])<=f&&(f=Math.abs(d[g]),e=g);switch(e){case"top":e="bottom";break;case"bottom":e="top";break;case"right":e="left";break;case"left":default:e="right"}this.setClipDirection(e)}},adr.PhotoshoppedImage.prototype.setDownActions=function(a){var b=__imns("component.classes"),c=__imns("util.tools");return a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,c.fetter(a.holder,"mouseenter",[a,function(){a.varyclip&&a.detectClipDirection()}],!0),c.fetter(a.holder,"mouseenter touchstart",[a,function(){a.downActions(a)}],!1),!0},adr.PhotoshoppedImage.prototype.removeDownActions=function(a){var b=__imns("component.classes"),c=__imns("util.tools");return a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,c.unfetter(a.holder,"mouseenter",[a,function(){a.varyclip&&a.detectClipDirection()}],!0),c.unfetter(a.holder,"mouseenter touchstart",[a,function(){a.downActions(a)}],!1),!0},adr.PhotoshoppedImage.prototype.downActions=function(a){var b=__imns("component.classes");return a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,a.working=!0,a.removeDownActions(a),a.setUpActions(a),a.setMoveActions(a),!0},adr.PhotoshoppedImage.prototype.setUpActions=function(a){var b=__imns("component.classes"),c=__imns("util.tools");return a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,a.removeUpActions(a),a.setDownActions(a),c.fetter(a.holder,"mouseleave touchend",[a,function(){a.upActions(a)}],!1),!0},adr.PhotoshoppedImage.prototype.removeUpActions=function(a){var b=__imns("component.classes"),c=__imns("util.tools");return a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,c.unfetter(a.holder,"mouseleave touchend",[a,function(){a.upActions(a)}],!1),!0},adr.PhotoshoppedImage.prototype.upActions=function(a){var b=__imns("component.classes");return a=a instanceof b.PhotoshoppedImage?a.master.findImage(a.id):this,a.working=!1,a.doClip(a.offCoordinates()),a.removeUpActions(),a.removeDownActions(),a.setDownActions(),!0},adr.PhotoshoppedImage.prototype.offCoordinates=function(){var a=__imns("util.classes");return new a.Coordinates("left"===this.direction?this.full_width:0,"top"===this.direction?this.full_height:0)},adr.PhotoshoppedImage.prototype.varyClipDirection=function(a){return a=void 0===a||a!==!0&&a!==!1?-1:a,a=-1===a?!this.varyclip:a,this.varyclip=a,!0},adr.PhotoshoppedImage.prototype.setClipDirection=function(a){var b=__imns("util.classes");if(a="up"===a?"bottom":a,a="down"===a?"top":a,void 0!==a&&("left"===a||"right"===a||"top"===a||"bottom"===a)){this.direction=a;var c=this.currentpos,d=new b.BoundaryCoordinates(this.holder);if(this.working){if(c.x>=d.x1&&c.x<=d.x2&&c.y>=d.y1&&c.y<=d.y2&&(this.currentpos.x!==this.master.mouserecord.x||this.currentpos.y!==this.master.mouserecord.y)){var e=new b.Coordinates(Math.round(c.x-d.x1),Math.round(c.y-d.y1));this.doClip(e)}}else this.doClip(this.offCoordinates())}},adr.PhotoshoppedImage.prototype.prepareHolderActions=function(){var a=__imns("util.validation");this.active()&&void 0!==this.holder&&a.isHTMLElement(this.holder)&&(this.working=!1,this.setDownActions(this))},adr.PhotoshoppedImage.prototype.doClip=function(a){"right"===this.direction||"left"===this.direction?this.active()&&this.initiated&&(this.unshopped_image.style.clip="rect(auto "+("right"===this.direction?Math.ceil(a.x)+"px":"auto")+" auto "+("left"===this.direction?Math.ceil(a.x)+"px":"auto")+")"):("top"===this.direction||"bottom"===this.direction)&&this.active()&&this.initiated&&(this.unshopped_image.style.clip="rect("+("top"===this.direction?Math.ceil(a.y)+"px":"auto")+", auto, "+("bottom"===this.direction?Math.ceil(a.y)+"px":"auto")+", auto)")});