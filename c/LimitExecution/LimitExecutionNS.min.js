"use strict";var adr=__imns("util.classes"),ut=__imns("util.tools");"LimitExecution"in adr||(adr.LimitExecution=function(){var a=__imns("util.classes");return void 0!==a.LimitExecution.prototype.singleton?a.LimitExecution.prototype.singleton:(a.LimitExecution.prototype.singleton=this,this.functionList=[],this)},adr.LimitExecution.prototype.fire=function(a,b){var c=__imns("util.classes"),d=this.findLEF(a);d instanceof c.LimitExecutionFunction?(b!==d.limit&&(d.limit=b),d.setFire()):(d=new c.LimitExecutionFunction(a,b),null!==d&&(this.functionList.push(d),this.functionList[this.functionList.length-1].setFire()))},adr.LimitExecution.prototype.end=function(a){var b=__imns("util.classes"),c=this.findLEF(a);return c instanceof b.LimitExecutionFunction?(c.end(),!0):!1},adr.LimitExecution.prototype.findLEF=function(a){var b,c,d=__imns("util.validation");if(!d.isArray(a)||2!==a.length){for(b=0,c=this.functionList.length;c>b;b+=1)if(this.functionList[b].func===a)return this.functionList[b];return null}for(b=0,c=this.functionList.length;c>b;b+=1)if(this.functionList[b].caller===a[0]&&this.functionList[b].func===a[1])return this.functionList[b]},adr.LimitExecutionFunction=function(a,b){return this.func=null,this.caller=null,this.to=null,this.limit=null,this.minLimit=0,this.et=null,this.init(a,b)},adr.LimitExecutionFunction.prototype.init=function(a,b){var c=__imns("util.validation");return c.isArray(a)&&2===a.length?(this.caller=a[0],this.func=c.isFunction(a)?a:null):c.isFunction(a)&&(this.func=c.isFunction(a)?a:null),this.limit=this.setLimit(b),null!==this.func?this:null},adr.LimitExecutionFunction.prototype.setFire=function(){var a=(new Date).getTime();if(a-this.limit>this.et)this.func(),this.et=a;else if(a+this.limit>this.et){this.et=this.et+this.limit;var b=this;this.to=setTimeout(function(){b.fire()},this.et-a)}},adr.LimitExecutionFunction.prototype.fire=function(){var a=(new Date).getTime();this.func();var b=(new Date).getTime(),c=b-a;this.minLimit=c>this.minLimit?c:this.minLimit,this.setLimit(this.limit)},adr.LimitExecutionFunction.prototype.setLimit=function(a){var b=__imns("util.validation");b.isNumber(a)&&a>0&&(this.limit=a<this.minLimit?this.minLimit:a)},adr.LimitExecutionFunction.prototype.end=function(){if(null!==this.to){try{clearTimeout(this.to)}catch(a){}this.to=null}},ut.limitExecution=function(a,b){var c=__imns("util.classes");return new c.LimitExecutionFunction(a,b)});