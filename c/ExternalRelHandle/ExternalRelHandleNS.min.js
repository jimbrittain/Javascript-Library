"use strict";var adr=__imns("util.classes");"ExternalRelHandle"in adr||(adr.ExternalWindowProfile=function(a,b,c){this.classname=void 0!==a?a:"",this.options=void 0!==b?b:"",this.windowname=void 0!==c?c:""},adr.ExternalWindowProfiles=function(){var a=__imns("util.classes");return a.ExternalWindowProfiles.prototype.singletonInstance?a.ExternalWindowProfiles.prototype.singletonInstance:(a.ExternalWindowProfiles.prototype.singletonInstance=this,void(this.list=[]))},adr.ExternalWindowProfiles.prototype.returnSettings=function(a){var b=__imns("util.classes"),c=__imns("util.validation");c.isArray(a)||(a="string"==typeof a?a.split(" "):[]);for(var d=null,e=0;e<this.list.length&&null===d;){for(var f=0,g=a.length;f<g;f+=1)if(this.list[e].classname===a[f]){d=this.list[e];break}e+=1}return d=null===d?new b.ExternalWindowProfile:d},adr.ExternalWindowProfiles.prototype.addProfile=function(a){var b=__imns("util.classes"),c=__imns("util.debug");if(a instanceof b.ExternalWindowProfile){for(var d=!1,e=0,f=this.list.length;e<f;e+=1)if(this.list[e].classname===a.classname){d=!0;break}return!d&&(this.list.push(a),!0)}return(new c.IMDebugger).pass("ExternalRefHandle.addProfile: Requires ExternalRefProfile."),!1},adr.ExternalRelHandle=function(){var a=__imns("util.classes");return a.ExternalRelHandle.prototype.singleton?a.ExternalRelHandle.prototype.singleton:(a.ExternalRelHandle.prototype.singleton=this,this.windowsAllowed=!(!window.open||"function"!=typeof window.open),this.firstUse=!0,this.ext_window_reference=null,this.profiles=new a.ExternalWindowProfiles,this.processedElements=[],void this.buildInit())},adr.ExternalRelHandle.prototype.buildInit=function(){var a=__imns("util.tools"),b=this;a.fetter(window,"DOMContentLoaded",[b,function(){b.init()}],!0,"both")},adr.ExternalRelHandle.prototype.elementProcessed=function(a){for(var b=!1,c=0,d=this.processedElements.length;c<d;c+=1)if(this.processedElements[c]===a)return b=!0,!0;return b},adr.ExternalRelHandle.prototype.init=function(){var a=__imns("util.dom"),b=__imns("util.tools");if(this.windowsAllowed){for(var c=a.findElementsBySelector('a[rel~="external"]'),d=0,e=c.length;d<e;d+=1){var f=c[d];this.elementProcessed(f)||(this.processedElements.push(f),b.fetter(f,"click touchdown",["externalRel",this.handleClick()],!0,"done"))}return!0}return this.createTargets(),!1},adr.ExternalRelHandle.prototype.handleClick=function(){return function(a){var b=__imns("util.tools"),c=__imns("util.classes"),d=__imns("util.validation"),e=__imns("util.dom"),f=b.findEventElement(a),g=!0,h=new c.ExternalRelHandle;if(d.isHTMLElement(f)){var i=e.getAttribute(f,"href"),j=e.getAttribute(f,"class"),k=h.profiles.returnSettings(j);g=h.openWindow(i,k.options,k.windowName)}else g=!0;return!!g||(b.preventEvent(a),!1)}},adr.ExternalRelHandle.prototype.openWindow=function(a,b,c){var d=""===c||void 0===c?"name":c,e=""!==b?b:"";if(this.windowsAllowed){if(null!==this.ext_window_reference)try{this.ext_window_reference.close()}catch(a){}if(this.ext_window_reference=window.open(a,d,e),this.firstUse){this.firstUse=!1;try{this.ext_window_reference.focus()}catch(a){return this.windowsAllowed=!1,this.createTargets(),!0}}else this.ext_window_reference.focus();return!1}return!0},adr.ExternalRelHandle.prototype.createTargets=function(){for(var a=__imns("util.dom"),b=__imns("util.tools"),c=a.findElementsBySelector('a[rel="external"]'),d=0,e=c.length;d<e;d+=1)b.unfetter(c[d],"click touchdown","externalRel"),a.setAttribute("target","_blank");return!0},adr.externalrel=new adr.ExternalRelHandle);