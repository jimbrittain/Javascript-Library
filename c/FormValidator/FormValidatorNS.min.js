"use strict";var adr=__imns("util.classes");"FormValidator"in adr||(adr.FormValidator=function(){var a=__imns("util.classes");return void 0!==a.FormValidator.prototype.singleton?a.FormValidator.prototype.singleton:(a.FormValidator.prototype.singleton=this,this.defaults=!0,this.forms=[],void(this.customs=[]))},adr.FormValidator.prototype.registerForm=function(a){var b=__imns("util.validation"),c=__imns("util.dom"),d=this.findForm(a);return null===d&&b.isHTMLElement(a)&&("HTMLFormElement"in window&&a instanceof HTMLFormElement||"form"===c.getTagName(a))?(d=new(__imns("util.classes").FormValidatorForm)(a),!0):!1},adr.FormValidator.prototype.findForm=function(a){for(var b=null,c=0,d=this.forms.length;d>c;c+=1)if(a===this.forms[c].form){b=this.forms[c];break}return b},adr.FormValidator.prototype.addWhenValid=function(a,b,c){var d=__imns("util.validation");d.isHTMLElement(a)||"object"!=typeof a||(c="not"in a?a.not:c,b="is"in a?a.is:b,a="form"in a?a.form:a),null===this.findForm(a)&&this.registerForm(a);var e=this.findForm(a);return null!==e?(void 0!==b&&e.setIs(b),void 0!==c&&e.setNot(c),!0):!1},adr.FormValidator.prototype.addCustomValidation=function(a){var b=__imns("util.classes");if(a instanceof b.FormValidatorCustom){if(a.isValid())return this.customs.push(a),!0}else{var c=b.FormValidatorCustom(a);if(c.isValid())return this.customs.push(c),!0}return!1},adr.FormValidator.prototype.determineForm=function(a){var b=__imns("util.validation"),c=__imns("util.dom"),d=__imns("util.tools"),e=[],f=[];if("string"==typeof a){var g=c.findElementsBySelector(a);0===g.length?(g=c.findElementById(a),void 0!==g&&b.isHTMLElement(g)&&e.push(g)):e=g}else void 0!==a&&b.isHTMLElement(a)&&e.push(a);if(e.length>0){for(var h=0,i=e.length;i>h;h+=1){var j=c.findForm(e[h]);b.isHTMLElement(j)&&f.push(j)}f=d.arrayUnique(f)}return f},adr.FormValidator.prototype.validate=function(a){var b=(__imns("util.validation"),__imns("util.dom"),this.determineForm(a)),c=!1,d=!0;if(b.length>0)for(var e=0,f=b.length;f>e;e+=1)c=this.validateFormElement(b[e]),c||(d=!1);return d},adr.FormValidator.prototype.validateControl=function(a){var b=this.determineForm(a)[0],c=this.findForm(b);return c.checkAll()?this.validate(b):this.validateFormControl(a)},adr.FormValidator.prototype.validateFormElement=function(a){var b,c,d=__imns("util.dom"),e=d.findFormControls(a),f=!0,g=!0;for(b=0,c=e.length;c>b;b+=1)f=this.validateFormControl(e[b]),f||(g=!1);if(this.hasCustomValidation(a)){var h=this.getControlCustomHandles(a);for(b=0,c=h.length;c>b;b+=1){var i=this.runControlCustomValidation(a,this.customs[b].handle);g=i?g:!1}}var j=this.findForm(a);return null!==j&&(g?j.is():j.not()),g},adr.FormValidator.prototype.defaultValidationControl=function(a){if(this.defaults){var b=__imns("util.dom"),c=__imns("util.validation");if(c.isHTMLElement(a)){var d=b.getTagName(a);if("input"===d){var e=b.getAttribute(a,"type");switch(e="string"==typeof e?e.toLowerCase():e){case"email":return c.isEmailAddress(a.value);case"url":return c.isUrl(a.value);case"number":return c.isNumber(a.value);case"tel":return c.isTelephoneNumber(a.value)}}}}return!0},adr.FormValidator.prototype.skipFormControl=function(a){var b=__imns("util.dom"),c=b.getTagName(a);if("input"===c)switch(a.type){case"hidden":case"submit":case"button":case"reset":return!0}return"optgroup"===c||"progress"===c||"button"===c?!0:!1},adr.FormValidator.prototype.validateFormControl=function(a){var b,c=__imns("util.dom"),d=!0;if(this.skipFormControl(a))return!0;if(c.hasAttribute(a,"pattern")){var e=c.getAttribute(a,"pattern");if("string"==typeof e&&e.length>0&&"null"!==e){var f=new RegExp(e);b=f.test(a.value),d=b?d:!1,this.alert(a,"--pattern",b)}}if(this.defaults&&(b=this.defaultValidationControl(a),d=b?d:!1,this.alert(a,"--default",b)),this.hasCustomValidation(a))for(var g=this.getControlCustomHandles(a),h=0,i=g.length;i>h;h+=1)b=this.runControlCustomValidation(a,this.customs[h].handle),d=b?d:!1,this.alert(a,this.customs[h].handle,b);return d},adr.FormValidator.prototype.findCustomValidations=function(a){for(var b=[],c=0,d=this.customs;d>c;c+=1)this.customs[c].influences(a)&&b.push(this.customs[c]);return b},adr.FormValidator.prototype.hasCustomValidation=function(a){var b=this.findCustomValidations(a);return b.length>0?!0:!1},adr.FormValidator.prototype.getCustomHandles=function(a){for(var b=[],c=this.findCustomValidations(a),d=0,e=c.length;e>d;d+=1)b.push(c[d].handle);return b},adr.FormValidator.prototype.alert=function(a,b,c){c?this.alertHide(a,b):this.alertDisplay(a,b)},adr.FormValidator.prototype.alertDisplay=function(a,b){for(var c=__imns("util.dom"),d=this.findAlertForControl(a,b),e=0,f=d.length;f>e;e+=1){var g=d[e].element;c.setAttribute(g,"aria-hidden","false"),c.addClass(g,"on")}},adr.FormValidator.prototype.alertHide=function(a,b){for(var c=__imns("util.dom"),d=this.findAlertForControl(a,b),e=0,f=d.length;f>e;e+=1){var g=d[e].element;return c.setAttribute(g,"aria-hidden","true"),c.removeClass(g,"on"),!0}},adr.FormValidator.prototype.findAlertForControl=function(a,b){var c,d,e=__imns("util.dom"),f=__imns("util.classes"),g=e.getAttribute(a,"id"),h=e.findForm(a),i=".alert[aria-owns="+g+"]",j=null!==h?e.findElementsBySelector(h,i):e.findElementsBySelector(i),k=[];if(j.length<1){var l=e.findElementsByClass("alert");for(c=0,d=l.length;d>c;c+=1)e.hasAttribute(l[c],"aria-owns")&&e.getAttribute(l[c],"aria-owns")===g&&j.push(l[c])}for(c=0,d=j.length;d>c;c+=1)k.push(new f.FormValidatorAlert(j[c]));if(void 0!==b){for(c=0,d=k.length;d>c;c+=1)if(b===k[c].handle)return[k[c]];return[]}return k},adr.FormValidatorForm=function(a){var b=__imns("util.classes");this.form=null,this._is=null,this._not=null,this._check=[],this.master=new b.FormValidator,void 0!==a&&this.init(a)},adr.FormValidatorForm.prototype.init=function(a){var b=__imns("util.tools"),c=__imns("util.dom");if(this.form=__imns("util.validation").isFormElement(a)?a:null,null!==this.form){this.master.forms.push(this);b.fetter(this.form,"submit",[this.form,function(a){return(new(__imns("util.classes").FormValidator)).validate(b.findEventElement(a))}],!0);var d,e,f=c.findFormControls(this.form);for(d=0,e=f.length;e>d;d+=1)this.addControlChangeFunction(f[d]),this.addControlFocusFunction(f[d]),this.addControlUnfocusFunction(f[d]);for(d=0,e=f.length;e>d;d+=1){var g=f[d],h=c.hasAttribute(g,"type")&&"hidden"===c.getAttribute(g,"type")?!1:!0;h&&c.hasAttribute(g,"required")&&null!==c.getAttribute(g,"required")&&c.getAttribute(g,"required")!==!1&&this._check.push(g)}}},adr.FormValidatorForm.prototype.addControlFocusFunction=function(a){var b=this;__imns("util.tools").fetter(a,"focus",[a,function(a){b.clearRepeatedCheck();var c=__imns("util.tools").findEventElement(a);b.repeatedElement=c,b.repeated=setInterval(function(){b.controlRepeatedCheck(c)},800)}],!0)},adr.FormValidatorForm.prototype.clearRepeatedCheck=function(a){var b=null!==this.repeated?!0:!1;b=void 0!==a&&a!==this.repeatedElement?!1:b,b&&(clearInterval(this.repeated),this.repeated=null)},adr.FormValidatorForm.prototype.controlRepeatedCheck=function(a){return this.removeCheck(a),(new(__imns("util.classes").FormValidator)).validateControl(a)},adr.FormValidatorForm.prototype.addControlUnfocusFunction=function(a){var b=this;__imns("util.tools").fetter(a,"focusout",[a,function(a){var c=__imns("util.tools").findEventElement(a);b.clearRepeatedCheck(c)}],!0)},adr.FormValidatorForm.prototype.addControlChangeFunction=function(a){var b=this;__imns("util.tools").fetter(a,"change",[a,function(a){var c=__imns("util.tools").findEventElement(a);return b.removeCheck(c),(new(__imns("util.classes").FormValidator)).validateControl(c)}],!0)},adr.FormValidatorForm.prototype.removeCheck=function(a){for(var b=0,c=this._check.length;c>b;b+=1)a===this._check[b]&&(this._check.splice(b,1),b-=1)},adr.FormValidatorForm.prototype.checkAll=function(){return 0===this._check.length},adr.FormValidatorForm.prototype.is=function(){return null!==this._is&&"function"==typeof this._is&&this._is(),!0},adr.FormValidatorForm.prototype.not=function(){return null!==this._not&&"function"==typeof this._not&&this._not(),!0},adr.FormValidatorForm.prototype.setIs=function(a){return this._is=void 0!==a&&"function"==typeof a?a:this._is,this._is===a},adr.FormValidatorForm.prototype.setNot=function(a){return this._not=void 0!==a&&"function"==typeof a?a:this._not,this._not===a},adr.FormValidatorCustom=function(a){this.handle=null,this.func=null,this.elements=[],this.init(a)},adr.FormValidatorCustom.prototype.isValid=function(){return null!==this.handle&&null!==this.func&&this.elements.length>0},adr.FormValidatorCustom.prototype.influences=function(a){for(var b=0,c=this.elements.length;c>b;b+=1)if(this.elements[b]===a)return!0;return!1},adr.FormValidatorCustom.prototype.init=function(a){null!==a.handle&&this.setHandle(a.handle),null!==a.func&&this.setFunction(a.func),null!==a.elements&&this.setElements(a.elements)},adr.FormValidatorCustom.prototype.run=function(){var a=!0;return null!==this.func&&"function"==typeof this.func&&(a=this.func()),void 0===a||a?!0:!1},adr.FormValidatorCustom.prototype.setHandle=function(a){return this.handle="string"==typeof a?a:this.handle,this.handle===a},adr.FormValidatorCustom.prototype.setFunction=function(a){return this.func="function"==typeof a?a:this.func,this.func===a},adr.FormValidatorCustom.prototype.setElements=function(a){var b,c,d=__imns("util.validation"),e=__imns("util.dom"),f=[];if(d.isArray(a))f=a;else if(Arguments&&Arguments.length>0)for(b=0,c=Arguments.length;c>b;b+=1)f.push(Arguments[b]);for(b=0,c=f.length;c>b;b+=1)if(d.isHTMLElement(f[b]))this.elements.push(f[b]);else if("string"==typeof f[b]){var g=e.findElementsBySelector(f[b]);0===g.length&&(g=e.findElementsById(f[b]),g=d.isHTMLElement(g)?[g]:[]),this.elements=this.elements.concat(g)}return this.elements>0?!0:!1},adr.FormValidatorAlert=function(a){this.element=null,this.handle=null,this.ownsId=null,this.init(a)},adr.FormValidatorAlert.prototype.init=function(a){var b=__imns("util.validation"),c=__imns("util.dom");if(void 0!==a&&b.isHTMLElement(a)){this.element=a,this.ownsId=c.getAttribute(a,"aria-owns");var d=c.getAttribute(a,"id");this.handle=""!==this.ownsId&&d.indexOf(this.ownsId)!==!1?d.substring(this.ownsId.length):d}},__imns("util.tools").addFormValidation=function(a){var b=__imns("util.classes"),c=__imns("util.validation");if(c.isFormElement(a)){var d=(new b.FormValidator).findForm(a);if(null===d){var e=new b.FormValidatorForm(a);return e}return d}return!1});