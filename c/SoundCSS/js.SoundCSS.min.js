"use strict";var adr=__imns("component.classes");if(!("SoundCSSMaster"in adr)){adr.SoundCSSMaster=function(){var a=__imns("component.classes");return void 0!==a.SoundCSSMaster.prototype.singleton?a.SoundCSSMaster.prototype.singleton:(a.SoundCSSMaster.prototype.singleton=this,this.muted=!1,this.soundElements=[],this.srcFiles=[],this.element=null,this.initialised=!1,void this.init())},adr.SoundCSSMaster.prototype.init=function(){var a=__imns("util.tools"),b=__imns("component.classes");a.fetter(document,"DOMContentLoaded",function(){(new b.SoundCSSMaster).setup()},"after")},adr.SoundCSSMaster.prototype.setup=function(){console.log("setting up"),this.initialised=!0,this.addContainer()},adr.SoundCSSMaster.prototype.addContainer=function(){var a=__imns("util.dom"),b=a.findElementsByTag("body")[0],c="";void 0!==HTMLDivElement&&"function"==typeof HTMLDivElement?c=new HTMLDivElement:"createElement"in document&&(c=document.createElement("div")),a.setAttribute(c,"style","display:none; overflow: hidden; width: 1px; height: 1px;"),"appendChild"in b&&b.appendChild(c),this.element=c},adr.SoundCSSMaster.prototype.mute=function(a){var b=this.soundElements.length;if(this.muted=a===!0||a===!1?a:!this.muted,this.muted)for(;b>-1;)this.soundElements[b].endless&&this.soundElements[b].stop(),b-=1;else for(;b>-1;)this.soundElements[b].endless&&this.soundElements[b].play(),b-=1;return this.muted},adr.SoundCSSMaster.prototype.play=function(a){var b=__imns("util.validation");if(b.isNumber(a)&&a>-1&&a<this.soundElements.length&&(a=this.soundElements[a].srcset),b.isArray(a)){var c=this.findStoppedSoundElement(a);c.play()}},adr.SoundCSSMaster.prototype.findSrcFromIndex=function(a){var b=__imns("util.validation");return b.isNumber(a)&&a>-1&&a<this.soundElements.length?this.soundElements[a]:""},adr.SoundCSSMaster.prototype.matchSrc=function(a){var b=this.findSrcIndex(a);return b!==!1?this.soundElements[b]:!1},adr.SoundCSSMaster.prototype.findSrcIndex=function(a){for(var b=this.soundElements.length;b>0;)if(b-=1,this.soundElements[b].hasSrc(a))return b;return!1},adr.SoundCSSMaster.prototype.findStoppedSoundElement=function(a){for(var b=this.soundElements.length,c=__imns("component.classes");b>0;)if(b-=1,this.soundElements[b].hasSrc(a)&&this.soundElements[b].hasEnded())return this.soundElements[b];var d=new c.SoundCSSElement(a);return this.soundElements.push(d),this.soundElements[this.soundElements.length-1]},adr.SoundCSSMaster.prototype.createSound=function(a,b,c){var d=this.matchSrc(a),e=this.findSrcIndex(a),f=__imns("util.validation"),g=__imns("component.classes");if(d===!1){var h=new g.SoundCSSElement(a);this.soundElements.push(h),"endless"===b?(h.endless(),h.play()):f.isHTMLElement(c)&&this.attach(c,b,e)}},adr.SoundCSSMaster.prototype.attach=function(a,b,c){var d=__imns("util.tools"),e=__imns("component.classes");d.fetter(a,b,function(){(new e.SoundCSSMaster).play(c)})},adr.SoundCSSElement=function(a){this.element=null,this.endless=!1,this.srcset=[],this.mediaObject=null,this.setSrc(a)},adr.SoundCSSElement.prototype.setSrc=function(a){var b=__imns("util.validation");a=b.isArray(a)?a:[a],this.srcset=a},adr.SoundCSSElement.prototype.hasSrc=function(a){var b=__imns("util.validation");a=b.isArray(a)?a[0]:a;for(var c=this.srcset.length;c>0;)if(c-=1,this.srcset[c]===a)return!0;return!1},adr.SoundCSSElement.prototype.getElement=function(){return null===this.element?this.buildElement():this.element},adr.SoundCSSElement.prototype.buildElement=function(){var a=__imns("component.classes"),b=(new a.SoundCSSMaster).elem,c=__imns("util.tools"),d=__imns("util.dom");this.element=null,this.element=void 0!==HTMLAudioElement&&"function"==typeof HTMLAudioElement?new HTMLAudioElement:document.createElement("audio"),d.setAttribute(this.element,"controls","false"),d.setAttribute(this.element,"loop","false");for(var e=0,f=this.src.length;f>e;e+=1){var g="";g=void 0!==HTMLSourceElement&&"function"==typeof HTMLSourceElement?new HTMLSourceElement:document.createElement("source"),d.setAttribute(g,"src",this.src[e]);var h=c.determineMimeTypeFromFileExtension(this.src[e]);null!==h&&(d.setAttribute(g,"type",h),this.element.appendChild(g))}return b.appendChild(this.element),this.element},adr.SoundCSSElement.prototype.hasEnded=function(){return this.endless?!1:this.element.hasOwnProperty("ended")?this.element.ended:void 0},adr.SoundCSSElement.prototype.endless=function(){var a=__imns("util.dom");return a.setAttribute(this.element,"loop","true"),this.element.loop=!0,this.endless=!0,!0},adr.SoundCSSElement.prototype.play=function(){var a=this.getElement();"play"in a&&this.elem.play()},adr.SoundCSSElement.prototype.stop=function(){var a=this.getElement();"stop"in a&&this.elem.stop()};var ut=__imns("util.tools");ut.soundcss=function(a,b,c){var d=__imns("component.classes"),e=new d.SoundCSSMaster;e.initialised&&e.createSound(a,b,c)}}