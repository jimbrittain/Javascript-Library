"use strict";var adr=__imns("component.classes");if(!("SoundCSSMaster"in adr)){adr.SoundCSSMaster=function(){var a=__imns("component.classes");return void 0!==a.SoundCSSMaster.prototype.singleton?a.SoundCSSMaster.prototype.singleton:(a.SoundCSSMaster.prototype.singleton=this,this.muted=!1,this.shouldPreload=!0,this.soundElements=[],this.srcFiles=[],this.element=null,this.initialised=!1,void this.init())},adr.SoundCSSMaster.prototype.init=function(){var a=__imns("util.tools"),b=__imns("component.classes"),c=this;a.fetter(document,"DOMContentLoaded",[c,function(){(new b.SoundCSSMaster).setup()}],!0,"both")},adr.SoundCSSMaster.prototype.setup=function(){if(this.initialised=!0,this.addContainer(),this.shouldPreload){var a=__imns("util.tools"),b=__imns("component.classes"),c=this;a.fetter(window,"load",[c,function(){(new b.SoundCSSMaster).preload()}],!0,"both")}},adr.SoundCSSMaster.prototype.cancelPreload=function(){this.shouldPreload=!1},adr.SoundCSSMaster.prototype.preload=function(){for(var a=0,b=this.soundElements.length;b>a;a+=1)this.soundElements[a].getElement()},adr.SoundCSSMaster.prototype.addContainer=function(){if(null===this.element){var a=__imns("util.dom"),b=a.findElementsByTag("body")[0],c="";(void 0!==HTMLDivElement&&"function"==typeof HTMLDivElement||"createElement"in document)&&(c=document.createElement("div")),a.setAttribute(c,"style","display:none; overflow: hidden; width: 1px; height: 1px;"),"appendChild"in b&&b.appendChild(c),this.element=c}},adr.SoundCSSMaster.prototype.mute=function(a){var b=this.soundElements.length;if(this.muted=a===!0||a===!1?a:!this.muted,this.muted)for(;b>0;)b-=1,this.soundElements[b].endless&&this.soundElements[b].stop();else for(;b>0;)b-=1,this.soundElements[b].endless&&this.soundElements[b].play();return this.muted},adr.SoundCSSMaster.prototype.play=function(a){if(!this.muted){var b=__imns("util.validation");if(b.isNumber(a)&&a>-1&&a<this.soundElements.length&&(a=this.soundElements[a].srcset),b.isArray(a)){var c=this.findStoppedSoundElement(a);c.play()}}},adr.SoundCSSMaster.prototype.findSrcFromIndex=function(a){var b=__imns("util.validation");return b.isNumber(a)&&a>-1&&a<this.soundElements.length?this.soundElements[a]:""},adr.SoundCSSMaster.prototype.matchSrc=function(a){var b=this.findSrcIndex(a);return-1!==b?this.soundElements[b]:!1},adr.SoundCSSMaster.prototype.findSrcIndex=function(a){for(var b=this.soundElements.length;b>0;)if(b-=1,this.soundElements[b].hasSrc(a))return b;return-1},adr.SoundCSSMaster.prototype.findStoppedSoundElement=function(a){for(var b=this.soundElements.length,c=__imns("component.classes");b>0;)if(b-=1,this.soundElements[b].hasSrc(a)&&this.soundElements[b].hasEnded())return this.soundElements[b];var d=new c.SoundCSSElement(a);return this.soundElements.push(d),this.soundElements[this.soundElements.length-1]},adr.SoundCSSMaster.prototype.createSound=function(a,b,c){var d=this.matchSrc(a),e=__imns("util.validation"),f=__imns("component.classes");if(d===!1){var g=new f.SoundCSSElement(a);this.soundElements.push(g),d=g}if("endless"===c)d=this.findStoppedSound(a),d.endless(),d.play();else{var h=this.findSrcIndex(a);void 0===b||!e.isHTMLElement(b)&&b!==document?d.getElement():"now"!==c?(this.initialised&&d.getElement(),this.attach(b,c,h)):this.play(a)}},adr.SoundCSSMaster.prototype.attach=function(a,b,c){var d=__imns("util.tools"),e=__imns("component.classes");d.fetter(a,b,[a,function(){(new e.SoundCSSMaster).play(c)}])},adr.SoundCSSMaster.prototype.error=function(a){if("srcElement"in a&&__imns("util.validation").isHTMLElement(a.srcElement)){var b=__imns("util.dom").getAttribute(a.srcElement,"src");(new(__imns("util.debug").IMDebugger)).pass("SoundCSS could not load "+b),this.removeSrc(b)}},adr.SoundCSSMaster.prototype.__removeSingleSrc=function(a){for(var b=0;b<this.soundElements.length;)this.soundElements[b].hasSrc(a)&&(this.soundElements[b].removeSrc(a),this.soundElements[b].srcset.length<1&&(b-=1,this.soundElements.splice(b,1))),b+=1},adr.SoundCSSMaster.prototype.removeSrc=function(a){var b=__imns("util.validation");if(a=b.isArray(a)||"string"!=typeof a?a:[a],b.isArray(a)){for(var c=0,d=a.length;d>c;c+=1)this.__removeSingleSrc(a[c]);return!0}return!1},adr.SoundCSSElement=function(a){this.element=null,this.endless=!1,this.srcset=[],this.mediaObject=null,this.setSrc(a)},adr.SoundCSSElement.prototype.setSrc=function(a){var b=__imns("util.validation");a=b.isArray(a)?a:[a],this.srcset=a},adr.SoundCSSElement.prototype.hasSrc=function(a){var b=__imns("util.validation");a=b.isArray(a)?a[0]:a;for(var c=this.srcset.length;c>0;)if(c-=1,this.srcset[c]===a)return!0;return!1},adr.SoundCSSElement.prototype.removeSrc=function(a){for(var b=this.srcset.length;b>0;)b-=1,this.srcset[b]===a&&this.srcset.splice(b,1)},adr.SoundCSSElement.prototype.getElement=function(){return null===this.element?this.buildElement():this.element},adr.SoundCSSElement.prototype.buildElement=function(){if(this.srcset.length>0){var a=__imns("component.classes"),b=(new a.SoundCSSMaster).element,c=(__imns("util.tools"),__imns("util.dom"));this.element=null,this.element=document.createElement(void 0!==HTMLAudioElement&&"function"==typeof HTMLAudioElement?"audio":"audio");for(var d=0,e=this.srcset.length;e>d;d+=1){var f="";f=document.createElement(void 0!==HTMLSourceElement&&"function"==typeof HTMLSourceElement?"source":"source"),c.setAttribute(f,"src",this.srcset[d]);var g=(new a.MimeTypeLibrary).determineMimeTypeFromFileName(this.srcset[d]);null!==g&&void 0!==g&&(c.setAttribute(f,"type",g),this.element.appendChild(f))}return b.appendChild(this.element),c.setAttribute(this.element,"controls","false"),c.setAttribute(this.element,"loop","false"),"loop"in this.element&&(this.element.loop=!1),this.errorHandler(),this.element}},adr.SoundCSSElement.prototype.errorHandler=function(){var a=__imns("util.tools");a.fetter(this.element,"error",[this.element,function(a){var b=__imns("component.classes");(new b.SoundCSSMaster).error(a)}],!0)},adr.SoundCSSElement.prototype.hasEnded=function(){return this.endless?!1:null===this.element?!0:"ended"in this.element?this.element.ended:void 0},adr.SoundCSSElement.prototype.endless=function(){var a=__imns("util.dom");return a.setAttribute(this.element,"loop","true"),this.element.loop=!0,this.endless=!0,!0},adr.SoundCSSElement.prototype.play=function(){var a=this.getElement();"play"in a&&a.play()},adr.SoundCSSElement.prototype.stop=function(){var a=this.getElement();"stop"in a&&this.elem.stop()};var ut=__imns("util.tools");ut.soundcss=function(a,b,c){var d=__imns("component.classes"),e=new d.SoundCSSMaster,f=__imns("util.validation"),g=__imns("util.dom");"object"!=typeof a||f.isArray(a)||(c="evt"in a?a.evt:void 0,b="element"in a?a.element:void 0,a="src"in a?a.src:"srcset"in a?a.srcset:void 0);var h=void 0===c||void 0===b||void 0===a?!1:!0;if(e.initialised&&h){b=f.isHTMLElement(b)||b===document?[b]:g.htmlNodesToArray(b),c=f.isArray(c)?c:ut.commaStringToArray(c),a=f.isArray(a)?a:ut.commaStringToArray(a);var i,j,k,l;for(i=0,j=b.length;j>i;i+=1)for(k=0,l=c.length;l>k;k+=1)e.createSound(a,b[i],c[k])}}}