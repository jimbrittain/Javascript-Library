"use strict";var adr=__imns("util.tools");"IMFormData"in __imns("util.classes")||(__imns("util.classes").IMFormData=function(a){var b=__imns("util.validation"),c=__imns("util.dom");this.segments=[],this.gathered=!1,this.method="get",this.action="",this.form="",this.encoding="",void 0!==a&&b.isHTMLElement(a)&&"form"===c.getTagName(a)&&this.setForm(a)},__imns("util.classes").IMFormData.prototype.gather=function(a){var b=__imns("util.validation"),c=__imns("util.classes");if(a=void 0===a||b.isArray(a)?a:[a],b.isArray(a)){for(var d=0,e=a.length;e>d;d+=1){var f=new c.IMFormDataSegment(a[d]);f.valid&&this.segments.push(f)}return this.gathered=!0,this.segments.length>0?!0:!1}return!1},__imns("util.classes").IMFormData.prototype.setForm=function(a){var b=__imns("util.validation"),c=__imns("util.dom");b.isHTMLElement(a)&&"form"===c.getTagName(a)&&(this.form=a,this.setEncoding(),this.setAction(),this.setMethod())},__imns("util.classes").IMFormData.prototype.setMethod=function(a){var b=__imns("util.validation"),c=__imns("util.dom");switch(void 0===a&&b.isHTMLElement(this.form)&&(a="method"in this.form?this.form.method:c.getAttribute(this.form,"method")),a=b.isString(a)?a.toLowerCase():a){case"post":this.method="post";break;default:this.method="get"}return!0},__imns("util.classes").IMFormData.prototype.setAction=function(a){var b=__imns("util.validation"),c=__imns("util.dom");return void 0===a&&b.isHTMLElement(this.form)&&(a="action"in this.form?this.form.action:c.getAttribute(this.form,"action")),b.isString(a)&&""!==a?(this.action=a,!0):!1},__imns("util.classes").IMFormData.prototype.setEncoding=function(a){var b=__imns("util.validation"),c=__imns("util.dom");switch(void 0===a&&b.isHTMLElement(this.form)&&(a="enctype"in this.form?this.form.enctype:c.getAttribute(this.form,"enctype")),a){case"text/plain":this.encoding=a;break;case"multipart/form-data":this.encoding=a;break;default:this.encoding="application/x-www-form-urlencoded"}return!0},__imns("util.classes").IMFormData.prototype.url=function(a){return void 0!==a&&this.setAction(a),"post"===this.method?this.action:(this.setEncoding("application/x-www-form-urlencoded"),this.action+"?"+this.produceVars())},__imns("util.classes").IMFormData.prototype.send=function(a){var b=__imns("util.classes");"function"!=typeof a&&(a=function(){}),(new b.XHConn).connect(this.url(),this.method,this.theVars(),a)},__imns("util.classes").IMFormData.prototype.theVars=function(){var a=__imns("util.validation"),b=__imns("util.dom");return"get"!==this.method?"FormData"in window&&a.isHTMLElement(this.form)&&"form"===b.getTagName(this.form)?new FormData(this.form):this.produceVars():""},__imns("util.classes").IMFormData.prototype.produceVars=function(){{var a=__imns("util.validation"),b=__imns("util.dom");__imns("util.tools")}!this.gathered&&a.isHTMLElement(this.form)&&this.gather(b.findFormControls(this.form));var c=[];if(this.segments.length>0){for(var d=0,e=this.segments.length;e>d;d+=1){var f=this.produceSegmentVar(this.segments[d]);""!==f&&c.push(f)}if(c.length>0)switch(this.encoding){case"text/plain":return c.join("\r\n");case"multipart/form-data":var g="---------------------------"+Date.now().toString(16);return"--"+g+"\r\n"+c.join("--"+g+"\r\n")+"--"+g+"--\r\n";case"application/x-www-form-urlencoded":default:return c.join("&")}}return""},__imns("util.classes").IMFormData.prototype.produceSegmentVar=function(a){var b=__imns("util.tools"),c=__imns("util.classes"),d=a instanceof c.IMFormDataSegment?a:!1;if(d===!1||d.valid===!1)return"";if("file"===d.type)return"";var e="";switch(this.encoding){case"text/plain":e=b.plainTextEscape(d.name)+"="+b.plainTextEscape(d.value);break;case"multipart/form-data":e='Content-Disposition: form-data; name="'+d.name+'"\r\n\r\n'+d.value+"\r\n";break;case"application/x-www-form-urlencoded":default:e="encodeURI"in window?encodeURI(d.name):escape(d.name),e+="=",e+="encodeURI"in window?encodeURI(d.value):escape(d.value)}return e}),"IMFormDataSegment"in __imns("util.classes")||(__imns("util.classes").IMFormDataSegment=function(a){var b=__imns("util.validation");this.type="",this.name="",this.value="",this.valid=!1,void 0!==a&&(b.isHTMLElement(a)?this.buildFromElement(a):this.buildFromObject(a))},__imns("util.classes").IMFormDataSegment.prototype.buildFromElement=function(a){var b=__imns("util.dom"),c=__imns("util.validation");if(c.isHTMLElement(a)){var d=b.getTagName(a),e="",f="",g="";if(g="input"===d||"button"===d?b.getAttribute(a,"type"):d,e="name"in a?a.name:b.getAttribute(a,"name"),f="value"in a?a.value:b.getAttribute(a,"value"),console.log(g),"radio"===g||"checkbox"===g){var h="checked"in a?a.checked:!1;e=h?e:""}else if("option"===g){var i="selected"in a&&("true"===a.selected||"selected"===a.selected),j=b.findParent(a,["select","datalist"]);e=c.isHTMLElement(j)?"name"in j?j.name:b.getAttribute(j,"name"):"",e=i?e:""}else"file"===g&&(f="files"in a?a.files:"");if(""!==e&&""!==f&&""!==g)return this.name=e,this.value=f,this.type=g,this.valid=!0,!0}},__imns("util.classes").IMFormDataSegment.prototype.buildFromObject=function(a){var b=__imns("util.validation"),c="",d="",e="";return c="name"in a&&b.isString(a.name)?a.name:c,d="value"in a?a.value:d,e="type"in a&&b.isString(a.type)?a.type:"text",""!==c&&""!==d&&""!==e?(this.name=c,this.value=d,this.type=e,this.valid=!0,!0):void 0});