"use strict";var adr=__imns("component.classes");"PerfectGrid"in adr||(adr.PerfectGrid=function(){var a=__imns("component.classes"),b=!1,c=!1,d={};return a.PerfectGrid.prototype.singleton?(arguments&&arguments.length&&a.PerfectGrid.prototype.singleton.build(arguments),a.PerfectGrid.prototype.singleton):(b=!0,this.rows=[],this.args=[],this.fix_on_resize_boo=!0,this.refresh_boo=!0,this.minimum_margin=0,this.last_method_str="strict",this.multiline_boo=!0,arguments.length>0&&(d=new a.PerfectGridArgs,c=d.init(arguments),b&&(this.minimum_margin="margin"in d.optional?d.optional.margin:this.minimum_margin,this.refresh_boo="refresh"in d.optional?d.optional.refresh:this.refresh_boo,this.fix_on_resize_boo="resize"in d.optional?d.optional.resize:this.fix_on_resize_boo,this.last_method_str="method"in d.optional?d.optional.method:this.last_method_str,this.multiline_boo="multiline"in d.optional?d.optional.multiline:this.multiline_boo),c&&this.build(arguments)),this)},adr.PerfectGrid.prototype.findRowIdFromElement=function(a){var b=__imns("util.validation"),c=__imns("util.debug");if(void 0!==a&&b.isHTMLElement(a)){for(var d=!1,e=0,f=this.rows.length;f>e;e+=1)if(a===this.rows[e].element){d=e;break}return d}return(new c.IMDebugger).pass("PerfectRows.returnRowIdFromElement must be supplied a HTML Element"),!1},adr.PerfectGrid.prototype.findRowFromElement=function(a){var b=this.findRowIdFromElement(a);return b!==!1?this.rows[b]:void 0},adr.PerfectGrid.prototype.addRow=function(a){var b=__imns("component.classes"),c=__imns("util.debug");return a instanceof b.GridObject?this.elementExists(a.element)?this.rows[this.findRowIdFromElement(a.element)]:(this.rows.push(a),this.rows[this.rows.length-1].fix(),this.rows[this.rows.length-1]):void(new c.IMDebugger).pass("PerfectGrid.addRow must be supplied a valid GridObject.")},adr.PerfectGrid.prototype.deleteRowFromElement=function(a){var b=__imns("util.validation"),c=__imns("util.debug"),d=-1;return void 0!==a&&b.isHTMLElement(a)?this.elementExists(a)?(d=this.findRowIdFromElement(a),this.deleteRowFromId(d)):!1:((new c.IMDebugger).pass("PerfectGrid.deleteRowFromElement must be supplied a valid HTMLElement."),!1)},adr.PerfectGrid.prototype.deleteRowFromId=function(a){if(a>-1&&a<this.rows.length)return this.rows.splice(a,1),!0;var b=__imns("util.debug");return(new b.IMDebugger).pass("PerfectGrid.deleteRowFromId was supplied an invalid id that is outside the acceptable range."),!1},adr.PerfectGrid.prototype.deleteRedundantRows=function(){for(var a=__imns("util.validation"),b=__imns("util.dom"),c=this.rows.length-1,d=!1;c>-1;)void 0!==this.rows[c].element&&a.isHTMLElement(this.rows[c].element)&&b.inVisibleDOM(this.rows[c].element)||(d=this.deleteRowFromId(c)),c-=1;return this.rows.length},adr.PerfectGrid.prototype.elementExists=function(a){return this.findRowIdFromElement(a)===!1?!1:!0},adr.PerfectGrid.prototype.build=function(){var a=__imns("component.classes"),b=__imns("util.validation"),c=__imns("util.debug"),d=!1,e=!1,f={},g=[],h=[],i=null,j=0;if(arguments&&arguments.length>0)if(d=new a.PerfectGridArgs(arguments),d!==!1){f.multiline="multiline"in d.optional?d.optional.multiline:this.multiline_boo,f.margin="margin"in d.optional?d.optional.margin:this.minimum_margin,f.resize="resize"in d.optional?d.optional.resize:this.fix_on_resize_boo,f.method="method"in d.optional?d.optional.method:this.last_method_str,f.refresh="refresh"in d.optional?d.optional.refresh:this.refresh_boo,b.isHTMLElement(d.holder)?g.push(d.holder):"string"==typeof d.holder&&(g=$(d.holder));for(var k=0,l=g.length;l>k;k+=1)f.id=this.rows.length,f.holder=g[k],i=new a.GridObject(f),i instanceof a.GridObject&&(this.elementExists(f.holder)?h.push(this.findRowFromElement(i.element)):(this.rows.push(i),j=this.rows.length-1,this.rows[j].fix(),h.push(this.rows[j])));if(f.refresh){f.holder=d.holder,f.box=d.box;for(var m=!1,n=0,o=this.args.length;o>n;n+=1)if(this.args[n].holder===f.holder){m=!0;break}m||this.args.push(f)}}else e=!0;else e=!0;return!e&&h.length>0?1===h.length?h[0]:h:((new c.IMDebugger).pass("PerfectGrid.build not supplied with valid objects"),!1)},adr.PerfectGrid.prototype.refresh=function(){this.deleteRedundantRows();for(var a=0,b=this.args.length;b>a;a+=1)this.build(this.args[a])},adr.PerfectGrid.prototype.resize=function(){var a=__imns("util.validation"),b=this,c=0;if(this.fix_on_resize_boo&&void 0!==this.rows&&this.rows.length>0){for(c=this.rows.length-1;c>-1;)void 0!==this.rows[c].element&&a.isHTMLElement(this.rows[c].element)?this.rows[c].resize===!0&&b.rows[c].fix():this.deleteRowFromId(c),c-=1;return!0}return!1},adr.PerfectGrid.prototype.setResize=function(a){var b=void 0!==a&&a===!1?!1:!0,c=this;b?(this.fix_on_resize_boo=!0,$(window).resize($.debounce(500,function(){c.resize()}))):this.fix_on_resize_boo=!1},adr.GridObject=function(){if(this.to="",this.id=-1,this.resize=!1,this.element=void 0,this.boxIdentifier="*",this.type="justify",this.multiline=!0,this.customMarginRight=0,this.minimumMarginRight=0,this.hideOverflow=!1,this.numberOfItemsPerRow=1,this.totalItems=0,this.lastline=0,this.last_method="strict",this.callForMore=!1,this.callMoreAction=null,this.resizeHold="",arguments&&arguments.length&&"object"==typeof arguments[0]){var a=__imns("util.validation"),b=arguments[0],c=this;return"holder"in b&&(this.element=a.isHTMLElement(b.holder)?b.holder:"string"==typeof b.holder&&$(b.holder).length>0?$(b.holder)[0]:void 0),void 0!==this.element?(this.id="id"in b?parseInt(b.id):this.id,this.resize="resize"in b&&(b.resize===!0||b.resize===!1)?b.resize:this.resize,this.last_method="method"in b&&("strict"===b.method||"loose"===b.method)?b.method:this.last_method,this.multiline="multiline"in b&&(b.multiline===!0||b.multiline===!1)?b.multiline:this.multiline,this.multiline="row"in b?!1:this.multiline,this.multiline=$(c.element).hasClass("perfectrow")||!this.multiline?!1:this.multiline,this.multiline||(this.hideOverflow=!0,$(c.element).css("height",$(c.element).children(c.boxIdentifier).outerHeight(!1)),$(c.element).css("overflow","hidden")),this.boxIdentifier="box"in b&&$(this.element).children(b.box).length>0?b.box:"*",this.totalItems=$(c.element).children(c.boxIdentifier).length,this.minimumMarginRight=parseFloat("margin"in b?b.margin:$(c.element).children(c.boxIdentifier).css("margin-right")),this):void 0}},adr.GridObject.prototype.fix=function(){var a=this;$(a.element).children(a.boxIdentifier).each(function(b){a.resolveItem($(this)[0],b)})},adr.GridObject.prototype.getSpaceSize=function(){var a=.3;return parseFloat($(this.element).css("font-size"))*a},adr.GridObject.prototype.determineType=function(){var a=this,b=$(a.element).children(a.boxIdentifier);return"inline-block"===b.css("display")&&this.multiline?this.type="justify":"block"!==b.css("display")&&a.multiline||(this.type="float"),this.type},adr.GridObject.prototype.getItemHeight=function(){var a=__imns("util.validation"),b=__imns("util.debug"),c=this,d=0,e=[],f=0;if(void 0!==c.element&&a.isHTMLElement(c.element)){for(e=$(c.element).children(c.boxIdentifier),f=e.length-1;f>-1;){var g=Math.ceil($(e[f]).outerHeight(!1));d=g>d?g:d,f-=1}return d}return(new b.IMDebugger).pass("Grid Element does not exist!"),0},adr.GridObject.prototype.getItemWidth=function(){var a=__imns("util.validation"),b=__imns("util.debug"),c=this,d=0,e=[],f=0;if(void 0!==this.element&&a.isHTMLElement(this.element)){e=$(c.element).children(c.boxIdentifier),f=e.length;for(var g=0;f>g;g+=1)d+=parseInt($(e[g]).outerWidth(!1),10);return d>0?Math.ceil(d/f):0}return(new b.IMDebugger).pass("Row Element does does not exist!"),0},adr.GridObject.prototype.calculateCustomMargin=function(){var a=this,b=0,c=null,d=null,e=0,f=$(a.element).children(a.boxIdentifier);return c=$(f[0]),d=$(f[1]),e=c.position().left,e+=c.outerWidth(!0),b=d.position().left-e,b-=a.getSpaceSize(),b=Math.ceil(b),0>b?0:b},adr.GridObject.prototype.resolveItem=function(a,b){var c=this;switch(b){case 0:this.initialize();case 1:this.resolveFromSecondItem(a);default:this.defaultItemResolution(a),(b+1)%this.numberOfItemsPerRow===0&&this.lastOfRowResolution(a),b%this.numberOfItemsPerRow===0&&this.firstOfRowResolution(a),(b>=this.lastline&&b!==this.totalItems-1||!this.multiline)&&this.finalRowItemFix(a),b>=this.lastline&&b===this.totalItems-1&&(c.to=setTimeout(function(){c.resize=c.resizeHold,c.resizeHold="",clearTimeout(c.to)},1e3)),b>=this.numberOfItemsPerRow&&this.overflowResolution(a)}},adr.GridObject.prototype.initialize=function(){var a,b=this,c=0,d=0,e=0,f=$(this.element),g=$(b.element).children(b.boxIdentifier);switch(b.resizeHold=b.resize,b.resize=!1,f.remove("br.ie7breakpoints"),g.css("margin-right",0),d=f.width(),b.multiline||(e=this.getItemHeight(),a=f.innerHeight()-f.height(),f.css("height",e+a+"px").css("min-height",e+a+"px")),this.determineType()){case"justify":var h=0,i=0;if(h=b.getSpaceSize(),i=d+h,this.numberOfItemsPerRow=Math.floor(i/(this.getItemWidth()+h)),this.customMarginRight=d-this.getItemWidth()*this.numberOfItemsPerRow,this.customMarginRight/=this.numberOfItemsPerRow,this.customMarginRight+h<this.minimumMarginRight){var j=0;c=0,j=this.minimumMarginRight-h,g.css("margin-right",j+"px"),c=this.numberOfItemsPerRow,this.numberOfItemsPerRow=Math.floor(i/(this.getItemWidth()+j+h)),this.numberOfItemsPerRow!==c&&(this.customMarginRight=d-this.getItemWidth()*this.numberOfItemsPerRow,this.customMarginRight/=this.numberOfItemsPerRow,j=this.customMarginRight-h,g.css("margin-right",j+"px")),g.filter(":nth-of-type("+this.numberOfItemsPerRow+"n)").css("margin-right","0"),this.customMarginRight=j}this.lastline=this.totalItems%this.numberOfItemsPerRow,this.lastline=0===this.lastline?this.numberOfItemsPerRow:this.lastline,this.lastline=this.totalItems-this.lastline;break;case"float":d-=1,b.numberOfItemsPerRow=Math.floor(d/(b.getItemWidth()+b.getSpaceSize())),b.customMarginRight=d-(b.getItemWidth()+b.getSpaceSize())*b.numberOfItemsPerRow,b.customMarginRight=b.customMarginRight/(b.numberOfItemsPerRow-1),b.customMarginRight<b.minimumMarginRight&&(c=0,b.customMarginRight=b.minimumMarginRight,c=b.numberOfItemsPerRow,b.numberOfItemsPerRow=Math.floor((d+b.customMarginRight)/(b.getItemWidth()+b.customMarginRight+b.getSpaceSize())),c!==b.numberOfItemsPerRow&&(b.customMarginRight=d-b.getItemWidth()*b.numberOfItemsPerRow,b.customMarginRight=b.customMarginRight/(b.numberOfItemsPerRow-1),b.customMarginRight=b.customMarginRight))}},adr.GridObject.prototype.resolveFromSecondItem=function(){"justify"===this.type&&"loose"===this.last_method&&(this.customMarginRight=this.calculateCustomMargin())},adr.GridObject.prototype.defaultItemResolution=function(a){switch(a=$(a),a.css("visibility","visible").css("clear","none"),this.type){case"justify":a.css("margin-left",0);break;case"float":a.css("margin-right",this.customMarginRight)}},adr.GridObject.prototype.overflowResolution=function(a){!this.multiline&&this.hideOverflow&&$(a).css("visibility","hidden").css("margin-right",0)},adr.GridObject.prototype.firstOfRowResolution=function(a){if(this.multiline)switch(this.type){case"float":$(a).css("clear","left"),-1===navigator.appVersion.indexOf("MSIE 7.")||window.opera||(this.resize=!1,$(a).before('<br class="ie7breakpoints" clear="all" style="clear:both;" />'))}},adr.GridObject.prototype.lastOfRowResolution=function(a){switch(this.type){case"float":$(a).css("margin-right",0)}},adr.GridObject.prototype.finalRowItemFix=function(a){var b=$(a),c=this,d=$(c.element).children(c.boxIdentifier),e=$(c.element),f=0;if(this.multiline)switch(this.type){case"justify":switch(this.last_method){case"loose":b.css("margin-right",this.customMarginRight);break;case"strict":b.css("margin-right",this.calculateExactMargin(a)+"px")}}else f=d.outerHeight(!0)-d.outerHeight(!1),f=isNaN(f)?9:f,f+=parseInt(this.getItemHeight()),e.css("height",f),e.css("min-height",f)},adr.GridObject.prototype.findBoxId=function(a){var b=__imns("util.validation"),c=__imns("util.debug"),d=this,e=!1,f=null;if(void 0!==a&&b.isHTMLElement(a)){f=$(d.element).children(d.boxIdentifier);for(var g=0,h=f.length;h>g;g+=1)if(f[g]===a){e=g;break}return e}return(new c.IMDebugger).pass("GridObject.findBoxId must be supplied a HTML Element"),!1},adr.GridObject.prototype.calculateExactMargin=function(a){var b=this.findBoxId(a),c=this,d=b%this.numberOfItemsPerRow,e=0,f=0,g=$(c.element).children(c.boxIdentifier);return d===b?this.minimumMarginRight:(f=$(g[d+1]).position().left,e=$(g[b]).position().left+$(g[b]).outerWidth(),f-=e,f-=c.getSpaceSize(),f)},adr.PerfectGridArgs=function(){var a=!1;return this.holder=null,this.box=null,this.optional={},arguments.length>0?(a=this.init(arguments),a===!1?!1:this):this},adr.PerfectGridArgs.prototype.init=function(a){var b;return a=1===a.length&&"object"==typeof a[0]?a[0]:a,a=1===a.length&&"object"==typeof a[0]?a[0]:a,2===a.length?(this.holder=a[0],this.box=a[1]):"object"==typeof a&&(this.holder="holder"in a?a.holder:null,this.box="box"in a?a.box:null,"margin"in a&&(b="string"==typeof a.margin?parseFloat(a.margin):Number(a.margin),isNaN(b)||(this.optional.margin=a.margin)),"multiline"in a&&(this.optional.multiline=a.multiline===!1?!1:!0),"resize"in a&&(this.optional.resize=a.resize===!1?!1:!0),"refresh"in a&&(this.optional.refresh=a.refresh===!1?!1:!0),"method"in a&&(this.optional.method="strict"===a.method||"loose"===a.method?a.method:"strict")),null!==this.box&&null!==this.holder?!0:!1});