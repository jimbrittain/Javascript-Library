"use strict";function PerfectGrid(){var a=!1,b=!1,c={};return PerfectGrid.prototype.singletonInstance?(arguments&&arguments.length&&PerfectGrid.prototype.singletonInstance.build(arguments),PerfectGrid.prototype.singletonInstance):(a=!0,this.rows=[],this.args=[],this.fix_on_resize_boo=!0,this.refresh_boo=!0,this.minimum_margin=0,this.last_method_str="strict",this.multiline_boo=!0,arguments.length>0&&(c=new PerfectGridArgs,b=c.init(arguments),a&&(this.minimum_margin="margin"in c.optional?c.optional.margin:this.minimum_margin,this.refresh_boo="refresh"in c.optional?c.optional.refresh:this.refresh_boo,this.fix_on_resize_boo="resize"in c.optional?c.optional.resize:this.fix_on_resize_boo,this.last_method_str="method"in c.optional?c.optional.method:this.last_method_str,this.multiline_boo="multiline"in c.optional?c.optional.multiline:this.multiline_boo),b&&this.build(arguments)),this)}function GridObject(){if(this.to="",this.id=-1,this.resize=!1,this.element=void 0,this.boxIdentifier="*",this.type="justify",this.multiline=!0,this.customMarginRight=0,this.minimumMarginRight=0,this.hideOverflow=!1,this.numberOfItemsPerRow=1,this.totalItems=0,this.lastline=0,this.last_method="strict",this.callForMore=!1,this.callMoreAction=null,this.resizeHold="",arguments&&arguments.length&&"object"==typeof arguments[0]){var a=arguments[0],b=this;return"holder"in a&&(this.element=isHTMLElement(a.holder)?a.holder:"string"==typeof a.holder&&$(a.holder).length>0?$(a.holder)[0]:void 0),void 0!==this.element?(this.id="id"in a?parseInt(a.id):this.id,this.resize="resize"in a&&(a.resize===!0||a.resize===!1)?a.resize:this.resize,this.last_method="method"in a&&("strict"===a.method||"loose"===a.method)?a.method:this.last_method,this.multiline="multiline"in a&&(a.multiline===!0||a.multiline===!1)?a.multiline:this.multiline,this.multiline="row"in a?!1:this.multiline,this.multiline=$(b.element).hasClass("perfectrow")||!this.multiline?!1:this.multiline,this.multiline||(this.hideOverflow=!0,$(b.element).css("height",$(b.element).children(b.boxIdentifier).outerHeight(!1)),$(b.element).css("overflow","hidden")),this.boxIdentifier="box"in a&&$(this.element).children(a.box).length>0?a.box:"*",this.totalItems=$(b.element).children(b.boxIdentifier).length,this.minimumMarginRight=parseFloat("margin"in a?a.margin:$(b.element).children(b.boxIdentifier).css("margin-right")),this):void 0}}function PerfectGridArgs(){var a=!1;return this.holder=null,this.box=null,this.optional={},arguments.length>0?(a=this.init(arguments),a===!1?!1:this):this}PerfectGrid.prototype.findRowIdFromElement=function(a){if(void 0!==a&&isHTMLElement(a)){for(var b=!1,c=0,d=this.rows.length;d>c;c+=1)if(a===this.rows[c].element){b=c;break}return b}return(new IMDebugger).pass("PerfectRows.returnRowIdFromElement must be supplied a HTML Element"),!1},PerfectGrid.prototype.findRowFromElement=function(a){var b=this.findRowIdFromElement(a);return b!==!1?this.rows[b]:void 0},PerfectGrid.prototype.addRow=function(a){return a instanceof GridObject?this.elementExists(a.element)?this.rows[this.findRowIdFromElement(a.element)]:(this.rows.push(a),this.rows[this.rows.length-1].fix(),this.rows[this.rows.length-1]):void(new IMDebugger).pass("PerfectGrid.addRow must be supplied a valid GridObject.")},PerfectGrid.prototype.deleteRowFromElement=function(a){var b=-1;return void 0!==a&&isHTMLElement(a)?this.elementExists(a)?(b=this.findRowIdFromElement(a),this.deleteRowFromId(b)):!1:((new IMDebugger).pass("PerfectGrid.deleteRowFromElement must be supplied a valid HTMLElement."),!1)},PerfectGrid.prototype.deleteRowFromId=function(a){return a>-1&&a<this.rows.length?(this.rows.splice(a,1),!0):((new IMDebugger).pass("PerfectGrid.deleteRowFromId was supplied an invalid id that is outside the acceptable range."),!1)},PerfectGrid.prototype.deleteRedundantRows=function(){for(var a=this.rows.length-1,b=!1;a>-1;)void 0!==this.rows[a].element&&isHTMLElement(this.rows[a].element)&&inVisibleDOM(this.rows[a].element)||(b=this.deleteRowFromId(a)),a-=1;return this.rows.length},PerfectGrid.prototype.elementExists=function(a){return this.findRowIdFromElement(a)===!1?!1:!0},PerfectGrid.prototype.build=function(){var a=!1,b=!1,c={},d=[],e=[],f=null,g=0;if(arguments&&arguments.length>0)if(a=new PerfectGridArgs(arguments),a!==!1){c.multiline="multiline"in a.optional?a.optional.multiline:this.multiline_boo,c.margin="margin"in a.optional?a.optional.margin:this.minimum_margin,c.resize="resize"in a.optional?a.optional.resize:this.fix_on_resize_boo,c.method="method"in a.optional?a.optional.method:this.last_method_str,c.refresh="refresh"in a.optional?a.optional.refresh:this.refresh_boo,isHTMLElement(a.holder)?d.push(a.holder):"string"==typeof a.holder&&(d=$(a.holder));for(var h=0,i=d.length;i>h;h+=1)c.id=this.rows.length,c.holder=d[h],f=new GridObject(c),f instanceof GridObject&&(this.elementExists(c.holder)?e.push(this.findRowFromElement(f.element)):(this.rows.push(f),g=this.rows.length-1,this.rows[g].fix(),e.push(this.rows[g])));if(c.refresh){c.holder=a.holder,c.box=a.box;for(var j=!1,k=0,l=this.args.length;l>k;k+=1)if(this.args[k].holder===c.holder){j=!0;break}j||this.args.push(c)}}else b=!0;else b=!0;return!b&&e.length>0?1===e.length?e[0]:e:((new IMDebugger).pass("PerfectGrid.build not supplied with valid objects"),!1)},PerfectGrid.prototype.refresh=function(){this.deleteRedundantRows();for(var a=0,b=this.args.length;b>a;a+=1)this.build(this.args[a])},PerfectGrid.prototype.resize=function(){var a=this,b=0;if(this.fix_on_resize_boo&&void 0!==this.rows&&this.rows.length>0){for(b=this.rows.length-1;b>-1;)void 0!==this.rows[b].element&&isHTMLElement(this.rows[b].element)?this.rows[b].resize===!0&&a.rows[b].fix():this.deleteRowFromId(b),b-=1;return!0}return!1},PerfectGrid.prototype.setResize=function(a){var b=void 0!==a&&a===!1?!1:!0,c=this;b?(this.fix_on_resize_boo=!0,$(window).resize($.debounce(500,function(){c.resize()}))):this.fix_on_resize_boo=!1},GridObject.prototype.fix=function(){var a=this;$(a.element).children(a.boxIdentifier).each(function(b){a.resolveItem($(this)[0],b)})},GridObject.prototype.getSpaceSize=function(){var a=.3;return parseFloat($(this.element).css("font-size"))*a},GridObject.prototype.determineType=function(){var a=this,b=$(a.element).children(a.boxIdentifier);return"inline-block"===b.css("display")&&this.multiline?this.type="justify":"block"!==b.css("display")&&a.multiline||(this.type="float"),this.type},GridObject.prototype.getItemHeight=function(){var a=this,b=0,c=[],d=0;if(void 0!==a.element&&isHTMLElement(a.element)){for(c=$(a.element).children(a.boxIdentifier),d=c.length-1;d>-1;){var e=Math.ceil($(c[d]).outerHeight(!1));b=e>b?e:b,d-=1}return b}return(new IMDebugger).pass("Grid Element does not exist!"),0},GridObject.prototype.getItemWidth=function(){var a=this,b=0,c=[],d=0;if(void 0!==this.element&&isHTMLElement(this.element)){c=$(a.element).children(a.boxIdentifier),d=c.length;for(var e=0;d>e;e+=1)b+=parseInt($(c[e]).outerWidth(!1),10);return b>0?Math.ceil(b/d):0}return(new IMDebugger).pass("Row Element does does not exist!"),0},GridObject.prototype.calculateCustomMargin=function(){var a=this,b=0,c=null,d=null,e=0,f=$(a.element).children(a.boxIdentifier);return c=$(f[0]),d=$(f[1]),e=c.position().left,e+=c.outerWidth(!0),b=d.position().left-e,b-=a.getSpaceSize(),b=Math.ceil(b),0>b?0:b},GridObject.prototype.resolveItem=function(a,b){var c=this;switch(b){case 0:this.initialize();case 1:this.resolveFromSecondItem(a);default:this.defaultItemResolution(a),(b+1)%this.numberOfItemsPerRow===0&&this.lastOfRowResolution(a),b%this.numberOfItemsPerRow===0&&this.firstOfRowResolution(a),(b>=this.lastline&&b!==this.totalItems-1||!this.multiline)&&this.finalRowItemFix(a),b>=this.lastline&&b===this.totalItems-1&&(c.to=setTimeout(function(){c.resize=c.resizeHold,c.resizeHold="",clearTimeout(c.to)},1e3)),b>=this.numberOfItemsPerRow&&this.overflowResolution(a)}},GridObject.prototype.initialize=function(){var a,b=this,c=0,d=0,e=0,f=$(this.element),g=$(b.element).children(b.boxIdentifier);switch(b.resizeHold=b.resize,b.resize=!1,f.remove("br.ie7breakpoints"),g.css("margin-right",0),d=f.width(),b.multiline||(e=this.getItemHeight(),a=f.innerHeight()-f.height(),f.css("height",e+a+"px").css("min-height",e+a+"px")),this.determineType()){case"justify":var h=0,i=0;if(h=b.getSpaceSize(),i=d+h,this.numberOfItemsPerRow=Math.floor(i/(this.getItemWidth()+h)),this.customMarginRight=d-this.getItemWidth()*this.numberOfItemsPerRow,this.customMarginRight/=this.numberOfItemsPerRow,this.customMarginRight+h<this.minimumMarginRight){var j=0;c=0,j=this.minimumMarginRight-h,g.css("margin-right",j+"px"),c=this.numberOfItemsPerRow,this.numberOfItemsPerRow=Math.floor(i/(this.getItemWidth()+j+h)),this.numberOfItemsPerRow!==c&&(this.customMarginRight=d-this.getItemWidth()*this.numberOfItemsPerRow,this.customMarginRight/=this.numberOfItemsPerRow,j=this.customMarginRight-h,g.css("margin-right",j+"px")),g.filter(":nth-of-type("+this.numberOfItemsPerRow+"n)").css("margin-right","0"),this.customMarginRight=j}this.lastline=this.totalItems%this.numberOfItemsPerRow,this.lastline=0===this.lastline?this.numberOfItemsPerRow:this.lastline,this.lastline=this.totalItems-this.lastline;break;case"float":d-=1,b.numberOfItemsPerRow=Math.floor(d/(b.getItemWidth()+b.getSpaceSize())),b.customMarginRight=d-(b.getItemWidth()+b.getSpaceSize())*b.numberOfItemsPerRow,b.customMarginRight=b.customMarginRight/(b.numberOfItemsPerRow-1),b.customMarginRight<b.minimumMarginRight&&(c=0,b.customMarginRight=b.minimumMarginRight,c=b.numberOfItemsPerRow,b.numberOfItemsPerRow=Math.floor((d+b.customMarginRight)/(b.getItemWidth()+b.customMarginRight+b.getSpaceSize())),c!==b.numberOfItemsPerRow&&(b.customMarginRight=d-b.getItemWidth()*b.numberOfItemsPerRow,b.customMarginRight=b.customMarginRight/(b.numberOfItemsPerRow-1),b.customMarginRight=b.customMarginRight))}},GridObject.prototype.resolveFromSecondItem=function(){"justify"===this.type&&"loose"===this.last_method&&(this.customMarginRight=this.calculateCustomMargin())},GridObject.prototype.defaultItemResolution=function(a){switch(a=$(a),a.css("visibility","visible").css("clear","none"),this.type){case"justify":a.css("margin-left",0);break;case"float":a.css("margin-right",this.customMarginRight)}},GridObject.prototype.overflowResolution=function(a){!this.multiline&&this.hideOverflow&&$(a).css("visibility","hidden").css("margin-right",0)},GridObject.prototype.firstOfRowResolution=function(a){if(this.multiline)switch(this.type){case"float":$(a).css("clear","left"),-1===navigator.appVersion.indexOf("MSIE 7.")||window.opera||(this.resize=!1,$(a).before('<br class="ie7breakpoints" clear="all" style="clear:both;" />'))}},GridObject.prototype.lastOfRowResolution=function(a){switch(this.type){case"float":$(a).css("margin-right",0)}},GridObject.prototype.finalRowItemFix=function(a){var b=$(a),c=this,d=$(c.element).children(c.boxIdentifier),e=$(c.element),f=0;if(this.multiline)switch(this.type){case"justify":switch(this.last_method){case"loose":b.css("margin-right",this.customMarginRight);break;case"strict":b.css("margin-right",this.calculateExactMargin(a)+"px")}}else f=d.outerHeight(!0)-d.outerHeight(!1),f=isNaN(f)?9:f,f+=parseInt(this.getItemHeight()),e.css("height",f),e.css("min-height",f)},GridObject.prototype.findBoxId=function(a){var b=this,c=!1,d=null;if(void 0!==a&&isHTMLElement(a)){d=$(b.element).children(b.boxIdentifier);for(var e=0,f=d.length;f>e;e+=1)if(d[e]===a){c=e;break}return c}return(new IMDebugger).pass("GridObject.findBoxId must be supplied a HTML Element"),!1},GridObject.prototype.calculateExactMargin=function(a){var b=this.findBoxId(a),c=this,d=b%this.numberOfItemsPerRow,e=0,f=0,g=$(c.element).children(c.boxIdentifier);return d===b?this.minimumMarginRight:(f=$(g[d+1]).position().left,e=$(g[b]).position().left+$(g[b]).outerWidth(),f-=e,f-=c.getSpaceSize(),f)},PerfectGridArgs.prototype.init=function(a){var b;return a=1===a.length&&"object"==typeof a[0]?a[0]:a,a=1===a.length&&"object"==typeof a[0]?a[0]:a,2===a.length?(this.holder=a[0],this.box=a[1]):"object"==typeof a&&(this.holder="holder"in a?a.holder:null,this.box="box"in a?a.box:null,"margin"in a&&(b="string"==typeof a.margin?parseFloat(a.margin):Number(a.margin),isNaN(b)||(this.optional.margin=a.margin)),"multiline"in a&&(this.optional.multiline=a.multiline===!1?!1:!0),"resize"in a&&(this.optional.resize=a.resize===!1?!1:!0),"refresh"in a&&(this.optional.refresh=a.refresh===!1?!1:!0),"method"in a&&(this.optional.method="strict"===a.method||"loose"===a.method?a.method:"strict")),null!==this.box&&null!==this.holder?!0:!1};