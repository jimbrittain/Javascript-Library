"use strict";var adr=__imns("component.classes");"Carousel"in adr||(adr.Carousel=function(a){var b=__imns("component.classes");this.initialised=!1,this.active=!0,this.infinite=!1,this.container=null,this.id="",this.innercontainer=null,this.itemSelector="*",this.on=new b.CarouselItemReference(0,null,this),this.loop=!1,this.advancement=new b.CarouselAdvancement,this.buffer=0,this.events={},this._requestNext=null,this._requestPrior=null,this._transition=null,this._visibility=null,this.first=-(1/0),this.last=1/0,this._nextdirection=null,this.waitingonnext=!1,this.waitingonprior=!1,this._innerclassname="imcarouselinner",void 0===b.Carousel.prototype.idint&&(b.Carousel.prototype.idint=0),this.init(a)},adr.Carousel.prototype.init=function(a){var b=(__imns("util.classes"),__imns("util.tools"));if("object"==typeof a){var c={advancement:[1,1],buffer:0,container:null,direction:"",first:-(1/0),infiniteVisible:!1,initial:!1,itemSelector:"*",last:1/0,loop:!1,requestNext:null,requestPrior:null,transition:null,visibility:null};a=b.handlePassedArguments(a,c);var d=this.setContainer(a.container),e=this.setItems(a.itemSelector);this.initContainer(),this.buildInnerContainer(),this.setBuffer(a.buffer),this.setLoop(a.loop),this.setAdvancement(a.advancement),this.setFirst(a.first),this.setLast(a.last),this.setOnlyInitial(a.initial),this.setRequestNext(a.requestNext),this.setRequestPrior(a.requestPrior),this.setTransition(a.transition),this.setVisibilityTest(a.visibility),""!==a.direction?this.fixNextDirection(a.direction):this.softFixNextDirection(),this.events={requestedNext:b.createEvent("carouselRequestNext"),requestedPrior:b.createEvent("carouselRequestPrior"),receivedNext:b.createEvent("carouselReceivedNext"),receivedPrior:b.createEvent("carouselReceivedPrior"),transitionStart:b.createEvent("carouselTransitionStart"),transitionEnd:b.createEvent("carouselTransitionEnd"),error:b.createEvent("carouselError"),initialised:b.createEvent("carouselInitialised"),reachedFirst:b.createEvent("carouselReachedFirst"),reachedLast:b.createEvent("carouselReachedLast"),setActive:b.createEvent("carouselSetActive"),setInactive:b.createEvent("carouselSetInactive"),slide:b.createEvent("carouselSlide"),loopFirst:b.createEvent("carouselLoopFirst"),loopLast:b.createEvent("carouselLoopLast")},d&&e&&(this.initialised=!0,this.setOn(0),b.fireElementEvent(this.container,this.events.initialised))}return this.initialised},adr.Carousel.prototype.setFirst=function(a){var b=__imns("util.validation"),c=a;return b.isNumber(c)?(c=parseInt(c),c>0&&(c=0),this.first=c):this.first=-(1/0),a===this.first},adr.Carousel.prototype.setLast=function(a){var b=__imns("util.validation"),c=a;return b.isNumber(c)?(c=parseInt(c),c<0&&(c=0),this.last=c):this.last=1/0,a===this.last},adr.Carousel.prototype.setAdvancement=function(a,b){this.advancement=new(__imns("component.classes").CarouselAdvancement)(a,b)},adr.Carousel.prototype.setInfiniteVisible=function(a){var b=__imns("util.validation");return a=void 0===a||a,!!b.isBoolean(a)&&(this.infinite=a,!0)},adr.Carousel.prototype.infiniteItems=adr.Carousel.prototype.setInfiniteVisible,adr.Carousel.prototype.setContainer=function(a){var b=__imns("util.dom"),c=__imns("util.validation");if(c.isString(a)){var d=b.findElementsBySelector(a);a=1===d.length?d[0]:a}return!!c.isHTMLElement(a)&&(this.container=a,!0)},adr.Carousel.prototype.initContainer=function(){var a=__imns("util.dom"),b=__imns("component.classes");a.addClass(this.container,"carousel"),a.hasAttribute("tabindex")||a.setAttribute(this.container,"tabindex","-1"),a.hasAttribute(this.container,"id")||(b.Carousel.prototype.idint+=1,a.setAttribute(this.container,"imcarousel"+b.Carousel.prototype.idint)),this.id=a.getAttribute(this.container,"id")},adr.Carousel.prototype.buildInnerContainer=function(){var a=__imns("util.validation"),b=__imns("util.dom");if(null!==this.container){var c="childNodes"in this.container?this.container.childNodes[0]:"children"in this.container?this.container.children[0]:null;if(a.isHTMLElement(c)&&b.hasClass(c,this._innerclassname))return!0;var d="";"createElement"in document?(d=document.createElement("div"),d.setAttribute("class",this._innerclassname)):d='<div class="'+this._innerclassname+'"></div>',b.wrapElementsWithElement(this.getItems(),d),this.innercontainer=b.findElementsBySelector(this.container,"."+this._innerclassname)[0]}return!1},adr.Carousel.prototype.setItems=function(a){var b=__imns("util.dom"),c=__imns("util.validation");if(c.isString(a)&&null!==this.container){var d=b.findElementsBySelector(this.container,a);if(d.length>0)return this.itemSelector=a,!0}return!1},adr.Carousel.prototype.setTransition=function(a){var b=__imns("util.validation"),c=__imns("component.classes");return!!(b.isFunction(a)||null===a||a instanceof c.CarouselTransition)&&(this._transition=a,!0)},adr.Carousel.prototype.setVisibilityTest=function(a){var b=__imns("util.validation");return!(!b.isFunction(a)&&null!==a)&&(this._visibility=a,!0)},adr.Carousel.prototype.setBuffer=function(a){var b=__imns("util.validation");return this.buffer=b.isNumber(a)?Math.abs(Math.round(a)):this.buffer,a===this.buffer},adr.Carousel.prototype.setLoop=function(a){var b=__imns("util.validation"),c=!!b.isBoolean(a)&&a;return this.loop=c,c===a},adr.Carousel.prototype.directionKeys=function(a){a=void 0===a||a!==!1?0:180;var b=null!==this._nextdirection?this._nextdirection:this.getNextDirection();b+=a,b%=360,b=b<0?360-b:b;var c=[];return 0===b||b>0&&b<90||b>270&&b<360?(c.push("ArrowRight"),c.push(39)):b>90&&b<270&&(c.push("ArrowLeft"),c.push(37)),b>0&&b<180?(c.push("ArrowDown"),c.push(40)):b>180&&b<360&&(c.push("ArrowUp"),c.push(38)),c},adr.Carousel.prototype.nextDirectionKeys=function(){return this.directionKeys(!0)},adr.Carousel.prototype.priorDirectionKeys=function(){return this.directionKeys(!1)},adr.Carousel.prototype.softFixNextDirection=function(){var a=__imns("util.dom"),b="ltr";a.hasAttribute(this.container,"dir")&&null!==a.getAttribute(this.container,"dir")?(b=a.getAttribute(this.container,"dir"),this.fixNextDirection(b)):(b=a.findElementStyleDeep(this.container,"direction"),"ltr"!==b&&this.fixNextDirection(b))},adr.Carousel.prototype.getNextDirection=function(){var a=__imns("util.classes"),b=this.getItems(),c=null,d=null,e=this.on.id;if(c=void 0!==b[e]?new a.BoundaryCoordinates(b[e]):null,e+=1,d=void 0!==b[d]?new a.BoundaryCoordinates(b[e]):null,null!==d&&null!==c){var f=new a.Coordinates(c.x1,c.y1),g=new a.Coordinates(f.x1,f.y1),h=new a.Coordinates(f.distanceToX(g),f.distanceToY(g));if(h.x>0)return h.y<0?315:h.y>0?45:0;if(h.x<0)return h.y<0?225:h.y>0?135:0;if(0===h.x)return h.y<0?270:h.y>0?90:0}return 0},adr.Carousel.prototype.fixNextDirection=function(a){var b=__imns("util.validation");if(b.isNumber(a))return a%=360,a=a<0?360-a:a,this._nextdirection=a,!0;if(b.isString(a))switch(a=a.toLowerCase()){case"left":case"rtl":case"l":return this._nextdirection=180,!0;case"right":case"ltr":case"r":return this._nextdirection=0,!0;case"top":case"btt":case"t":return this._nextdirection=270,!0;case"bottom":case"ttb":case"b":return this._nextdirection=90,!0;case"topleft":case"tl":case"lt":case"lefttop":return this._nextdirection=315,!0;case"topright":case"tr":case"rt":case"righttop":return this._nextdirection=225,!0;case"bottomleft":case"bl":case"lb":case"leftbottom":return this._nextdirection=135,!0;case"bottomright":case"br":case"rb":case"rightbottom":return this._nextdirection=45,!0}return!1},adr.Carousel.prototype.setActive=function(a){var b=__imns("util.validation"),c=__imns("util.tools"),d=!b.isBoolean(a)||a;return d?(this.active=!0,c.fireElementEvent(this.container,"setActive")):(this.active=!1,c.fireElementEvent(this.container,"setInactive")),d===a},adr.Carousel.prototype.setInactive=function(){return this.setActive(!1)},adr.Carousel.prototype.getItems=function(){var a=__imns("util.dom");return a.findElementsBySelector(this.container,this.itemSelector)},adr.Carousel.prototype.numberOfItems=function(){return this.getItems().length},adr.Carousel.prototype.findItemId=function(a){var b=__imns("util.validation");if(b.isHTMLElement(a))for(var c=this.getItems(),d=0,e=c.length;d<e;d+=1)if(a===c[d])return d;return!1},adr.Carousel.prototype.isItem=function(a){return this.findItemId(a)!==!1},adr.Carousel.prototype.onItem=function(){var a=this.getItems();return void 0!==a[this.on.id]?a[this.on.id]:null},adr.Carousel.prototype.numberVisible=function(){__imns("util.classes");if(this.initialised){if(this.infinite)return 1/0;for(var a=this.getItems(),b=0,c=0,d=a.length;c<d;c+=1)this.isItemVisible(a[c])&&(b+=1);return b}return 0},adr.Carousel.prototype.isItemVisible=function(a){var b=__imns("util.classes"),c=__imns("util.dom"),d=__imns("util.validation");if(d.isNumber(a)?a=Math.abs(a)===a&&a>-1&&a>this.numberOfItems()?this.getItems()[a]:-1:d.isHTMLElement(a)&&(a=this.isItem(a)?a:-1),d.isHTMLElement(a)){var e=!1;if(null!==this._visibility&&d.isFunction(this._visibility)){var f=this._visibility(a);if(d.isBoolean(f))return e=!0,f}if(!e){if("none"===c.findElementStyleDeep(a,"display"))return!1;var g=new b.BoundaryCoordinates(this.container),h=new b.BoundaryCoordinates(a);return!!g.isOverlap(h)}}return!1},adr.Carousel.prototype.onlyCurrent=function(a){var b=__imns("util.validation");return!!b.isBoolean(a)&&(this.initial=a,this.initial?(this.setFirst(0),this.setLast(this.getItems().length)):(this.first=this.first,this.last=this.last),!0)},adr.Carousel.prototype.setOnlyInitial=adr.Carousel.prototype.onlyCurrent,adr.Carousel.prototype.prior=function(){this._move(new(__imns("component.classes").CarouselMovement)({carousel:this,distance:0-this.advancement.prior}))},adr.Carousel.prototype.next=function(){this._move(new(__imns("component.classes").CarouselMovement)({carousel:this,distance:this.advancement.next}))},adr.Carousel.prototype.advance=function(a){var b=__imns("util.validation"),c=__imns("component.classes");if(b.isNumber(a))if(a=Math.round(a),a>0){var d=new c.CarouselMovement({carousel:this,distance:a});this._move(d)}else a<0&&this.retreat(Math.abs(a))},adr.Carousel.prototype.retreat=function(a){var b=__imns("util.validation"),c=__imns("component.classes");if(b.isNumber(a))if(a=Math.round(a),a=0-a,a<0){var d=new c.CarouselMovement({carousel:this,distance:a});this._move(d)}else a>0&&this.advance(a)},adr.Carousel.prototype.goto=function(a){var b=__imns("util.validation"),c=__imns("component.classes");if(b.isNumber(a)){a=Math.round(a);var d=new c.CarouselMovement({carousel:this,target:a});d.getTarget()===a&&this._move(d)}},adr.Carousel.prototype._move=function(a){var b=__imns("component.classes"),c=__imns("util.validation");if(a=a instanceof b.CarouselMovement||!c.isNumber(a)?a:new b.CarouselMovement(this,a),this.active&&this.initialised&&a instanceof b.CarouselMovement)if(!this.hasAvailable(a)||this.shouldUseBuffer(a)&&!this.hasBufferAvailable(a)){var d=a.getDistance();d>0?(this.waitingonnext=!0,this.requestNext(a)):d<0&&(this.waitingonprior=!0,this.requestPrior(a))}else this.transition(a)},adr.Carousel.prototype.firstAvailableId=function(){return 0},adr.Carousel.prototype.firstAvailable=function(){return this.getItems()[this.firstAvailableId()]},adr.Carousel.prototype.lastAvailableId=function(){var a=this.getItems().length-1;return a<0?0:a},adr.Carousel.prototype.lastAvailable=function(){return this.getItems()[this.lastAvailableId()]},adr.Carousel.prototype.firstVisibleId=function(){for(var a=__imns("util.dom"),b=this.getItems(),c=this.on.id,d=this.on.id,e=-1;d>e&&("none"!==a.findElementStyleDeep(b[d],"display")&&this.isItemVisible(b[d]));d-=1)c=d;return c},adr.Carousel.prototype.firstVisible=function(){return this.getItems()[this.firstVisibleId()]},adr.Carousel.prototype.lastVisibleId=function(){for(var a=__imns("util.dom"),b=this.getItems(),c=this.on.id,d=this.on.id,e=b.length;d<e&&("none"!==a.findElementStyleDeep(b[d],"display")&&this.isItemVisible(b[d]));d+=1)c=d;return c},adr.Carousel.prototype.lastVisible=function(){return this.getItems()[this.lastVisibleId()]},adr.Carousel.prototype.shouldUseBuffer=function(a){if(0!==this.buffer){var b=__imns("component.classes");return a instanceof b.CarouselMovement||(a=new b.CarouselMovement(this,a)),a.getDistance()>0?this.last!==this.numberOfItems():a.getDistance()<0&&this.first<0}return!1},adr.Carousel.prototype.hasAvailable=function(a){var b=(__imns("util.validation"),__imns("component.classes"));a instanceof b.CarouselMovement||(a=new b.CarouselMovement(a));var c=a.getTarget(),d=(a.getDistance(),this.numberOfItems());return!(c<0)&&!(c>=d)},adr.Carousel.prototype.hasBufferAvailable=function(a){if(0!==this.buffer){var b=(__imns("util.validation"),__imns("component.classes"));a instanceof b.CarouselMovement||(a=new b.CarouselMovement(a));var c=a.getTarget(),d=a.getDistance(),e=this.numberOfItems();return c=d>0?c+this.buffer:d<0?c-this.buffer:c,c<0?!(c>=this.first):!(c>e)||!(c<this.last)}return this.hasAvailable(a)},adr.Carousel.prototype.setSelected=function(a,b){var c=__imns("util.dom");__imns("util.validation");void 0!==b&&"element"in b&&null!==b.element&&c.removeClass(b.element,"selected"),void 0!==a&&"element"in a&&null!==a.element&&c.addClass(a.element,"selected")},adr.Carousel.prototype.setOn=function(a){var b=__imns("util.tools"),c=__imns("component.classes"),d=this.on;this.on=new c.CarouselItemReference(a,this.getItems()[a],this),this.setSelected(this.on,d),this.isAtLast()&&this.reachedLast(),this.isAtFirst()&&this.reachedFirst(),b.fireElementEvent(this.container,this.events.slide,{on:this.on,off:d})},adr.Carousel.prototype.transition=function(a){var b=__imns("component.classes"),c=__imns("util.validation"),d=__imns("util.tools"),e=a instanceof b.CarouselMovement||!c.isNumber(a)?a:new b.CarouselMovement({carousel:this,target:a}),f=this,g=new b.CarouselPasser(f,e);return this.setOn(e.getTarget()),this.setActive(!1),d.fireElementEvent(this.container,this.events.transitionStart),null!==this._transition?this._transition instanceof b.CarouselTransition?this._transition.transition(g):this._transition(g):this.transitionComplete(),!0},adr.Carousel.prototype.transitionComplete=function(){var a=__imns("util.tools");this.setActive(!0),a.fireElementEvent(this.container,this.events.transitionEnd),this.isAtLast()&&this.reachedLast(),this.isAtFirst()&&this.reachedFirst()},adr.Carousel.prototype.isAtLast=function(){return!this.canLoopForwards()&&!(this.on.id<this.last-1)},adr.Carousel.prototype.isAtFirst=function(){return!this.canLoopBackwards()&&!(this.on.id>this.first)},adr.Carousel.prototype.canLoopForwards=function(){return this.loop&&this.first>-(1/0)},adr.Carousel.prototype.canLoopBackwards=function(){return this.loop&&this.last<1/0},adr.Carousel.prototype.canLoop=function(){return this.loop&&this.canLoopForwards()&&this.canLoopBackwards()},adr.Carousel.prototype.reachedFirst=function(){var a=__imns("util.tools");return!!this.isAtFirst()&&(this.loop&&this.canLoopBackwards()?(a.fireElementEvent(this.container,this.events.loopFirst),!0):(a.fireElementEvent(this.container,this.events.reachedFirst),!0))},adr.Carousel.prototype.reachedLast=function(){var a=__imns("util.tools");return!!this.isAtLast()&&(this.loop&&this.canLoopForwards()?(a.fireElementEvent(this.container,this.events.loopLast),!0):(a.fireElementEvent(this.container,this.events.reachedLast),!0))},adr.Carousel.prototype.atFirst=function(){var a=__imns("util.tools");return this.loop?void a.fireElementEvent(this.container,this.events.loopFirst):(a.fireElementEvent(this.container,this.events.reachedFirst),!1)},adr.Carousel.prototype.atLast=function(){var a=__imns("util.tools");return this.loop?void a.fireElementEvent(this.container,this.events.loopLast):(a.fireElementEvent(this.container,this.events.reachedLast),!1)},adr.Carousel.prototype.requestPrior=function(a){var b=__imns("util.validation"),c=__imns("component.classes");if(a=a instanceof c.CarouselMovement||!b.isNumber(a)?a:new c.CarouselMovement({carousel:this,distance:0-a}),b.isFunction(this._requestPrior)){var d=new c.CarouselPasser(this,a,this.waitingonprior);this.waitingonprior=!1,this._requestPrior(d)}else this.onlyCurrent(),this._move(a);return!1},adr.Carousel.prototype.requestNext=function(a){var b=__imns("util.validation"),c=__imns("component.classes");if(a=a instanceof c.CarouselMovement||!b.isNumber(a)?a:new c.CarouselMovement({carousel:this,distance:a}),b.isFunction(this._requestNext)){var d=new c.CarouselPasser(this,a,this.waitingonnext);this.waitingonnext=!1,this._requestNext(d)}else this.onlyCurrent(),this._move(a);return!1},adr.Carousel.prototype.onReceipt=function(){},adr.Carousel.prototype.maximumPriorReached=function(){this._requestPrior=null,this.setFirst(0),this.isAtFirst()&&this.reachedFirst()},adr.Carousel.prototype.maximumNextReached=function(){this._requestNext=null,this.setLast(this.getItems().length),this.isAtLast()&&this.reachedLast()},adr.Carousel.prototype.setRequestPrior=function(a){var b=__imns("util.validation");return!(!b.isFunction(a)&&null!==a)&&(this._requestPrior=a,!0)},adr.Carousel.prototype.setRequestNext=function(a){var b=__imns("util.validation");return!(!b.isFunction(a)&&null!==a)&&(this._requestNext=a,!0)},adr.Carousel.prototype.receiveNext=function(a,b){var c=__imns("util.validation"),d=__imns("component.classes"),e=__imns("util.tools"),f=this.itemParent(),g=!1;this.getItems()[this.on.id];if(a=c.isHTMLElement(a)?[a]:a,void 0!==f&&c.isHTMLElement(f))if(c.isArray(a))for(var h=0,i=a.length;h<i;h+=1){var j=a[h];c.isHTMLElement(j)&&("appendChild"in f?(f.appendChild(j),g=!0):"innerHTML"in f&&"outerHTML"in j&&(f.innerHTML+=j.outerHTML,g=!0))}else c.isString(a)&&a.length>0&&"innerHTML"in f&&(f.innerHTML+=a,g=!0);var k=!1,l=null;if(g){e.fireElementEvent(this.container,this.events.receivedNext);var m=b.numberOfItems;if(this.numberOfItems()-m<Math.abs(b.destinationDistance))k=!0;else{l=new d.CarouselMovement({carousel:this,target:b.destinationIndex});var n=this.on.id;this.on.update(),n-=this.on.id,l.update(n),b.waiting&&this.transition(l),this.waitingonnext=!1}}if(!g||k)return this.error=!0,this.setLast(this.getItems().length),this.waitingonnext&&(l=new d.CarouselMovement({carousel:this,target:this.numberOfItems()-1}),this.transition(l)),this.waitingonnext=!1,this.atLast(),(new(__imns("util.debug").IMDebugger)).pass("Carousel Error: receiveNext did not receive any more/enough results"),!1},adr.Carousel.prototype.receivePrior=function(a,b){var c=__imns("util.validation"),d=__imns("component.classes"),e=__imns("util.tools"),f=this.itemParent(),g=!1,h=this.numberOfItems();a=c.isHTMLElement(a)?[a]:a;var i=this.getItems();i.length,i[this.on.id];if(void 0!==f&&c.isHTMLElement(f))if(c.isArray(a))for(var j=0,k=a.length;j<k;j+=1){var l=a[j];if(c.isHTMLElement(l))if("insertBefore"in f){var m="childNodes"in f?f.childNodes[0]:"children"in f?f.children[0]:null;null!==m?f.insertBefore(l,f.childNodes[0]):f.appendChild(l),g=!0}else"innerHTML"in f&&(f.innerHTML=l.outerHTML+f.innerHTML,g=!0)}else c.isString(a)&&a.length>0&&"innerHTML"in f&&(f.innerHTML+=a,g=!0);var n=!1,o=null;if(g){e.fireElementEvent(this.container,this.events.receivedPrior);var p=this.numberOfItems()-h;if(this.setLast(this.last+p),p<Math.abs(b.destinationDistance))n=!0;else{o=new d.CarouselMovement({carousel:this,target:-b.destinationIndex});var q=this.on.id;this.on.update(),q-=this.on.id,o.update(q),b.waiting&&this.transition(o),this.waitingonprior=!1}}if(!g||n)return this.error=!0,this.setFirst(0),this.waitingonprior&&(o=new d.CarouselMovement({carousel:this,target:0}),this.transition(o)),this.waitingonprior=!1,this.atFirst(),(new(__imns("util.debug").IMDebugger)).pass("Carousel Error: receivePrior did not receive any more/enough results"),!1},adr.Carousel.prototype.itemParent=function(){var a=__imns("util.dom"),b=a.findElementsBySelector(this.container,this.itemSelector);return b.length>0?a.findParent(b[0]):null},adr.CarouselControlAction=function(a,b,c){this.label="",this.action="",this.func="",this.valid=!1,this.init(a,b,c)});