"use strict";function AnimationMaster(){return void 0!==AnimationMaster.prototype.singleton?AnimationMaster.prototype.singleton:(AnimationMaster.prototype.singleton=this,this.needsAnimation="",this.id_count=0,this.animations=[],this.fps=26,void this.init())}function AnimationProperty(a){this.name="",this.start="",this.end="",this.type="css",this._get=null,this._set=null,void 0!==a&&this.init(a)}function Animation(a){this.master=null,this.element=null,this.id=null,this.default_timing=500,this.timings=[],this.properties=[],this.timing_functions=[],this.cubic_beziers=[],this.forceJSAnimation=!1,this.animating=!1,this.preserve_initial=!0,this.retain_initial=!1,this.preserve=null,this.interval=null,this.descriptor="",this.endFunction=null,this.paused=!0,this.transitionFunctionKeywords=[{n:"ease",v:"cubic-bezier(0.25, 0.1, 0.25, 1.0)"},{n:"linear",v:"cubic-bezier(0.0, 0.0, 1.0, 1.0)"},{n:"ease-in",v:"cubic-bezier(0.42, 0, 1.0, 1.0)"},{n:"ease-out",v:"cubic-bezier(0, 0, 0.58, 1.0)"},{n:"ease-in-out",v:"cubic-bezier(0.42, 0, 0.58, 1.0)"}],this.init(a)}AnimationMaster.prototype.init=function(){var a=this,b=function(){a.needsAnimation=new SupportedCSSProperty("transition-property",findElementsByTag("body")[0]).exists?!1:!0,unfetter(document,"DOMContentLoaded",b)};fetter(document,"DOMContentLoaded",b,!0,"both")},AnimationMaster.prototype.internalFind=function(a){var b=[];if("animation"in a)return b=this.findPositionByAnimation(a.animation),-1!==b?this.animations[b]:null;if("id"in a)return b=this.findPositionById(a.id),-1!==b?this.animations[b]:null;if(b=[],"element"in a&&"descriptor"in a?b=this.findPositionsByElementsAndDescriptors(a.element,a.descriptor):"element"in a?b=this.findPositionsByElement(a.element):"descriptor"in a&&(b=this.findPositionsByDescriptor(a.descriptor)),0===b.length)return null;if(1===b.length)return this.animations[b[0]];for(var c=[],d=0,e=b.length;e>d;d+=1)c.push(this.animations[b[d]]);return c},AnimationMaster.prototype.findPositionById=function(a){for(var b=-1,c=0,d=this.animations.length;d>c;c+=1)if(this.animations[c].id===a){b=c;break}return b},AnimationMaster.prototype.findPositionByAnimation=function(a){for(var b=-1,c=0,d=this.animations.length;d>c;c+=1)if(this.animations[c]===a){b=c;break}return b},AnimationMaster.prototype.findPositionsByElement=function(a){for(var b=[],c=0,d=this.animations.length;d>c;c+=1)this.animations[c].element===a&&b.push(c);return b},AnimationMaster.prototype.findPositionsByDescriptor=function(a){for(var b=[],c=0,d=this.animations.length;d>c;c+=1)this.animations[c].descriptor===a&&b.push(c);return b},AnimationMaster.prototype.findPositionsByElementsAndDescriptors=function(a,b){for(var c=[],d=0,e=this.animations.length;e>d;d+=1)this.animations[d].element===a&&this.animations[d].descriptor===b&&c.push(d);return c},AnimationMaster.prototype.getId=function(a){if(a instanceof Animation)return-1===this.findPositionByAnimation(a)?(this.id_count+=1,this.animations.push(a),this.id_count):this.animations[this.findPositionByAnimation(a)].id;throw new TypeError("AnimationMaster.getId must be provided an Animation")},AnimationMaster.prototype.find=function(){var a=null,b=null,c=null,d=null,e={};if(1===arguments.length&&"object"==typeof arguments[0])e=arguments[0],a="id"in e&&isNumber(e.id)&&Math.round(e.id)===e.id?e.id:null,b="element"in e&&isHTMLElement(e.element)?e.element:null,c="descriptor"in e&&"string"==typeof e.descriptor?e.descriptor:null;else if(3===arguments.length)a=isNumber(arguments[0])&&Math.round(arguments[0])===arguments[0]?arguments[0]:null,b=void 0!==arguments[1]&&isHTMLElement(arguments[1])?arguments[1]:null,c=void 0!==arguments[2]&&"string"==typeof arguments[2]?arguments[2]:null;else if(1===arguments.length&&void 0!==arguments[0]){var f=arguments[0];isHTMLElement(f)?b=f:f instanceof Animation?d=f:isNumber(f)&&Math.round(f)===f?a=f:"string"==typeof f&&(c=f)}return null!==d||null!==b||null!==c||null!==a?(e={},null!==d&&(e.animation=d),null!==b&&(e.element=b),null!==c&&(e.descriptor=c),null!==a&&(e.id=a),this.internalFind(e)):null},AnimationProperty.prototype.init=function(a){"name"in a&&this.setName(a.name),"start"in a&&this.setStart(a.start),"end"in a&&this.setEnd(a.end),"get"in a&&"set"in a&&this.custom(a.get,a.set)},AnimationProperty.prototype.getStart=function(a){return""!==this.start?this.start:this.get(a)},AnimationProperty.prototype.getEnd=function(a){return""!==this.end?this.end:this.get(a)},AnimationProperty.prototype.get=function(a){var b="custom"===this.type&&null!==this._get&&"function"==typeof this._get?this._get:this.cssGet;try{return b(a)}catch(c){(new IMDebugger).pass("Animation Property ("+this.name+"), requires custom get")}return""},AnimationProperty.prototype.set=function(a,b){var c="custom"===this.type&&null!==this._set&&"function"==typeof this._set?this._set:this.cssSet;try{return c(a,b)}catch(d){(new IMDebugger).pass("Animation Property ("+this.name+"), requires custom set")}return""},AnimationProperty.prototype.cssGet=function(a){return void 0!==a&&isHTMLElement(a)&&"style"in a?findElementStyle(a,new SupportedCSSProperty(this.name).cssProperty):""},AnimationProperty.prototype.cssSet=function(a,b){return void 0!==a&&isHTMLElement(a)&&"style"in a?(a.style[new SupportedCSSProperty(this.name).jsProperty]=b,a.style[new SupportedCSSProperty(this.name).jsProperty]===b?!0:!1):!1},AnimationProperty.prototype.setName=function(a){void 0!==a&&"string"==typeof a&&a.length>0&&(new SupportedCSSProperty(a).exists?(this.name=a,this.type="css"):(this.name=a,this.type="custom"))},AnimationProperty.prototype.setStart=function(a){this.start=a},AnimationProperty.prototype.setEnd=function(a){this.end=a},AnimationProperty.prototype.customGet=function(a){return void 0!==a&&"function"==typeof a?(this._get=a,this.type="custom",!0):!1},AnimationProperty.prototype.customSet=function(a){return void 0!==a&&"function"==typeof a?(this._set=a,this.type="custom",!0):!1},AnimationProperty.prototype.custom=function(a,b){return this.customGet(a),this.customSet(b),this.customOkay()?!0:!1},AnimationProperty.prototype.isCustom=function(){return"css"===this.type?(this.type=""!==this.name&&new SupportedCSSProperty(this.name).exists?"css":"custom","custom"===this.type?!0:!1):!0},AnimationProperty.prototype.customOkay=function(){return this.isCustom()&&null!==this._get&&null!==this._set?!0:!1},Animation.prototype.init=function(a){this.master=new AnimationMaster,this.id=this.master.getId(this),void 0!==a&&("element"in a&&this.addElement(a.element),"descriptor"in a&&this.addDescriptor(a.descriptor),"endFunction"in a&&this.addEndFunction(a.endFunction),"duration"in a&&this.addDuration(a.duration),"timingFunction"in a&&this.addTimingTransitionFunction(a.timingFunction),"property"in a&&this.addProperty(a.property))},Animation.forceJSAnimate=function(a){return this.forceJSAnimation=void 0===a?this.forceJSAnimation?!1:!0:a?!0:!1,this.forceJSAnimation},Animation.prototype.addElement=function(a){return this.element=void 0!==a&&isHTMLElement(a)?a:null,this.element===a},Animation.prototype.addDescriptor=function(a){return this.descriptor="string"==typeof a?a:"",this.descriptor===a},Animation.prototype.addEndFunction=function(a){this.endFunction="function"==typeof a?a:null},Animation.prototype.addDuration=function(a){isArray(a)||(a="string"==typeof a?a.split(","):"number"==typeof a?[a]:[]),this.timings=[];for(var b=/^[0-9]*\.?[0-9]+( )?s$/,c=/^[0-9]*\.?[0-9]+( )?ms$/,d=0,e=a.length;e>d;d+=1)c.test(a[d])?this.timings.push(parseFloat(a[d])):b.test(a[d])?this.timings.push(1e3*parseFloat(a[d])):isNumber(a[d])&&a[d]>0&&this.timings.push(a[d]);this.default_timing=1===this.timings.length?this.timings[0]:null},Animation.prototype.run=function(){var a=0,b=0,c=this;for(this.animation_end=0===this.timings.length?this.default_timing:0,a=0,b=this.timings.length;b>a;a+=1)this.animation_end=this.timings[a]>this.animation_end?this.timings[a]:this.animation_end;if(this.animating=!0,this.master.needsAnimation||this.forceJSAnimation){for(this.animation_start=(new Date).getTime(),this.cubic_beziers=[],a=0,b=this.timing_functions.length;b>a;a+=1)this.cubic_beziers[a]=new CubicBezierCoordinates,this.cubic_beziers[a].cssSet(this.timing_functions[a]);this.interval=setInterval(function(){c.animate()},1e3/this.master.fps)}else{this.gatherInitialTransitions();var d=this.properties.length;for(a=0;d>a;a+=1){var e=this.properties[a].get(this.element);""===e&&(e=this.properties[a].setStart(e))}for(this.transitionSetter({property:this.producePropertyString(),duration:this.produceTimingDurationString(),timingFunction:this.produceTimingFunctionString()}),this.clearInt(),this.interval=setInterval(function(){this.animating=!1,null!==c.endFunction&&"function"==typeof c.endFunction&&c.endFunction(),c.clear()},this.animation_end),a=0,b=this.properties.length;b>a;a+=1)this.properties[a].set(this.element,this.properties[a].getEnd(this.element))}},Animation.prototype.getCubicBezier=function(a){return this.cubic_beziers.length>0?isNumber(a)&&a>-1&&a<this.cubic_beziers.length?this.cubic_beziers[a]:this.cubic_beziers[0]:void(new IMDebugger).pass("Animation has no cubic beziers, will need resolution")},Animation.prototype.gatherInitialTransitions=function(){this.preserve=this.preserve_initial?{property:this.element.style[new SupportedCSSProperty("transition-property").jsProperty],duration:this.element.style[new SupportedCSSProperty("transition-duration").jsProperty],timingFunction:this.element.style[new SupportedCSSProperty("transition-timing-function").jsProperty]}:null,this.retain_initial&&(this.addProperty(this.preserve.property),this.addTiming(this.preserve.duration),this.addTimingFunction(this.preserve.timingFunction))},Animation.prototype.resetInitialTransitions=function(){this.preserve_initial&&null!==this.preserve?this.transitionSetter(this.preserve.property,this.preserve.duration,this.preserve.timingFunction):this.transitionSetter("","","")},Animation.prototype.transitionSetter=function(a,b,c){"object"==typeof a&&"property"in a&&"duration"in a&&"timingFunction"in a&&(c=a.timingFunction,b=a.duration,a=new SupportedCSSProperty(a.property).cssProperty),this.element.style[new SupportedCSSProperty("transition-property").jsProperty]=a,this.element.style[new SupportedCSSProperty("transition-duration").jsProperty]=b,this.element.style[new SupportedCSSProperty("transition-timing-function").jsProperty]=c},Animation.prototype.animate=function(){var a,b,c=0,d=0,e=(new Date).getTime()-this.animation_start;if(e<=this.animation_end)for(c=0,d=this.properties.length;d>c;c+=1){var f=void 0!==this.timings[c]?this.timings[c]:this.default_timing;if(e>f)this.properties[c].set(this.element,this.properties[c].getEnd(this.element));else try{a=e/f,b=parseFloat(this.properties[c].getStart(this.element))+this.getCubicBezier(c).findYPositionFromX(a)*(parseFloat(this.properties[c].getEnd(this.element))-parseFloat(this.properties[c].getStart(this.element)))+whatmeasure(this.properties[c].getEnd(this.element)),this.properties[c].set(this.element,b)}catch(g){(new IMDebugger).pass(g)}}else{for(c=0,d=this.properties.length;d>c;c+=1)try{this.properties[c].set(this.element,this.properties[c].getEnd(this.element))}catch(g){}this.animating=!1,null!==this.endFunction&&"function"==typeof this.endFunction&&this.endFunction(),this.clear()}},Animation.prototype.addTimingTransitionFunction=function(a){for(var b=this.stringParser(a),c=[],d=0,e=0,f=b.length;f>e;e+=1)if(isCSSCubicBezier(b[e]))c.push(b[e]);else for(var g=0,h=this.transitionFunctionKeywords.length;h>g;g+=1)if(this.transitionFunctionKeywords[g].n===b[e]){c.push(this.transitionFunctionKeywords[g].v);break}for(var i=0,j=c.length;j>i;i+=1)this.timing_functions.push(c[i]),d+=1;return d},Animation.prototype.stringParser=function(a){if("string"==typeof a){if(-1!==a.indexOf(",")){for(var b=a.length,c=0,d=!1,e=0,f=[];b>c;){var g=a.charAt(c);"("===g?d=!0:")"===g?d=!1:","!==a.charAt(c)||d||(f.push(a.substring(e,c)),e=c+1),c+=1}f.push(a.substring(e));for(var h=0,i=f.length;i>h;h+=1)f[h]=f[h].replace(/^\s\s*/,"").replace(/\s\s*$/,"");return f}return[a]}return isNumber(a)?[a]:isArray(a)?a:[]},Animation.prototype.setProperty=function(){return arguments?1===arguments.length?this.addProperty(arguments[0])>0?!0:!1:2===arguments.length?this.addProperty(arguments[0],arguments[1])>0?!0:!1:3===arguments.length?this.addProperty(arguments[0],arguments[1],arguments[2])>0?!0:!1:void 0:!1},Animation.prototype.addProperty=function(a){var b={name:"",start:0,end:0};if("object"!=typeof a||isArray(a)){var c=isArray(a)&&1===arguments.length?a:arguments;c.length>0&&(void 0!==c[0]&&(b.name=c[0]),void 0!==c[1]&&(b.start=c[1]),void 0!==c[2]&&(b.end=c[2]),void 0!==c[3]&&(b.custom=c[3]))}else a.name="property"in a&&!("name"in a)?a.property:a.name,"name"in a&&(b.name=a.name),"start"in a&&(b.start=a.start),"end"in a&&(b.end=a.end),"custom"in a&&(b.custom=a.custom);b.name=this.stringParser(b.name),b.start=this.stringParser(b.start),b.end=this.stringParser(b.end);for(var d,e,f,g,h=0,i=0,j=b.name.length;j>i;i+=1){d={name:b.name[i],start:b.start[i],end:b.end[i]},f=void 0!==d.start?whatmeasure(d.start):"",g=void 0!==d.end?whatmeasure(d.end):"",d.start=void 0!==d.start?measure(d.start,g,null!==this.element?this.element:void 0):void 0,d.end=void 0!==d.end?measure(d.end,g,null!==this.element?this.element:void 0):void 0,e=new AnimationProperty(d),e.isCustom()&&"custom"in b&&(isArray(b.custom)&&void 0!==b.custom[i]?e.custom(b.custom[i]):"get"in b.custom&&"set"in b.custom&&e.custom(b.custom.get,b.custom.set));var k=this.findPropertyIndex(d.name);-1===k?this.properties.push(e):(void 0!==d.start&&this.properties[k].setStart(d.start),void 0!==d.end&&this.properties[k].setEnd(d.end),void 0!==d.custom&&this.properites[k].custom(d.custom.get,d.custom.set)),h+=1}return h},Animation.prototype.findPropertyIndex=function(a){for(var b=-1,c=0,d=this.properties.length;d>c;c+=1)if(this.properties[c].name===a){b=c;break}return b},Animation.prototype.producePropertyString=function(){if(0===this.properties.length)return"all";for(var a="",b=0,c=this.properties.length;c>b;b+=1)this.properties[b].isCustom()||(a+=this.properties[b].name+", ");return a=a.length>0?a.substring(0,a.length-2):a},Animation.prototype.produceTimingDurationString=function(){return 0===this.timings.length?this.default_timing+"ms":this.timings.join("ms,")+"ms"},Animation.prototype.produceTimingFunctionString=function(){return 0===this.timing_functions.length?"linear":this.timing_functions.join(",")},Animation.prototype.clear=function(){null!==this.interval&&(clearInterval(this.interval),this.interval=null),this.master.needsAnimation||this.resetInitialTransitions()},Animation.prototype.clearInt=function(){null!==this.interval&&clearInterval(this.interval),this.interval=null},Animation.prototype.set=function(){var a=this;this.clear(),this.setInterval(function(){a.animateStep()},1e3*this.timing/this.master.fps)},Animation.prototype.pause=function(){if(this.animating){if(this.animating=!1,this.clearInt(),!this.master.needsAnimation){for(var a=0,b=this.properties.length;b>a;a+=1)this.properties[a].set(this.element,this.properties[a].get(this.element));this.element.style["transition-property"]="none"}return!0}this.recalculateStarts(),this.animating=!0,this.run()},Animation.prototype.recalculateStarts=function(){for(var a=0,b=this.properties.length;b>a;a+=1){var c=this.properties[a].get(this.element);c=measure(c,whatmeasure(this.properties[a].getEnd(this.element)),this.element),this.properties[a].setStart(c)}};