"use strict";var adr=__imns("util.classes");"AnimationMaster"in adr||(adr.AnimationMaster=function(){var a=__imns("util.classes");return void 0!==a.AnimationMaster.prototype.singleton?a.AnimationMaster.prototype.singleton:(a.AnimationMaster.prototype.singleton=this,this.needsAnimation="",this.id_count=0,this.animations=[],this.fps=26,void this.init())},adr.AnimationMaster.prototype.init=function(){var a=__imns("util.classes"),b=__imns("util.dom"),c=__imns("util.tools"),d=this,e=function(){d.needsAnimation=new a.SupportedCSSProperty("transition-property",b.findElementsByTag("body")[0]).exists?!1:!0,c.unfetter(document,"DOMContentLoaded",[d,e])};c.fetter(document,"DOMContentLoaded",[d,e],!0,"both")},adr.AnimationMaster.prototype.internalFind=function(a){var b=[];if("animation"in a)return b=this.findPositionByAnimation(a.animation),-1!==b?this.animations[b]:null;if("id"in a)return b=this.findPositionById(a.id),-1!==b?this.animations[b]:null;if(b=[],"element"in a&&"descriptor"in a?b=this.findPositionsByElementsAndDescriptors(a.element,a.descriptor):"element"in a?b=this.findPositionsByElement(a.element):"descriptor"in a&&(b=this.findPositionsByDescriptor(a.descriptor)),0===b.length)return null;if(1===b.length)return this.animations[b[0]];for(var c=[],d=0,e=b.length;e>d;d+=1)c.push(this.animations[b[d]]);return c},adr.AnimationMaster.prototype.findPositionById=function(a){for(var b=-1,c=0,d=this.animations.length;d>c;c+=1)if(this.animations[c].id===a){b=c;break}return b},adr.AnimationMaster.prototype.findPositionByAnimation=function(a){for(var b=-1,c=0,d=this.animations.length;d>c;c+=1)if(this.animations[c]===a){b=c;break}return b},adr.AnimationMaster.prototype.findPositionsByElement=function(a){for(var b=[],c=0,d=this.animations.length;d>c;c+=1)this.animations[c].element===a&&b.push(c);return b},adr.AnimationMaster.prototype.findPositionsByDescriptor=function(a){for(var b=[],c=0,d=this.animations.length;d>c;c+=1)this.animations[c].descriptor===a&&b.push(c);return b},adr.AnimationMaster.prototype.findPositionsByElementsAndDescriptors=function(a,b){for(var c=[],d=0,e=this.animations.length;e>d;d+=1)this.animations[d].element===a&&this.animations[d].descriptor===b&&c.push(d);return c},adr.AnimationMaster.prototype.getId=function(a){var b=__imns("util.classes");if(a instanceof b.Animation)return-1===this.findPositionByAnimation(a)?(this.id_count+=1,this.animations.push(a),this.id_count):this.animations[this.findPositionByAnimation(a)].id;throw new TypeError("AnimationMaster.getId must be provided an Animation")},adr.AnimationMaster.prototype.find=function(){var a=__imns("util.validation"),b=__imns("util.classes"),c=null,d=null,e=null,f=null,g={};if(1===arguments.length&&"object"==typeof arguments[0])g=arguments[0],c="id"in g&&a.isNumber(g.id)&&Math.round(g.id)===g.id?g.id:null,d="element"in g&&a.isHTMLElement(g.element)?g.element:null,e="descriptor"in g&&"string"==typeof g.descriptor?g.descriptor:null;else if(3===arguments.length)c=a.isNumber(arguments[0])&&Math.round(arguments[0])===arguments[0]?arguments[0]:null,d=void 0!==arguments[1]&&a.isHTMLElement(arguments[1])?arguments[1]:null,e=void 0!==arguments[2]&&"string"==typeof arguments[2]?arguments[2]:null;else if(1===arguments.length&&void 0!==arguments[0]){var h=arguments[0];a.isHTMLElement(h)?d=h:h instanceof b.Animation?f=h:a.isNumber(h)&&Math.round(h)===h?c=h:"string"==typeof h&&(e=h)}return null!==f||null!==d||null!==e||null!==c?(g={},null!==f&&(g.animation=f),null!==d&&(g.element=d),null!==e&&(g.descriptor=e),null!==c&&(g.id=c),this.internalFind(g)):null},adr.AnimationProperty=function(a){this.name="",this.start="",this.end="",this.type="css",this._get=null,this._set=null,void 0!==a&&this.init(a)},adr.AnimationProperty.prototype.init=function(a){"name"in a&&this.setName(a.name),"start"in a&&this.setStart(a.start),"end"in a&&this.setEnd(a.end),"get"in a&&"set"in a&&this.custom(a.get,a.set)},adr.AnimationProperty.prototype.getStart=function(a,b){var c=__imns("util.tools");b=void 0!==b&&b===!1?!1:!0;var d=""!==this.start?this.start:this.get(a),e=0===parseFloat(d)?!0:!1;if(e&&b){var f=this.getEnd(a,!1);return"0"+c.whatmeasure(f)}return d},adr.AnimationProperty.prototype.getEnd=function(a,b){var c=__imns("util.tools");b=void 0!==b&&b===!1?!1:!0;var d=""!==this.end?this.end:this.get(a),e=0===parseFloat(d)?!0:!1;if(e&&b){var f=this.getStart(a,!1);return"0"+c.whatmeasure(f)}return d},adr.AnimationProperty.prototype.get=function(a){var b=__imns("util.debug"),c="custom"===this.type&&null!==this._get&&"function"==typeof this._get?this._get:this.cssGet;try{return c(a)}catch(d){(new b.IMDebugger).pass("Animation Property ("+this.name+"), requires custom get")}return""},adr.AnimationProperty.prototype.set=function(a,b){var c=__imns("util.debug"),d="custom"===this.type&&null!==this._set&&"function"==typeof this._set?this._set:this.cssSet;try{return d(a,b,this.name)}catch(e){(new c.IMDebugger).pass("Animation Property ("+this.name+"), requires custom set")}return""},adr.AnimationProperty.prototype.cssGet=function(a){var b=__imns("util.classes"),c=__imns("util.validation"),d=__imns("util.dom");return void 0!==a&&c.isHTMLElement(a)&&"style"in a?d.findElementStyleDeep(a,new b.SupportedCSSProperty(this.name).cssProperty):""},adr.AnimationProperty.prototype.cssSet=function(a,b,c){var d=__imns("util.validation"),e=__imns("util.classes");return void 0!==a&&d.isHTMLElement(a)&&"style"in a?(a.style[new e.SupportedCSSProperty(c).jsProperty]=b,a.style[new e.SupportedCSSProperty(c).jsProperty]===b?!0:!1):!1},adr.AnimationProperty.prototype.setName=function(a){var b=__imns("util.classes");void 0!==a&&"string"==typeof a&&a.length>0&&(new b.SupportedCSSProperty(a).exists?(this.name=a,this.type="css"):(this.name=a,this.type="custom"))},adr.AnimationProperty.prototype.setStart=function(a){this.start=a},adr.AnimationProperty.prototype.setEnd=function(a){this.end=a},adr.AnimationProperty.prototype.customGet=function(a){return void 0!==a&&"function"==typeof a?(this._get=a,this.type="custom",!0):!1},adr.AnimationProperty.prototype.customSet=function(a){return void 0!==a&&"function"==typeof a?(this._set=a,this.type="custom",!0):!1},adr.AnimationProperty.prototype.custom=function(a,b){return this.customGet(a),this.customSet(b),this.customOkay()?!0:!1},adr.AnimationProperty.prototype.isCustom=function(){var a=__imns("util.classes");return"css"===this.type?(this.type=""!==this.name&&new a.SupportedCSSProperty(this.name).exists?"css":"custom","custom"===this.type?!0:!1):!0},adr.AnimationProperty.prototype.customOkay=function(){return this.isCustom()&&null!==this._get&&null!==this._set?!0:!1},adr.Animation=function(a){this.master=null,this.element=null,this.id=null,this.default_timing=500,this.timings=[],this.properties=[],this.timing_functions=[],this.cubic_beziers=[],this.forceJSAnimation=!1,this.animating=!1,this.preserve_initial=!0,this.retain_initial=!1,this.preserve=null,this.interval=null,this.descriptor="",this.endFunction=null,this.paused=!0,this.transitionFunctionKeywords=[{n:"ease",v:"cubic-bezier(0.25, 0.1, 0.25, 1.0)"},{n:"linear",v:"cubic-bezier(0.0, 0.0, 1.0, 1.0)"},{n:"ease-in",v:"cubic-bezier(0.42, 0, 1.0, 1.0)"},{n:"ease-out",v:"cubic-bezier(0, 0, 0.58, 1.0)"},{n:"ease-in-out",v:"cubic-bezier(0.42, 0, 0.58, 1.0)"}],this.init(a)},adr.Animation.prototype.init=function(a){var b=__imns("util.classes");this.master=new b.AnimationMaster,this.id=this.master.getId(this),this.fps=this.master.fps,void 0!==a&&("element"in a&&this.addElement(a.element),"descriptor"in a&&this.addDescriptor(a.descriptor),"endFunction"in a&&this.addEndFunction(a.endFunction),"duration"in a&&this.addDuration(a.duration),"timingFunction"in a&&this.addTimingTransitionFunction(a.timingFunction),"property"in a&&this.addProperty(a.property))},adr.Animation.prototype.setFPS=function(a){var b=__imns("util.validation");return b.isNumber(a)&&a>0?(this.fps=parseInt(a),!0):!1},adr.Animation.prototype.forceJSAnimate=function(a){return this.forceJSAnimation=void 0===a?this.forceJSAnimation?!1:!0:a?!0:!1,this.forceJSAnimation},adr.Animation.prototype.addElement=function(a){var b=__imns("util.validation");return this.element=void 0!==a&&b.isHTMLElement(a)?a:null,this.element===a},adr.Animation.prototype.addDescriptor=function(a){return this.descriptor="string"==typeof a?a:"",this.descriptor===a},adr.Animation.prototype.addEndFunction=function(a){this.endFunction="function"==typeof a?a:null},adr.Animation.prototype.addDuration=function(a){var b=__imns("util.validation");b.isArray(a)||(a="string"==typeof a?a.split(","):"number"==typeof a?[a]:[]),this.timings=[];for(var c=/^[0-9]*\.?[0-9]+( )?s$/,d=/^[0-9]*\.?[0-9]+( )?ms$/,e=0,f=a.length;f>e;e+=1)d.test(a[e])?this.timings.push(parseFloat(a[e])):c.test(a[e])?this.timings.push(1e3*parseFloat(a[e])):b.isNumber(a[e])&&a[e]>0&&this.timings.push(a[e]);this.default_timing=1===this.timings.length?this.timings[0]:null},adr.Animation.prototype.run=function(){var a=__imns("util.classes"),b=0,c=0,d=this;for(this.animation_end=0===this.timings.length?this.default_timing:0,b=0,c=this.timings.length;c>b;b+=1)this.animation_end=this.timings[b]>this.animation_end?this.timings[b]:this.animation_end;if(this.animating=!0,this.master.needsAnimation||this.forceJSAnimation){for(this.animation_start=(new Date).getTime(),this.cubic_beziers=[],b=0,c=this.timing_functions.length;c>b;b+=1)this.cubic_beziers[b]=new a.CubicBezierCoordinates,this.cubic_beziers[b].cssSet(this.timing_functions[b]);this.interval=setInterval(function(){d.animate()},1e3/this.fps)}else{this.gatherInitialTransitions();var e=this.properties.length;for(b=0;e>b;b+=1){var f=this.properties[b].get(this.element);""===f&&(f=this.properties[b].setStart(f))}for(this.transitionSetter({property:this.producePropertyString(),duration:this.produceTimingDurationString(),timingFunction:this.produceTimingFunctionString()}),this.clearInt(),this.interval=setInterval(function(){this.animating=!1,null!==d.endFunction&&"function"==typeof d.endFunction&&d.endFunction(),d.clear()},this.animation_end),b=0,c=this.properties.length;c>b;b+=1)this.properties[b].set(this.element,this.properties[b].getEnd(this.element))}},adr.Animation.prototype.getCubicBezier=function(a){var b=__imns("util.validation"),c=__imns("util.debug");return this.cubic_beziers.length>0?b.isNumber(a)&&a>-1&&a<this.cubic_beziers.length?this.cubic_beziers[a]:this.cubic_beziers[0]:void(new c.IMDebugger).pass("Animation has no cubic beziers, will need resolution")},adr.Animation.prototype.gatherInitialTransitions=function(){var a=__imns("util.classes");this.preserve=this.preserve_initial?{property:this.element.style[new a.SupportedCSSProperty("transition-property").jsProperty],duration:this.element.style[new a.SupportedCSSProperty("transition-duration").jsProperty],timingFunction:this.element.style[new a.SupportedCSSProperty("transition-timing-function").jsProperty]}:null,this.retain_initial&&(this.addProperty(this.preserve.property),this.addTiming(this.preserve.duration),this.addTimingFunction(this.preserve.timingFunction))},adr.Animation.prototype.resetInitialTransitions=function(){this.preserve_initial&&null!==this.preserve?this.transitionSetter(this.preserve.property,this.preserve.duration,this.preserve.timingFunction):this.transitionSetter("","","")},adr.Animation.prototype.transitionSetter=function(a,b,c){var d=__imns("util.classes");"object"==typeof a&&"property"in a&&"duration"in a&&"timingFunction"in a&&(c=a.timingFunction,b=a.duration,a=new d.SupportedCSSProperty(a.property).cssProperty),this.element.style[new d.SupportedCSSProperty("transition-property").jsProperty]=a,this.element.style[new d.SupportedCSSProperty("transition-duration").jsProperty]=b,this.element.style[new d.SupportedCSSProperty("transition-timing-function").jsProperty]=c},adr.Animation.prototype.animate=function(){var a,b,c=__imns("util.tools"),d=__imns("util.debug"),e=0,f=0,g=(new Date).getTime()-this.animation_start;if(g<=this.animation_end)for(e=0,f=this.properties.length;f>e;e+=1){var h=void 0!==this.timings[e]?this.timings[e]:this.default_timing;if(g>h)this.properties[e].set(this.element,this.properties[e].getEnd(this.element));else try{a=g/h,b=parseFloat(this.properties[e].getStart(this.element))+this.getCubicBezier(e).findYPositionFromX(a)*(parseFloat(this.properties[e].getEnd(this.element))-parseFloat(this.properties[e].getStart(this.element)))+c.whatmeasure(this.properties[e].getEnd(this.element)),this.properties[e].set(this.element,b)}catch(i){(new d.IMDebugger).pass(i)}}else{for(e=0,f=this.properties.length;f>e;e+=1)try{this.properties[e].set(this.element,this.properties[e].getEnd(this.element))}catch(i){}this.animating=!1,null!==this.endFunction&&"function"==typeof this.endFunction&&this.endFunction(),this.clear()}},adr.Animation.prototype.addTimingTransitionFunction=function(a){for(var b=__imns("util.validation"),c=this.stringParser(a),d=[],e=0,f=0,g=c.length;g>f;f+=1)if(b.isCSSCubicBezier(c[f]))d.push(c[f]);else for(var h=0,i=this.transitionFunctionKeywords.length;i>h;h+=1)if(this.transitionFunctionKeywords[h].n===c[f]){d.push(this.transitionFunctionKeywords[h].v);break}for(var j=0,k=d.length;k>j;j+=1)this.timing_functions.push(d[j]),e+=1;return e},adr.Animation.prototype.stringParser=function(a){var b=__imns("util.validation");if("string"==typeof a){if(-1!==a.indexOf(",")){for(var c=a.length,d=0,e=!1,f=0,g=[];c>d;){var h=a.charAt(d);"("===h?e=!0:")"===h?e=!1:","!==a.charAt(d)||e||(g.push(a.substring(f,d)),f=d+1),d+=1}g.push(a.substring(f));for(var i=0,j=g.length;j>i;i+=1)g[i]=g[i].replace(/^\s\s*/,"").replace(/\s\s*$/,"");return g}return[a]}return b.isNumber(a)?[a]:b.isArray(a)?a:[]},adr.Animation.prototype.setProperty=function(){return arguments?1===arguments.length?this.addProperty(arguments[0])>0?!0:!1:2===arguments.length?this.addProperty(arguments[0],arguments[1])>0?!0:!1:3===arguments.length?this.addProperty(arguments[0],arguments[1],arguments[2])>0?!0:!1:void 0:!1},adr.Animation.prototype.addProperty=function(a){var b=__imns("util.validation"),c=__imns("util.classes"),d=__imns("util.tools"),e={name:"",start:0,end:0};if("object"!=typeof a||b.isArray(a)){var f=b.isArray(a)&&1===arguments.length?a:arguments;f.length>0&&(void 0!==f[0]&&(e.name=f[0]),void 0!==f[1]&&(e.start=f[1]),void 0!==f[2]&&(e.end=f[2]),void 0!==f[3]&&(e.custom=f[3]))}else a.name="property"in a&&!("name"in a)?a.property:a.name,"name"in a&&(e.name=a.name),"start"in a&&(e.start=a.start),"end"in a&&(e.end=a.end),"custom"in a&&(e.custom=a.custom);e.name=this.stringParser(e.name),e.start=this.stringParser(e.start),e.end=this.stringParser(e.end);for(var g,h,i,j,k=0,l=0,m=e.name.length;m>l;l+=1){g={name:e.name[l],start:e.start[l],end:e.end[l]},i=void 0!==g.start?d.whatmeasure(g.start):"",j=void 0!==g.end?d.whatmeasure(g.end):"",g.start=void 0!==g.start?d.measure(g.start,j,null!==this.element?this.element:void 0):void 0,g.end=void 0!==g.end?d.measure(g.end,j,null!==this.element?this.element:void 0):void 0,h=new c.AnimationProperty(g),h.isCustom()&&"custom"in e&&(b.isArray(e.custom)&&void 0!==e.custom[l]?h.custom(e.custom[l]):"get"in e.custom&&"set"in e.custom&&h.custom(e.custom.get,e.custom.set));var n=this.findPropertyIndex(g.name);-1===n?this.properties.push(h):(void 0!==g.start&&this.properties[n].setStart(g.start),void 0!==g.end&&this.properties[n].setEnd(g.end),void 0!==g.custom&&this.properites[n].custom(g.custom.get,g.custom.set)),k+=1}return k},adr.Animation.prototype.findPropertyIndex=function(a){for(var b=-1,c=0,d=this.properties.length;d>c;c+=1)if(this.properties[c].name===a){b=c;break}return b},adr.Animation.prototype.producePropertyString=function(){if(0===this.properties.length)return"all";for(var a="",b=0,c=this.properties.length;c>b;b+=1)this.properties[b].isCustom()||(a+=this.properties[b].name+", ");return a=a.length>0?a.substring(0,a.length-2):a},adr.Animation.prototype.produceTimingDurationString=function(){return 0===this.timings.length?this.default_timing+"ms":this.timings.join("ms,")+"ms"},adr.Animation.prototype.produceTimingFunctionString=function(){return 0===this.timing_functions.length?"linear":this.timing_functions.join(",")},adr.Animation.prototype.clear=function(){null!==this.interval&&(clearInterval(this.interval),this.interval=null),this.master.needsAnimation||this.resetInitialTransitions()},adr.Animation.prototype.clearInt=function(){null!==this.interval&&clearInterval(this.interval),this.interval=null},adr.Animation.prototype.set=function(){var a=this;this.clear(),this.setInterval(function(){a.animateStep()},1e3*this.timing/this.fps)},adr.Animation.prototype.pause=function(){if(this.animating){if(this.animating=!1,this.clearInt(),!this.master.needsAnimation){for(var a=0,b=this.properties.length;b>a;a+=1)this.properties[a].set(this.element,this.properties[a].get(this.element));this.element.style["transition-property"]="none"}return!0}this.recalculateStarts(),this.animating=!0,this.run()},adr.Animation.prototype.recalculateStarts=function(){for(var a=__imns("util.tools"),b=0,c=this.properties.length;c>b;b+=1){var d=this.properties[b].get(this.element);d=a.measure(d,a.whatmeasure(this.properties[b].getEnd(this.element)),this.element),this.properties[b].setStart(d)}});