"use strict";function DropDownController(a){this.id=0,this.active=!1,this.active_id=-1,this.active_ids=[],this.dropdown_arr=[],this.useCodeOpen=!1,this.touched=!1,this.mouserecorder=new MouseRecorder,this.mr_instance={jsObject:this},this.mouseover_int=null,this.determinant=null,this.subElement=null,this.subElement_reference=null,this.outer=null,this.settings={on:new DropDownSet,off:new DropDownSet},this.ddtDeterminant=null,this.ddtOuter=null,this.ddtSubElement=null,this.ddtUIElement=null,this._close=null,this._functional=null,this._open=null,this._testOpen=null,this._twiceOpen=null,this.timing={open:{time:500,min:250},close:{time:3e3,min:1e3},on:3e3,forgiveness:3e3},this.delay_change=.3333333;var b=this.init(a);return!!b&&this}function DropDown(a){this.state=0,this.touched=!1,this.controller=null,this.container=null,this.element=null,this.ui_element=null,this.prevent_close=!1,this.prevent_int=null,this.catch_int=null,this.close_int=null,this.open_int=null,this._open=null,this._close=null,this.init(a)}function DropDownTargetElement(a){this.element_string="",this.element=null,this.reference=null,this.valid=!1,this.init(a)}function DropDownSet(){this.val="click"}DropDownController.prototype.findDropDownId=function(a){var b=-1,c=0,d=0;if(void 0!==a&&isHTMLElement(a))b=this.findDropDownIdFromChild(a);else if(a instanceof DropDown){for(c=0,d=this.dropdown_arr.length;c<d;c+=1)if(this.dropdown_arr[c]===a){b=c;break}}else isNumber(a)&&Math.round(a)===a&&a>-1&&a<this.dropdown_arr.length&&void 0!==this.dropdown_arr[a]&&(b=a);return b},DropDownController.prototype.findDropDownIdFromChild=function(a){if(void 0!==a&&isHTMLElement(a)){for(var b=$(this.determinant).parent()[0];!this.isMenu(a)&&a!==-1;)a=a!==b&&isHTMLElement(a)?$(a).parent()[0]:-1;return a!==-1?this.indexOf(a):-1}return(new IMDebugger).pass("DropDownController.findMenuItemId must be supplied a HTMLElement"),-1},DropDownController.prototype.findMenuItemId=DropDownController.prototype.findDropDownIdFromChild,DropDownController.prototype.findDropDownIdFromDDElement=function(a){for(var b=-1,c=0,d=this.dropdown_arr.length;c<d;c+=1)if(this.dropdown_arr[c].element===a){b=c;break}return b},DropDownController.prototype.indexOf=DropDownController.prototype.findDropDownIdFromDDElement,DropDownController.prototype.isDropDown=function(a){return this.findDropDownId(a)!==-1},DropDownController.prototype.findDropDown=function(a){var b=this.findDropDownId(a);return b!==-1&&this.dropdown_arr[b]},DropDownController.prototype.isOpen=function(a){var b=this.findDropDown(a);return this.useCodeOpen?b.state:this.testOpen(b)},DropDownController.prototype.isClosed=function(a){return!this.isOpen(a)},DropDownController.prototype.whichIdsOpen=function(){for(var a=[],b=0,c=this.dropdown_arr.length;b<c;b+=1)this.isOpen(this.dropdown_arr[b])&&a.push(b);return a},DropDownController.prototype.theOpen=function(){for(var a=this.whichIdsOpen(),b=[],c=0,d=a.length;c<d;c+=1)b.push(this.dropdown_arr[a[c]]);return 1===b.length?b[0]:b.length>1&&b},DropDownController.prototype.areAnyOpen=function(){return this.whichIdsOpen().length>0},DropDownController.prototype.isIndividual=function(){return 1===this.ddtDeterminant.findElements().length},DropDownController.prototype.isMenu=function(a){if(void 0!==a&&isHTMLElement(a))for(var b=0,c=this.dropdown_arr.length;b<c;b+=1)if(this.dropdown_arr[b].element===a)return!0;return!1},DropDownController.prototype.closeOthers=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1){for(var c=0,d=this.dropdown_arr.length;c<d;c+=1){var e=this.dropdown_arr[c];e!==b&&this.close(e)}return!0}(new IMDebugger).pass("DropDownController.closeOthers supplied an object/value that could not resolve to a DropDown.")}return!1},DropDownController.prototype.closeAll=function(){if(this.isFunctional()){for(var a=0,b=this.dropdown_arr.length;a<b;a+=1)this.close(this.dropdown_arr[a]);return!0}return!1},DropDownController.prototype.init=function(a){if("__ddc_master"in window?window.__ddc_master+=1:window.__ddc_master=1,this.id=window.__ddc_master,"element"in a&&(this.ddtDeterminant=new DropDownTargetElement(a.element),this.determinant=this.ddtDeterminant.element_string),"container"in a&&(this.ddtSubElement=new DropDownTargetElement(a.container),this.subElement=this.ddtSubElement.element_string,this.subElement_reference=this.ddtSubElement.reference),this.ddtDeterminant.valid&&this.ddtSubElement.valid){if("outer"in a){this.ddtOuter=new DropDownTargetElement(a.outer);var b=this.ddtOuter.returnElement();this.outer=b.length>0?b[0]:null}this._open="open"in a&&"function"==typeof a.open?a.open:null,this._close="close"in a&&"function"==typeof a.close?a.close:null,this._testOpen="testOpen"in a&&"function"==typeof a.testOpen?a.testOpen:null,this._twiceOpen="twiceOpen"in a&&"function"==typeof a.twiceOpen?a.twiceOpen:null,this._functional="functional"in a&&"function"==typeof a.functional?a.functional:null,this.doesWork=null===this._functional,this.useCodeOpen=null===this._testOpen,"delay"in a&&this.setDelayChange(a.delay),"closeDelay"in a&&this.setCloseDelay(a.closeDelay),"openDelay"in a&&this.setOpenDelay(a.openDelay),this.timing.open.time/=this.delay_change,this.timing.close.time/=this.delay_change,this.settings={on:null,off:null},this.settings.on=new DropDownSet,this.settings.off=new DropDownSet,"settings"in a&&("string"==typeof a.settings?(this.settings.on.set(a.settings),this.settings.off.set(a.settings)):"object"==typeof a.settings&&("on"in a.settings&&this.settings.on.set(a.settings.on),"off"in a.settings&&this.settings.off.set(a.settings.off)));var c=this;return $(document).ready(function(){c.create()}),!0}return(new IMDebugger).pass("Cannot initialise Drop Down: This breaks the Drop Down Functionality"),!1},DropDownController.prototype.create=function(){this.dropdown_arr=[],this.outer=this.ddtOuter.returnElement();var a=this.ddtDeterminant.returnElements();this.outer=void 0!==this.outer&&isHTMLElement(this.outer)?this.outer:$(a[0]).parent()[0];for(var b=0,c=a.length;b<c;b+=1){var d=new DropDown({element:a[b],controller:this,container:this.ddtSubElement.returnElements(a[b])[0]});this.dropdown_arr.push(d)}this.createControls()},DropDownController.prototype.createControls=function(){for(var a=null,b=this.ddtDeterminant.returnElements(),c=this,d=0,e=b.length;d<e;d+=1)a=$(b[d]),this.createIndividualControls(a);(this.settings.on.isHover()||this.settings.off.isHover())&&(this.mouseover_int=setInterval(function(){c.mouseOverError()},1e3),this.mouserecorder.setAlwaysRecord())},DropDownController.prototype.createIndividualControls=function(a){var b=".dd"+this.id,c=this;a.bind("focusin"+b,function(){c.hardOn(this),c.preventClose(this)}),a.bind("focusout"+b,function(){c.hardOff(this)}),this.settings.on.isClick()&&a.bind("click"+b,function(a){if(c.isFunctional()){if(!c.isOpen(c.findDropDown(this))||!c.isActive(c.findDropDownId(this)))return c.hardOn(this),"stopPropagation"in a&&a.stopPropagation(),"preventDefault"in a&&a.preventDefault(),"cancelBubble"in a&&(a.cancelBubble=!0),!1;c.twiceOpen(this)}}),a.find("*").bind("focusin"+b+" mouseenter"+b+" mouseover"+b,function(a){c.touch(this)}),a.find("*").bind("focusout"+b+" mouseleave"+b,function(a){c.numb(this)}),this.settings.on.isHover()&&a.bind("mouseenter"+b+" mouseover"+b,function(a){c.isFunctional()&&(c.isOpen(c.findDropDown(this))&&c.isActive(c.findDropDownId(this))?c.softOn(this):c.hardOn(c.findDropDown(this)))}),this.settings.off.isHover()&&a.bind("mouseleave"+b,function(a){c.isFunctional()&&c.softOff(c.findDropDown(this))})},DropDownController.prototype.setOnTime=function(a){return"number"==typeof a&&a>0&&(this.timing.on=Math.round(a),!0)},DropDownController.prototype.setDelayChange=function(a){return"number"==typeof a&&a>0&&(a>2&&(a/=100),this.delay_change=a,!0)},DropDownController.prototype.setDelay=function(a,b){var c=this.formatDelay(b);return a="open"!==a&&"close"!==a?"open":a,c!==!1&&(this.timing[a]={time:c[0],min:c[1]},!0)},DropDownController.prototype.setOpenDelay=function(a){return this.setDelay("open",a)},DropDownController.prototype.setCloseDelay=function(a){return this.setDelay("close",a)},DropDownController.prototype.formatDelay=function(a){if($.isArray(a)){for(var b=[],c=0,d=0,e=a.length;d<e;d+=1){var f=a[d];if("number"==typeof f&&f>0&&(b[c]=f,c+=1,c>1))break}if(2===c)return b;if(1===c)return b[1]=b[0],b}else if("number"==typeof a&&a>0)return a=Math.round(a),[a,a];return!1},DropDownController.prototype.isFunctional=function(){return"function"==typeof this._functional?this._functional()===!0:this.doesWork},DropDownController.prototype.twiceOpen=function(a){if(this.isFunctional()){if("function"==typeof this._twiceOpen){var b=this._twiceOpen(a);return b===!0||void 0===b}return!0}return!1},DropDownController.prototype.testOpen=function(a){if("function"==typeof this._testOpen){var b=this._testOpen(a);if(void 0!==b)return b}var c=this.findDropDown(a);return c!==!1&&c.state},DropDownController.prototype.open=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1){var c=b.open();if(c===!0||void 0===c)return this.setOpen(b),!0;this.touch(b)}else(new IMDebugger).pass("DropDownController.open was supplied an incompatible object")}return!1},DropDownController.prototype.close=function(a){if(!this.isFunctional())return this.closeAll();if(void 0!==a){var b=this.findDropDown(a);if(b!==!1){var c=b.close();if(c===!0||void 0===c)return this.setClose(b),!0;this.numb(b)}else(new IMDebugger).pass("DropDownController.close was supplied an incompatible object")}return!1},DropDownController.prototype.setOpen=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1){var c=this.findDropDownId(b);b.cancelOpen(),b.cancelClose(),b.preventClose(),this.areAnyOpen()&&this.closeOthers(b),this.active=!0,this.active_id=c,this.addActiveId(c),this.mouserecorder.setRecord(this.mr_instance);var d=this,e=c,f=".anywherebuthere"+this.id;return $(document).unbind("click"+f+" touchstart"+f),"none"!==this.settings.off.val&&$(document).bind("click"+f+" touchstart"+f,function(){d.anywhereBut()&&d.hardOff(e)}),!0}(new IMDebugger).pass("DropDownController.setOpen supplied an object/value that could not be resolved to a DropDown")}return!1},DropDownController.prototype.setClose=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1){var c=this.findDropDownId(b);if(this.removeActiveId(c),!this.isActive()){this.mouserecorder.endRecord(this.mr_instance);var d=".anywherebuthere"+this.id;$(document).unbind("click"+d+" touchstart"+d),this.active_id=-1,this.active=!1}return b.touched=!1,b.cancelAll(),!0}(new IMDebugger).pass("DropDownController.setClose supplied an object/value that could not be resolved to a DropDown")}return!1},DropDownController.prototype.touch=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1){b.cancelCatch(),b.cancelClose();var c=this.findDropDownId(b),d=!1;if(this.isActive()&&this.isActive(c)&&(d=!0,this.isOpen(b)||b.open()),this.settings.on.isClick()&&this.areAnyOpen())for(var e=this.whichIdsOpen(),f=0,g=e.length;f<g;f+=1){var h=this.findDropDown(e[f]);h!==!1&&h.preventClose()}return b.touched&&!d||b.preventClose(),!0}(new IMDebugger).pass("DropDownController.touch supplied an object/value that could not be resolved to a DropDown")}return!1},DropDownController.prototype.numb=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1){if(this.isActive()&&b.isOpen()&&(b.cancelOpen(),this.settings.off.isClick())){this.findDropDownId(b);b.cancelClose(),b.setCatch()}return!0}(new IMDebugger).pass("DropDownController.numb supplied an object/value that could not be resolved to a DropDown")}return!1},DropDownController.prototype.allowClose=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1)return b.allowClose(),!0;(new IMDebugger).pass("DropDownController.numb supplied an object/value that could not be resolved to a DropDown")}return!1},DropDownController.prototype.preventClose=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1)return b.preventClose(),!0;(new IMDebugger).pass("DropDownController.preventClose supplied an object/value that could not be resolved to a DropDown")}return!1},DropDownController.prototype.isActive=function(a){if(void 0===a)return this.active_ids.length>0;if(a=this.findDropDownId(a),"number"==typeof a&&a>-1){for(var b=!1,c=0,d=this.active_ids.length;c<d;c+=1)if(this.active_ids[c]===a){b=!0;break}return b}return!1},DropDownController.prototype.removeActiveId=function(a){for(var b=!1,c=0,d=this.active_ids.length;c<d;c+=1)this.active_ids[c]===a&&(this.active_ids.splice(c,1),b=!0,d-=1,c-=1);return b},DropDownController.prototype.addActiveId=function(a){for(var b=!1,c=0,d=this.active_ids.length;c<d;c+=1)if(this.active_ids[c]===a){b=!0;break}b||this.active_ids.push(a)},DropDownController.prototype.rebuildActiveIds=function(){this.active_ids=this.whichIdsOpen()},DropDownController.prototype.notOver=function(){var a=this.ddtOuter.returnElement();return a=1===a.length?a[0]:$(this.ddtDeterminant.returnElements()).parent()[0],!isHTMLElement(a)||!this.mouserecorder.isOver(a)},DropDownController.prototype.anywhereBut=DropDownController.prototype.notOver,DropDownController.prototype.anywhereButTouch=DropDownController.prototype.notOver,DropDownController.prototype.mouseOverError=function(){if(this.notOver()){for(var a=this.whichIdsOpen(),b=0,c=a.length;b<c;b+=1){var d=a[b],e=this.findDropDown(d);if(this.isOpen(e))return null===this.close_int;this.removeActiveId(d)}return!1}return(new IMDebugger).pass("DropDownController.mouseOverError is wrong, as mouse/pointer is over"),!1},DropDownController.prototype.calculateTime=function(a){switch(a){case"open":case"on":return this.timing.open.time=this.timing.open.time>this.timing.open.min?(this.timing.open.time-this.timing.open.min)*this.delay_change+this.timing.open.min:this.timing.open.time,this.timing.open.time;case"close":case"out":return this.timing.close.time=this.timing.close.time>this.timing.close.min?(this.timing.close.tim-this.timing.close.min)*this.delay_change+this.timing.close.min:this.timing.close.time,this.timing.close.time}},DropDownController.prototype.calculateOpenTime=function(){return this.calculateTime("open")},DropDownController.prototype.calculateCloseTime=function(){return this.calculateTime("close")},DropDownController.prototype.isStillOff=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(b!==!1){if(!b.prevent_close){b.touched||(b.touched=!!this.mouserecorder.isOver(b.element)),b.touched?this.close(b):this.preventClose(b)}var c=this.findDropDownId(b);return this.isActive(c)&&!this.isOpen(b)&&this.removeActiveId(c),!0}(new IMDebugger).pass("DropDownController.isStillOff passed an object/value that could not be resolved to a DropDown")}return!1},DropDownController.prototype.stillOff=DropDownController.prototype.isStillOff,DropDownController.prototype.hardOff=function(){if(this.isFunctional()){this.touched=!1;var a=this.whichIdsOpen(),b=null;if(a.length>0||this.areAnyOpen()){for(var c=0,d=a.length;c<d;c+=1)b=this.findDropDown(a[c]),b!==!1&&(b.touched=!1,b.cancelClose(),b.cancelPrevent(),this.close(b));this.closeAll(),this.rebuildActiveIds()}return!0}return!1},DropDownController.prototype.hardOut=function(){return this.anywhereBut()&&this.hardOff(),!0},DropDownController.prototype.softOff=function(){if(this.isFunctional()){this.touched=!1;var a=this.whichIdsOpen(),b=null;if(a.length>0||this.areAnyOpen())for(var c=0,d=a.length;c<d;c+=1)b=this.findDropDown(a[c]),b!==!1&&(b.prevent_close||this.touched||null!==b.close_int||(b.cancelOpen(),b.setClose()));return!0}return!1},DropDownController.prototype.softOut=function(){return this.anywhereBut()&&this.softOff(),!0},DropDownController.prototype.hardOn=function(a){if(this.isFunctional()){var b=this.findDropDown(a);if(this.touched=!0,b!==!1)return b.touched=!0,this.isOpen(b)||this.open(b),!0;(new IMDebugger).pass("DropDownController.hardOn supplied an object/value that could not be resolved to a valid DropDown")}return!1},DropDownController.prototype.softOn=function(a){if(this.isFunctional()){var b=this.findDropDown(a);return this.touched=!0,b===!1||this.isOpen(b)||null!==b.open_int||b.setOpen(),!0}return!1},DropDown.prototype.init=function(a){this.controller="controller"in a&&a.controller instanceof DropDownController?a.controller:null,this.element="element"in a&&isHTMLElement(a.element)?a.element:null,this.container="container"in a&&isHTMLElement(a.container)?a.container:null,this.ui_element="ui_element"in a&&isHTMLElement(a.ui_element)?a.ui_element:null},DropDown.prototype.isOpen=function(){return this.controller.useCodeOpen?this.state:this.controller.testOpen(this)},DropDown.prototype.isClosed=function(){return!this.isOpen()},DropDown.prototype.cancelAll=function(){this.cancelClose(),this.cancelOpen(),this.cancelCatch(),this.cancelPrevent()},DropDown.prototype.setCatch=function(){this.cancelCatch();var a=this;return this.cancel_int=setInterval(function(){a.controller.isStillOff(a)},250),!0},DropDown.prototype.preventClose=function(){this.prevent_close=!0,this.cancelPrevent();var a=this;this.prevent_int=setTimeout(function(){a.prevent_close=!1,a.cancelPrevent()},this.controller.timing.forgiveness)},DropDown.prototype.cancelPrevent=function(){return null!==this.prevent_int&&(clearTimeout(this.prevent_int),this.prevent_int=null),!0},DropDown.prototype.allowClose=function(){this.prevent_close=!1,this.cancelPrevent()},DropDown.prototype.closeOthers=function(){return this.controller.closeOthers(this)},DropDown.prototype.setClose=function(){this.cancelClose();var a=this;this.close_int=setTimeout(function(){a.controller.anywhereBut()&&a.controller.close(a)},this.controller.calculateCloseTime())},DropDown.prototype.cancelClose=function(){return null!==this.close_int&&(clearTimeout(this.close_int),this.close_int=null),!0},DropDown.prototype.cancelCatch=function(){return null!==this.cancel_int&&(clearInterval(this.cancel_int),this.cancel_int=null),!0},DropDown.prototype.setOpen=function(){this.cancelOpen(),this.open_int=setTimeout(function(){this.controller.open(this)},this.controller.calculateOpenTime())},DropDown.prototype.cancelOpen=function(){return null!==this.open_int&&(clearTimeout(this.open_int),this.open_int=null),!0},DropDown.prototype.open=function(){return this.state=1,"function"==typeof this._open?this._open(this):this.controller._open(this)},DropDown.prototype.close=function(){return this.state=0,"function"==typeof this._close?this._close(this):this.controller._close(this)},DropDown.prototype.overideOpen=function(a){return"function"==typeof a?(this._open=a,!0):(this._open=null,!1)},DropDown.prototype.overideClose=function(a){return"function"==typeof a?(this._close=a,!0):(this._close=null,!1)},DropDownTargetElement.prototype.init=function(a){void 0!==a&&isHTMLElement(a)?this.addElement(a):"object"==typeof a?(this.element_string="string"in a&&"string"==typeof a.string?a.string:"",this.element="element"in a&&void 0!==a.element&&isHTMLElement(a.element)?a.element:null,null===this.element&&""===this.element_string&&"element"in a&&"string"==typeof a.element&&this.addElementString(a.element),this.reference="reference"in a&&("relative"===a.reference||"absolute"===a.reference)?a.reference:null,this.reference=null===this.reference&&"ref"in a&&("relative"===a.ref||"absolute"===a.ref)?a.ref:null,this.valid=""!==this.element_string||null!==this.element):"string"==typeof a&&this.addElementString(a)},DropDownTargetElement.prototype.addReference=function(a){return this.reference="string"!=typeof a||"relative"!==a&&"absolute"!==a?null:a,this.reference===a},DropDownTargetElement.prototype.addElement=function(a){return this.element=void 0!==a&&isHTMLElement(a)?a:null,this.element===a&&(this.element_string="",this.valid=!0,!0)},DropDownTargetElement.prototype.addElementString=function(a){return this.element_string="string"==typeof a?a:null,this.element_string===a&&(this.element=null,this.valid=!0,!0)},DropDownTargetElement.prototype.returnElement=function(a){if(null===this.element_string||"string"!=typeof this.element_string)return isHTMLElement(this.element)?[this.element]:[null];if(null!==a){var b=null;switch(this.reference){case"relative":b=$(a);break;case"absolute":default:b=null}return null!==b?b.find(this.element_string):$(this.element_string)}},DropDownTargetElement.prototype.returnElements=DropDownTargetElement.prototype.returnElement,DropDownSet.prototype.isClick=function(){return"click"===this.val||"both"===this.val},DropDownSet.prototype.isHover=function(){return"hover"===this.val||"both"===this.val},DropDownSet.prototype.set=function(a){return a=a.toLowerCase(),this.val="hover"===a||"click"===a||"both"===a||"none"===a?a:this.val,this.val===a};